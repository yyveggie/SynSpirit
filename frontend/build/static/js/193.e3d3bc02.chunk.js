"use strict";(self.webpackChunkai_tools_website_frontend=self.webpackChunkai_tools_website_frontend||[]).push([[193],{2193:(e,t,s)=>{s.d(t,{A:()=>y});var r=s(5043),n=s(6213),i=s(2115),l=s(6264),a=s(2377),o=s(6625),c=s(4669),d=s(6199),u=s(3248),m=s(8261),p=s(7097),x=s(4558),h=s(5369),g=s(4383),v=s(57),f=s(579);const y=e=>{let{targetType:t,targetId:s,apiBaseUrl:y,token:w,currentUser:b,isLiked:k,isCollected:j,likeCount:_,collectCount:N,shareCount:$,handleLikeToggle:C,handleCollectToggle:R,handleShareClick:L,isSubmittingAction:S}=e;const[z,E]=(0,r.useState)(""),[A,B]=(0,r.useState)(!1),[I,M]=(0,r.useState)(null),[T,J]=(0,r.useState)(""),[D,W]=(0,r.useState)(!1),[F,K]=(0,r.useState)(""),[P,Q]=(0,r.useState)("latest"),O=(0,r.useRef)({}),[U,q]=(0,r.useState)({}),[H,V]=(0,r.useState)(!1),{token:Y,user:G}=(0,o.A)(),X=(0,r.useRef)(null),Z=(0,r.useRef)(null),ee=(0,u.jE)(),[te,se]=(0,r.useState)(0),[re,ne]=(0,r.useState)(150),[ie,le]=(0,r.useState)([]),[ae,oe]=(0,r.useState)(window.innerWidth-40),ce=(0,r.useMemo)((()=>Math.min(600,.7*window.innerHeight)),[]),de=(0,r.useCallback)(((e,t,s)=>{e.forEach((e=>{e.replies&&e.replies.length>0&&(s[e.id]=!1,de(e.replies,t+1,s))}))}),[]),ue=["comments",t,s,P,(null===b||void 0===b?void 0:b.id)||"anonymous"],{data:me=[],isLoading:pe,isError:xe,error:he,refetch:ge}=(0,m.I)({queryKey:ue,queryFn:()=>(async(e,t,s,r)=>{let i="";if("article"===e)i=`${x.JR}/api/original-comments/articles/${t}/comments/tree`;else{if("post"!==e)return[];i=`${x.JR}/api/posts/${t}/comments`}const l=`${i}?sort_by=${s}`;let a=[];if("post"===e){var o;a=(null===(o=(await n.A.get(l,{headers:r?{Authorization:`Bearer ${r}`}:{}})).data)||void 0===o?void 0:o.comments)||[]}else{if("article"!==e)return[];a=(await n.A.get(l,{headers:r?{Authorization:`Bearer ${r}`}:{}})).data||[]}return a})(t,s,P,Y),staleTime:3e5,gcTime:6e5,placeholderData:e=>null!==e&&void 0!==e?e:[],enabled:!!s&&!!t});(0,r.useEffect)((()=>{console.log({isLoading:pe,isError:xe,commentsData:me})}),[me,pe,xe,he,t,s,P]),(0,r.useEffect)((()=>{if(me&&me.length>0){const e={...O.current};me.forEach((t=>{if(t.replies&&t.replies.length>0){void 0===e[t.id]&&(e[t.id]=!1);const s=t=>{t.forEach((t=>{t.replies&&t.replies.length>0&&(void 0===e[t.id]&&(e[t.id]=!1),s(t.replies))}))};s(t.replies)}})),O.current=e,q(e)}}),[me]);const ve=(0,r.useCallback)((e=>{let t=0;for(const s of e)t++,s.replies&&s.replies.length>0&&(t+=ve(s.replies));return t}),[]),fe=(0,p.n)({mutationFn:async e=>{let{content:r,mentionLynn:i}=e,l="";if("article"===t)l=`${x.JR}/api/original-comments/articles/${s}/comments`;else{if("post"!==t)throw new Error(`[Submit Comment] Unknown targetType: ${t}`);l=`${x.JR}/api/posts/${s}/comments`}const a={content:r.trim()};i&&(a.mention_lynn=!0);return(await n.A.post(l,a,{headers:{Authorization:`Bearer ${Y}`}})).data},onSuccess:e=>{ee.invalidateQueries({queryKey:["comments",t,s]}),E(""),i.oR.success("\u8bc4\u8bba\u53d1\u8868\u6210\u529f\uff01")},onError:e=>{console.error("\u63d0\u4ea4\u8bc4\u8bba\u5931\u8d25:",e);const t=e.message||"\u8bc4\u8bba\u63d0\u4ea4\u5931\u8d25";i.oR.error(t)},onSettled:()=>{B(!1)}}),ye=()=>{if(!Y||!z.trim())return void i.oR.warn("\u8bc4\u8bba\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a\u4e14\u9700\u8981\u767b\u5f55\u3002");B(!0);const e=z.toLowerCase().includes("@lynn");fe.mutate({content:z,mentionLynn:e})},we=(0,p.n)({mutationFn:async e=>{let{parentId:r,content:i,mentionLynn:l}=e,a="";if("article"===t)a=`${x.JR}/api/original-comments/articles/${s}/comments/${r}/replies`;else{if("post"!==t)throw new Error(`[Submit Reply] Unknown targetType: ${t}`);a=`${x.JR}/api/posts/${s}/comments/${r}/replies`}const o={content:i.trim()};l&&(o.mention_lynn=!0);return(await n.A.post(a,o,{headers:{Authorization:`Bearer ${Y}`}})).data},onMutate:async e=>{let{parentId:t,content:s}=e;await ee.cancelQueries({queryKey:ue});const r=ee.getQueryData(ue)||[],n={id:Date.now(),content:s,created_at:(new Date).toISOString(),user_id:(null===b||void 0===b?void 0:b.id)||null,parent_id:t,user:b,replies:[],likes_count:0,is_liked_by_current_user:!1,_isOptimistic:!0,is_ai_generated:!1};return ee.setQueryData(ue,(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const s=JSON.parse(JSON.stringify(e)),r=e=>e.map((e=>e.id===t?{...e,replies:[...e.replies||[],n]}:e.replies&&e.replies.length>0?{...e,replies:r(e.replies)}:e));return r(s)})),{previousComments:r}},onSuccess:(e,t)=>{ee.setQueryData(ue,(function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!s.length)return ee.invalidateQueries({queryKey:ue}),s;const r=JSON.parse(JSON.stringify(s)),n=s=>s.map((s=>s.id===t.parentId?{...s,replies:s.replies.map((t=>t._isOptimistic?e:t))}:s.replies&&s.replies.length>0?{...s,replies:n(s.replies)}:s));return n(r)})),J(""),M(null),i.oR.success("\u56de\u590d\u6210\u529f\uff01")},onError:(e,t,s)=>{console.error("\u63d0\u4ea4\u56de\u590d\u5931\u8d25:",e),i.oR.error(e.message||"\u56de\u590d\u63d0\u4ea4\u5931\u8d25"),null!==s&&void 0!==s&&s.previousComments&&ee.setQueryData(ue,s.previousComments)},onSettled:()=>{W(!1)}}),be=e=>{if(!Y||!T.trim())return void i.oR.warn("\u56de\u590d\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a\u4e14\u9700\u8981\u767b\u5f55\u3002");W(!0);const t=T.toLowerCase().includes("@lynn");we.mutate({parentId:e,content:T,mentionLynn:t})},ke=(0,p.n)({mutationFn:async e=>{let{commentId:r}=e,i="";if("article"===t)i=`${x.JR}/api/original-comments/articles/${s}/comments/${r}`;else{if("post"!==t)throw new Error(`[Delete Comment] Unknown targetType: ${t}`);i=`${x.JR}/api/posts/${s}/comments/${r}`}await n.A.delete(i,{headers:{Authorization:`Bearer ${Y}`}})},onSuccess:()=>{ee.invalidateQueries({queryKey:["comments",t,s]}),i.oR.success("\u8bc4\u8bba\u5df2\u5220\u9664")},onError:e=>{console.error("\u5220\u9664\u8bc4\u8bba\u5931\u8d25:",e),i.oR.error(e.message||"\u5220\u9664\u8bc4\u8bba\u5931\u8d25")}}),je=e=>{Y?window.confirm("\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u6761\u8bc4\u8bba\u5417\uff1f\u5176\u4e0b\u7684\u56de\u590d\u5c06\u4fdd\u7559\uff0c\u4f46\u6b64\u8bc4\u8bba\u5185\u5bb9\u4f1a\u6d88\u5931\u3002")&&ke.mutate({commentId:e}):i.oR.error("\u8bf7\u5148\u767b\u5f55\u3002")},_e=(0,p.n)({mutationFn:async e=>{let s,r,{commentId:i,isLiked:l}=e;var a;if("post"===t?s=`${x.JR}/api/posts/post_comments/${i}/like`:"article"===t?s=`${x.JR}/api/original-comments/comments/${i}/like`:(console.error(`[CommentSection ERROR] Unsupported targetType for like: ${t}`),s=`${x.JR}/api/comments/${i}/like?target_type=${t}`),r=l?await n.A.delete(s,{headers:{Authorization:`Bearer ${Y}`}}):await n.A.post(s,{},{headers:{Authorization:`Bearer ${Y}`}}),200!==r.status&&201!==r.status&&204!==r.status)throw new Error((null===(a=r.data)||void 0===a?void 0:a.message)||"Like/Unlike API Error");const o=r.data||{};return{likes_count:void 0!==o.likes_count?o.likes_count:o.like_count||0,is_liked_by_current_user:void 0!==o.is_liked_by_current_user?o.is_liked_by_current_user:o.is_liked}},onSuccess:(e,t)=>{ee.setQueryData(ue,(function(){const s=r=>r.map((r=>r.id===t.commentId?{...r,likes_count:e.likes_count,is_liked_by_current_user:e.is_liked_by_current_user}:r.replies&&r.replies.length>0?{...r,replies:s(r.replies)}:r));return s(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[])}))},onError:(e,t)=>{console.error("Like/Unlike\u5931\u8d25:",e),i.oR.error(`\u64cd\u4f5c\u5931\u8d25: ${e.message}`)}}),Ne=e=>{Y?_e.mutate({commentId:e,isLiked:!1}):i.oR.warn("\u8bf7\u5148\u767b\u5f55")},$e=e=>{Y?_e.mutate({commentId:e,isLiked:!0}):i.oR.warn("\u8bf7\u5148\u767b\u5f55")},Ce=(e,t)=>{I===e?(M(null),K(""),J("")):null!==I?(M(null),K(""),J(""),setTimeout((()=>{M(e),K(t),J(""),setTimeout((()=>{var e;null===(e=Z.current)||void 0===e||e.focus()}),10)}),10)):(M(e),K(t),J(""),setTimeout((()=>{var e;null===(e=Z.current)||void 0===e||e.focus()}),10))},Re=(e,t)=>{null===t||void 0===t||t.stopPropagation();const s={...U,[e]:!U[e]};O.current=s,q(s)},Le=(e,t)=>{if(e.preventDefault(),e.stopPropagation(),P!==t){var s;const e=(null===(s=ze.current)||void 0===s?void 0:s.scrollTop)||0;Q((e=>(console.log(`\u5207\u6362\u6392\u5e8f\uff1a${e} -> ${t}`),t))),ge(),requestAnimationFrame((()=>{ze.current&&(ze.current.scrollTop=e)}))}},Se=e=>{J(e.target.value)},ze=(0,r.useRef)(null),Ee=(0,r.useCallback)((()=>{pe||se((e=>e+1)),ge?(ge(),i.oR.info("\u6b63\u5728\u5237\u65b0\u8bc4\u8bba...")):(console.error("refetchComments function is not available."),i.oR.error("\u5237\u65b0\u529f\u80fd\u6682\u65f6\u65e0\u6cd5\u4f7f\u7528\u3002"))}),[pe,ge]);(0,r.useEffect)((()=>{if(me&&me.length>0){const e=[],t=function(s){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];for(const i of s){const s=n&&!(null!==i.parent_id&&i.parent_id in U&&U[i.parent_id]);e.push({...i,depth:r,visible:s}),i.replies&&i.replies.length>0&&!U[i.id]&&t(i.replies,r+1,s)}};t(me),le(e)}else le([])}),[me,U]);const Ae=(0,r.useCallback)(((e,t)=>{for(const s of e){if(s.id===t)return s;if(s.replies&&s.replies.length>0){const e=Ae(s.replies,t);if(e)return e}}}),[]),Be=(0,r.useCallback)((e=>{var t,s,r,n,o,c,u,m,p;let{index:x,style:h}=e;if(x<0||x>=ie.length||!ie[x].visible)return null;const g=ie[x],v=g.depth||0;return(0,f.jsxs)("div",{className:`comment-item py-3 relative depth-${v>0?Math.min(v,5):0}`,style:{paddingLeft:v>0?8*v+"px":"0",marginLeft:v>0?"12px":"0",borderLeft:v>0?"1px solid rgba(0, 0, 0, 0.3)":"none",paddingTop:v>0?"12px":"8px"},children:[v>0&&(0,f.jsx)("div",{className:"absolute",style:{left:"-1px",top:"28px",width:"12px",height:"16px",borderBottomLeftRadius:"8px",borderLeft:"1px solid rgba(0, 0, 0, 0.3)",borderBottom:"1px solid rgba(0, 0, 0, 0.3)"}}),(0,f.jsxs)("div",{className:"flex items-start mb-1 user-info",children:[(0,f.jsx)("div",{className:"flex-shrink-0",style:{minWidth:"24px"},children:(0,f.jsx)(d.A,{userId:null!==(t=null===(s=g.user)||void 0===s?void 0:s.id)&&void 0!==t?t:void 0,username:(null===(r=g.user)||void 0===r?void 0:r.nickname)||(null===(n=g.user)||void 0===n||null===(o=n.email)||void 0===o?void 0:o.split("@")[0])||"\u533f\u540d\u7528\u6237",avatar:null===(c=g.user)||void 0===c?void 0:c.avatar,size:"sm",showName:!1,className:""})}),(0,f.jsxs)("div",{className:"flex-grow ml-3",children:[(0,f.jsxs)("div",{className:"flex items-baseline justify-between",children:[(0,f.jsx)("span",{className:"font-medium text-sm "+(g.is_ai_generated?"text-purple-600 dark:text-purple-400":"text-blue-600 dark:text-blue-400"),children:(null===(u=g.user)||void 0===u?void 0:u.nickname)||(null===(m=g.user)||void 0===m||null===(p=m.email)||void 0===p?void 0:p.split("@")[0])||"\u533f\u540d\u7528\u6237"}),(0,f.jsx)("span",{className:"text-xs text-gray-500 pt-1 ml-auto",children:(0,l.m)(new Date(g.created_at),{addSuffix:!0,locale:a.g})})]}),(0,f.jsx)("p",{style:{color:"black"},className:"text-sm mt-1 whitespace-pre-wrap break-words",children:g.is_ai_generated?(0,f.jsx)("span",{className:"text-purple-600 dark:text-purple-400",children:g.content}):!0===g.is_deleted?(0,f.jsx)("span",{className:"text-blue-400 italic",children:g.content}):(0,f.jsx)("span",{style:{color:"black"},children:g.content})}),(0,f.jsx)("div",{className:"mt-2 flex items-center",children:!g.is_deleted&&(0,f.jsxs)("div",{className:"flex items-center",children:[g.replies&&g.replies.length>0&&(0,f.jsx)("button",{onClick:e=>Re(g.id,e),className:"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 py-0 px-0.5 focus:outline-none font-mono text-xs flex items-center justify-center mr-3 w-[36px] text-center","aria-label":U[g.id]?"\u5c55\u5f00\u56de\u590d":"\u6536\u8d77\u56de\u590d",children:U[g.id]?`[+${ve(g.replies)}]`:"[-]"}),(0,f.jsx)("button",{onClick:()=>{var e,t,s;return Ce(g.id,(null===(e=g.user)||void 0===e?void 0:e.nickname)||(null===(t=g.user)||void 0===t||null===(s=t.email)||void 0===s?void 0:s.split("@")[0])||"\u533f\u540d\u7528\u6237")},className:`text-xs ${I===g.id?"text-blue-600":"text-gray-500 hover:text-blue-600"} flex items-center mr-4`,disabled:!Y,title:Y?I===g.id?"\u53d6\u6d88\u56de\u590d":"\u56de\u590d":"\u8bf7\u5148\u767b\u5f55",children:(0,f.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,f.jsx)("path",{fillRule:"evenodd",d:"M7.707 3.293a1 1 0 010 1.414L5.414 7H11a7 7 0 017 7v2a1 1 0 11-2 0v-2a5 5 0 00-5-5H5.414l2.293 2.293a1 1 0 11-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z",clipRule:"evenodd"})})}),(0,f.jsxs)("button",{onClick:()=>Y?g.is_liked_by_current_user?$e(g.id):Ne(g.id):i.oR.warn("\u8bf7\u5148\u767b\u5f55\u540e\u70b9\u8d5e"),className:`text-xs flex items-center transition-colors duration-200 ${g.is_liked_by_current_user?"text-pink-500 hover:text-pink-400":"text-gray-500 hover:text-pink-400"} mr-4`,disabled:!Y||_e.isPending,title:Y?g.is_liked_by_current_user?"\u53d6\u6d88\u70b9\u8d5e":"\u70b9\u8d5e":"\u8bf7\u5148\u767b\u5f55",children:[g.is_liked_by_current_user?(0,f.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,f.jsx)("path",{fillRule:"evenodd",d:"M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z",clipRule:"evenodd"})}):(0,f.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:(0,f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})}),g.likes_count>0&&(0,f.jsx)("span",{className:"text-xs ml-1",children:g.likes_count})]}),b&&g.user&&b.id===g.user.id&&!g.is_deleted&&!g.is_ai_generated&&(0,f.jsx)("button",{onClick:()=>je(g.id),className:"text-xs text-gray-500 hover:text-red-500 flex items-center",title:"\u5220\u9664\u8bc4\u8bba",children:(0,f.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,f.jsx)("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})})]})}),I===g.id&&(0,f.jsxs)("div",{className:"relative w-full mt-3",children:[(0,f.jsx)("textarea",{ref:Z,value:T,onChange:Se,placeholder:`\u56de\u590d ${F}...`,rows:2,className:"w-full p-3 pr-10 pb-3 bg-gray-800/90 rounded-md text-sm text-white placeholder-gray-400 resize-none h-16 shadow-inner border-0 outline-none focus:ring-1 focus:ring-blue-500/50",autoFocus:!0}),(0,f.jsx)("div",{className:"absolute bottom-2 right-2 flex items-center space-x-2",children:(0,f.jsx)("button",{onClick:()=>be(g.id),disabled:D||!T.trim(),title:"\u56de\u590d",className:"text-white hover:text-blue-300 disabled:text-gray-500 disabled:cursor-not-allowed transition-colors duration-200 p-1 rounded hover:bg-gray-700/50 "+(D?"animate-pulse":""),children:(0,f.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 transform rotate-180",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:(0,f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 10h10a8 8 0 018 8v2M3 10l4-4m-4 4l4 4"})})})})]})]})]}),g.replies&&g.replies.length>0&&(0,f.jsx)("div",{className:"replies-container relative mt-2 space-y-2 overflow-hidden transition-all duration-300 ease-in-out",style:{maxHeight:U[g.id]?"0":"10000px",opacity:U[g.id]?0:1,marginTop:U[g.id]?"0":"0.5rem",transform:U[g.id]?"translateY(-10px)":"translateY(0)"},children:!U[g.id]&&(0,f.jsx)(f.Fragment,{children:g.replies.map((e=>{const t=ie.findIndex((t=>t.id===e.id));return t>=0?Be({index:t,style:{}}):null}))})})]},g.id)}),[ie,U,ve,Ce,be,Re,Y,b,T,Z,F,I,D,_e.isPending,je,Ne,$e]);return(0,r.useEffect)((()=>{const e=()=>{oe(window.innerWidth-40)};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,f.jsxs)("div",{className:"mt-10 pt-6 border-t border-gray-300/50",ref:ze,children:[(0,f.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,f.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,f.jsxs)("div",{className:"flex items-center text-gray-600 text-sm",children:[(0,f.jsx)(c.A,{size:16,className:"mr-1"}),(0,f.jsxs)("span",{className:"tabular-nums",children:["(",ve(me),")"]})]}),(0,f.jsxs)("button",{onClick:C,className:`p-1.5 rounded-md text-sm font-medium flex items-center gap-1 transition-colors duration-300 \n                ${k?"text-pink-400 hover:text-pink-300 active:text-pink-500":"text-gray-400 hover:text-gray-200 active:text-gray-300"} \n                ${!w&&"opacity-50 cursor-not-allowed"}`,disabled:!w,title:w?k?"\u53d6\u6d88\u70b9\u8d5e":"\u70b9\u8d5e":"\u8bf7\u5148\u767b\u5f55",children:[(0,f.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:(0,f.jsx)("path",{fillRule:"evenodd",d:"M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z",clipRule:"evenodd"})}),(0,f.jsxs)("span",{className:"tabular-nums",children:["(",_,")"]})]}),(0,f.jsxs)("button",{onClick:R,className:`p-1.5 rounded-md text-sm font-medium flex items-center gap-1 transition-colors duration-300 \n                ${j?"text-yellow-400 hover:text-yellow-300 active:text-yellow-500":"text-gray-400 hover:text-gray-200 active:text-gray-300"} \n                ${!w&&"opacity-50 cursor-not-allowed"}`,disabled:!w,title:w?j?"\u53d6\u6d88\u6536\u85cf":"\u6536\u85cf":"\u8bf7\u5148\u767b\u5f55",children:[(0,f.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:(0,f.jsx)("path",{d:"M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-3.5L5 18V4z"})}),(0,f.jsxs)("span",{className:"tabular-nums",children:["(",N,")"]})]}),(0,f.jsxs)("button",{onClick:L,className:`p-1.5 rounded-md text-sm font-medium flex items-center gap-1 transition-colors duration-300 \n                text-gray-400 hover:text-gray-200 active:text-gray-300 \n                ${!w&&"opacity-50 cursor-not-allowed"}`,disabled:!w,title:w?"\u5206\u4eab":"\u8bf7\u5148\u767b\u5f55",children:[(0,f.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:(0,f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"})}),$>0&&(0,f.jsxs)("span",{className:"tabular-nums",children:["(",$,")"]})]})]}),(0,f.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,f.jsx)("button",{onClick:e=>Le(e,"latest"),className:"px-4 py-1.5 rounded-full transition-colors text-xs font-medium "+("latest"===P?"bg-gray-200/80 dark:bg-gray-700/80 text-gray-900 dark:text-gray-100":"bg-transparent text-gray-500 hover:bg-gray-100/50 dark:hover:bg-gray-800/50 hover:text-gray-900 dark:hover:text-gray-100"),children:"\u6700\u65b0"}),(0,f.jsx)("button",{onClick:e=>Le(e,"popular"),className:"px-4 py-1.5 rounded-full transition-colors text-xs font-medium "+("popular"===P?"bg-gray-200/80 dark:bg-gray-700/80 text-gray-900 dark:text-gray-100":"bg-transparent text-gray-500 hover:bg-gray-100/50 dark:hover:bg-gray-800/50 hover:text-gray-900 dark:hover:text-gray-100"),children:"\u70ed\u95e8"})]})]}),w&&b&&(0,f.jsxs)("div",{className:"mb-8 flex items-center space-x-2",children:[(0,f.jsxs)("div",{className:"relative flex-grow",children:[(0,f.jsx)("textarea",{ref:X,value:z,onChange:e=>{E(e.target.value)},onFocus:()=>V(!0),onBlur:()=>{z.trim()||V(!1)},className:"w-full px-4 py-3 pr-12 bg-gray-100/80 backdrop-blur-sm rounded-xl\n                focus:outline-none focus:ring-2 focus:ring-blue-500/50 text-black text-sm \n                resize-none placeholder-gray-500 shadow-inner\n                transition-all duration-300 ease-in-out\n                "+(H||z.trim()?"h-24":"h-12"),rows:H||z.trim()?3:1,placeholder:H?"":"\u53d1\u8868\u8bc4\u8bba...",disabled:A,onKeyDown:e=>{(e.ctrlKey||e.metaKey)&&"Enter"===e.key&&ye()}}),(0,f.jsx)("div",{className:"absolute bottom-3 right-3 flex items-center space-x-2\n                transition-opacity duration-300 ease-in-out\n                "+(H||z.trim()?"opacity-100":"opacity-0"),children:(0,f.jsx)("button",{onClick:ye,disabled:A||!z.trim()||fe.isPending,className:"p-2 text-blue-600 hover:text-blue-500 rounded-md transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-100 focus:ring-blue-500 "+(A?"animate-pulse":""),title:"\u63d0\u4ea4\u8bc4\u8bba (Cmd/Ctrl+Enter)",children:fe.isPending?(0,f.jsxs)("svg",{className:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,f.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,f.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):(0,f.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 transform rotate-180",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:(0,f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 10h10a8 8 0 018 8v2M3 10l4-4m-4 4l4 4"})})})})]}),(0,f.jsx)("button",{onClick:Ee,disabled:pe,className:"p-1.5 text-gray-600 hover:text-blue-600 active:text-blue-700 transition-colors duration-150 rounded-full hover:bg-gray-200/50 active:bg-gray-300/50 focus:outline-none flex-shrink-0",title:"\u5237\u65b0\u8bc4\u8bba",children:pe?(0,f.jsx)(h.hW,{className:"animate-spin h-4 w-4"}):(0,f.jsx)(g.P.div,{initial:{rotate:0},animate:{rotate:360},transition:{duration:.4,ease:"linear"},style:{display:"flex"},children:(0,f.jsx)(h.KP4,{className:"h-4 w-4 block",strokeWidth:1})},`outer-input-refresh-${te}`)})]}),pe&&0===me.length?(0,f.jsx)("div",{className:"text-center text-gray-500 py-8",children:"\u52a0\u8f7d\u8bc4\u8bba\u4e2d..."}):xe?(0,f.jsx)("div",{className:"text-center text-red-400 py-8",children:(null===he||void 0===he?void 0:he.message)||"\u52a0\u8f7d\u8bc4\u8bba\u5931\u8d25"}):me.length>0?(0,f.jsx)("div",{className:"comment-list-container",style:{height:ie.length>10?ce:"auto"},children:ie.length>10?(0,f.jsx)("div",{style:{height:ce,width:"100%"},children:(0,f.jsx)(v.Y1,{className:"comments-virtual-list",height:ce,width:ae,itemCount:ie.length,itemSize:re,overscanCount:5,children:Be})}):(0,f.jsx)("div",{className:"space-y-4 pb-8",children:me.map((e=>{const t=ie.findIndex((t=>t.id===e.id));return t>=0?Be({index:t,style:{}}):null}))})}):(0,f.jsx)("div",{className:"text-center text-gray-500 py-8",children:(0,f.jsx)("p",{children:"\u6682\u65e0\u8bc4\u8bba\uff0c\u6765\u53d1\u8868\u7b2c\u4e00\u6761\u8bc4\u8bba\u5427"})})]})}}}]);
//# sourceMappingURL=193.e3d3bc02.chunk.js.map