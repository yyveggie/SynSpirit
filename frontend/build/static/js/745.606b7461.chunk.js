"use strict";(self.webpackChunkai_tools_website_frontend=self.webpackChunkai_tools_website_frontend||[]).push([[745],{1745:(e,t,n)=>{n.d(t,{A:()=>y});var o=n(5043),r=n(5555),a=(n(7660),n(4298),n(6213)),i=n(4558),s=(n(119),n(349)),c=(n(8595),n(9408),n(924)),l=n.n(c),d=n(579),u=function(e){return e.YouTube="youtube",e.Bilibili="bilibili",e.Unknown="unknown",e}(u||{});class p{constructor(e){this.token=void 0,this.maxFileSize=void 0,this.token=e,this.maxFileSize=10485760}async upload(e){if(!e)throw new Error("\u65e0\u6548\u7684\u6587\u4ef6\u5bf9\u8c61");if(e.size>this.maxFileSize)throw new Error(`\u56fe\u7247\u592a\u5927\uff0c\u8bf7\u4e0a\u4f20\u5c0f\u4e8e10MB\u7684\u56fe\u7247\uff08\u5f53\u524d\u5927\u5c0f: ${(e.size/1048576).toFixed(2)}MB\uff09`);const t=new FormData;t.append("image",e);try{const e={"Content-Type":"multipart/form-data"};this.token&&(e.Authorization=`Bearer ${this.token}`),console.log("\u51c6\u5907\u4e0a\u4f20\u56fe\u7247, \u8bf7\u6c42URL:",`${i.JR}/api/upload/image`),console.log("\u662f\u5426\u6709token:",this.token?"\u662f":"\u5426");const n=await a.A.post(`${i.JR}/api/upload/image`,t,{headers:e,timeout:3e4,onUploadProgress:e=>{const t=Math.round(100*e.loaded/(e.total||1));console.log(`\u4e0a\u4f20\u8fdb\u5ea6: ${t}%`)}});if(n.data&&n.data.imageUrl)return console.log("\u56fe\u7247\u4e0a\u4f20\u6210\u529f:",n.data.imageUrl),n.data.imageUrl;throw console.error("Upload failed: Invalid response format",n.data),new Error("\u4e0a\u4f20\u6210\u529f\uff0c\u4f46\u670d\u52a1\u5668\u8fd4\u56de\u7684\u6570\u636e\u683c\u5f0f\u65e0\u6548")}catch(s){var n,o,r;throw console.error("Upload failed:",(null===(n=s.response)||void 0===n?void 0:n.data)||s.message),new Error((null===(o=s.response)||void 0===o||null===(r=o.data)||void 0===r?void 0:r.error)||"\u56fe\u7247\u4e0a\u4f20\u5931\u8d25")}}}const m={parseVideoUrl(e){if(!e||"string"!==typeof e)return{platform:u.Unknown,videoId:"",embedUrl:""};const t=e.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/i);if(t&&t[1]){const e=t[1];return{platform:u.YouTube,videoId:e,embedUrl:`https://www.youtube.com/embed/${e}?autoplay=0&mute=0&controls=1`}}const n=e.match(/(?:bilibili\.com\/video\/(?:av|BV)([a-zA-Z0-9]+)|b23\.tv\/([a-zA-Z0-9]+))/i);if(n){const e=n[1]||n[2]||"";let t=e;return e.startsWith("BV")||e.startsWith("av")||(t=`BV${e}`),{platform:u.Bilibili,videoId:t,embedUrl:`https://player.bilibili.com/player.html?bvid=${t}&page=1&autoplay=0&danmaku=0&high_quality=0&as_wide=0`}}return{platform:u.Unknown,videoId:"",embedUrl:""}},generateEmbedCode(e){if(!e||e.platform===u.Unknown||!e.videoId)return"";const t='<div class="iframe-container">',n="</div>",o=e.embedUrl;return e.platform===u.YouTube?`${t}<iframe src="${o}" title="YouTube video player" frameborder="0" allow="accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen" allowfullscreen></iframe>${n}`:e.platform===u.Bilibili?`${t}<iframe src="${o}" title="Bilibili video player" frameborder="0" allow="accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen" allowfullscreen scrolling="no"></iframe>${n}`:""}};function f(e,t){let n=null;return function(){for(var o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];n&&clearTimeout(n),n=setTimeout((()=>{e(...r),n=null}),t)}}function g(){const e=document.createElement("div");return e.className="toastui-editor-toolbar-divider",e}const b=e=>{let{initialData:t="",onChange:n,token:a,onReady:i,height:c="1000px",initialEditType:b="wysiwyg"}=e;const y=(0,o.useRef)(null),[h,w]=(0,o.useState)(!1),[v,k]=(0,o.useState)(b),x=(0,o.useMemo)((()=>new p(a)),[a]),[M,T]=(0,o.useState)(!1);(0,o.useEffect)((()=>{const e=e=>{" "===e.key&&e.target&&(e.target.closest(".toastui-editor-defaultUI")||function(e,t){if(!e||!t)return!1;try{return e.classList&&"function"===typeof e.classList.contains?e.classList.contains(t):"string"===typeof e.className?(" "+e.className+" ").indexOf(" "+t+" ")>-1:e.className&&"object"===typeof e.className&&"string"===typeof e.className.baseVal?(" "+e.className.baseVal+" ").indexOf(" "+t+" ")>-1:(console.warn("hasClass: Encountered unexpected element.className type:",typeof e.className,"on element:",e),!1)}catch(n){return console.error("Error in hasClass function:",n,"Element:",e,"ClassName:",t),!1}}(e.target,"toastui-editor-contents"))&&e.stopPropagation()};return document.addEventListener("keydown",e,!0),()=>{document.removeEventListener("keydown",e,!0)}}),[]);const E=(0,o.useMemo)((()=>({preset:["#000000","#2c2c2c","#515151","#7b7b7b","#a8a8a8","#d9d9d9","#ffffff","#ff4747","#ff7575","#ff9d9d","#ffcece","#ff4500","#ff8142","#ffb47a","#ffd2a8","#ffdc3c","#ffe978","#fff2a8","#4a86e8","#7aa3ed","#a8c3f1","#cedef9","#6aa84f","#8dbd77","#b6d7a8","#d8e9cf","#9b30ff","#ac67f2","#cc99ff","#e6d4f9"]})),[]);(0,o.useEffect)((()=>{if(!y.current||!h)return;const e=y.current.getInstance();if(!e)return;const t=t=>{k(t);try{var n;const o=null===(n=y.current)||void 0===n?void 0:n.getRootElement(),r=null===o||void 0===o?void 0:o.querySelector("markdown"===t?".toastui-editor-ww-container":".toastui-editor-md-container"),a=(null===r||void 0===r?void 0:r.scrollTop)||0,i=null===o||void 0===o?void 0:o.querySelectorAll(".katex-wrapper, .iframe-container");null===i||void 0===i||i.forEach((e=>{e instanceof HTMLElement&&(e.style.opacity="0.5",e.style.transition="opacity 0.3s ease")})),setTimeout((()=>{try{"markdown"===t?e.getHTML():e.getMarkdown();"markdown"===t?e.setMarkdown(e.getMarkdown()):e.setHTML(e.getHTML()),setTimeout((()=>{try{const e=null===o||void 0===o?void 0:o.querySelector("markdown"===t?".toastui-editor-md-container":".toastui-editor-ww-container");e&&(e.scrollTop=a);const n=null===o||void 0===o?void 0:o.querySelectorAll(".katex-wrapper, .iframe-container");null===n||void 0===n||n.forEach((e=>{e instanceof HTMLElement&&(e.style.opacity="1")}))}catch(e){console.warn("\u6062\u590d\u6eda\u52a8\u4f4d\u7f6e\u65f6\u51fa\u9519:",e)}}),50)}catch(n){console.error("\u8bbe\u7f6e\u5185\u5bb9\u65f6\u51fa\u9519:",n)}}),20)}catch(o){console.error("\u6a21\u5f0f\u5207\u6362\u5904\u7406\u65f6\u51fa\u9519:",o)}};return e.on&&e.on("changeMode",t),()=>{e.off&&e.off("changeMode",t)}}),[h]),(0,o.useEffect)((()=>{if(!y.current||!h)return;const e=f((()=>{document.querySelectorAll(".toastui-editor-dropdown-toolbar .toastui-editor-dropdown-toolbar-item").forEach((e=>{e instanceof HTMLElement&&(e.style.color="#333",e.style.fontWeight="normal")})),document.querySelectorAll(".toastui-editor-context-menu").forEach((e=>{const t=e.querySelectorAll("li"),n=new Set;t.forEach((e=>{var t;const o=(null===(t=e.textContent)||void 0===t?void 0:t.trim())||"";n.has(o)?e.remove():(n.add(o),e instanceof HTMLElement&&(e.style.color="#333"))}))}))}),50);e();const t=y.current.getInstance();t&&t.on&&t.on("changeMode",e);const n=()=>e();return document.addEventListener("click",n),()=>{t&&t.off&&t.off("changeMode",e),document.removeEventListener("click",n)}}),[h]),(0,o.useEffect)((()=>{const e=document.createElement("style");return e.textContent="\n      /* \u4fee\u590d\u6807\u9898\u4e0b\u62c9\u83dc\u5355\u989c\u8272\u95ee\u9898 */\n      .toastui-editor-dropdown-toolbar .toastui-editor-dropdown-toolbar-item {\n        color: #333 !important;\n        font-weight: normal !important;\n      }\n      \n      /* \u6807\u9898\u9009\u9879\u60ac\u505c\u6548\u679c */\n      .toastui-editor-dropdown-toolbar .toastui-editor-dropdown-toolbar-item:hover {\n        background-color: #f1f3f5 !important;\n      }\n      \n      /* \u4fee\u590d\u4e0b\u62c9\u83dc\u5355\u7bad\u5934\u989c\u8272 */\n      .toastui-editor-toolbar .toastui-editor-toolbar-icons.heading::after {\n        border-top-color: #333 !important;\n      }\n\n      /* KaTeX\u76f8\u5173\u6837\u5f0f */\n      .katex-wrapper {\n        margin: 1.5em 0;\n        overflow-x: auto;\n        background-color: #f8f9fa;\n        padding: 15px;\n        border-radius: 4px;\n        border-left: 4px solid #4b7bec;\n        transition: opacity 0.3s ease, transform 0.2s ease;\n        opacity: 1;\n        transform: translateY(0);\n      }\n      \n      .katex-wrapper.rendering {\n        opacity: 0.7;\n        transform: translateY(5px);\n      }\n      \n      .katex-error {\n        margin: 1.5em 0;\n        padding: 15px;\n        color: #e74c3c;\n        background-color: #fdecea;\n        border-radius: 4px;\n        border-left: 4px solid #e74c3c;\n        font-family: monospace;\n        white-space: pre-wrap;\n        transition: opacity 0.3s ease;\n      }\n      \n      /* \u89c6\u9891\u548ciframe\u76f8\u5173\u6837\u5f0f */\n      .toastui-editor-contents iframe, \n      .article-content iframe {\n        max-width: 100%;\n        width: 560px;\n        height: 315px;\n        border: none;\n        margin: 1.5em 0;\n        display: block;\n        /* \u7981\u6b62\u81ea\u52a8\u64ad\u653e\u7684\u5173\u952e\u6837\u5f0f */\n        visibility: visible !important;\n        pointer-events: auto !important;\n        transition: opacity 0.5s ease, transform 0.3s ease;\n        will-change: opacity;\n        transform: translateZ(0);\n      }\n      \n      /* \u5168\u7ad9iframe\u9632\u81ea\u52a8\u64ad\u653e\u4fdd\u62a4 */\n      iframe[src*=\"bilibili.com\"],\n      iframe[src*=\"youtube.com\"] {\n        autoplay: false !important;\n        allow: clipboard-write; encrypted-media; gyroscope; picture-in-picture !important;\n      }\n      \n      /* iframe\u5bb9\u5668\u6837\u5f0f\u589e\u5f3a */\n      .iframe-container {\n        position: relative;\n        margin: 1.5em 0;\n        padding-top: 56.25%;\n        height: 0;\n        overflow: hidden;\n        /* \u589e\u52a0\u9632\u81ea\u52a8\u64ad\u653e\u4fdd\u62a4\u5c42 */\n        isolation: isolate;\n        transition: opacity 0.5s ease, transform 0.3s ease;\n      }\n      \n      .iframe-container iframe {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        border: 0;\n        /* \u786e\u4fddiframe\u4e0d\u88ab\u9690\u85cf\u5143\u7d20\u8986\u76d6\u89e6\u53d1\u81ea\u52a8\u64ad\u653e */\n        z-index: 1;\n        transition: opacity 0.3s ease;\n      }\n      \n      /* \u89c6\u9891\u548cLaTeX\u5360\u4f4d\u7b26\u6837\u5f0f */\n      .video-placeholder,\n      .latex-placeholder {\n        padding: 15px;\n        background: #f8f9fa;\n        border-radius: 4px;\n        margin: 1.5em 0;\n        text-align: center;\n        border-left: 4px solid #4b7bec;\n        transition: opacity 0.3s ease, transform 0.2s ease;\n      }\n      \n      .video-placeholder-content,\n      .latex-placeholder-content {\n        color: #4b7bec;\n        font-style: italic;\n      }\n      \n      /* \u5e73\u6ed1\u6e32\u67d3\u8fc7\u6e21\u6548\u679c */\n      @keyframes fadeIn {\n        from { opacity: 0; transform: translateY(5px); }\n        to { opacity: 1; transform: translateY(0); }\n      }\n      \n      .toastui-editor-contents .katex-wrapper,\n      .toastui-editor-contents .iframe-container {\n        animation: fadeIn 0.3s ease-out forwards;\n        will-change: opacity, transform;\n        backface-visibility: hidden;\n        transform: translateZ(0);\n      }\n      \n      /* \u907f\u514d\u5728\u7f16\u8f91\u5668\u4e2d\u7684\u6e32\u67d3\u95ea\u70c1 */\n      .ProseMirror-hideselection .katex-wrapper,\n      .ProseMirror-hideselection .iframe-container {\n        transition: none !important;\n        animation: none !important;\n      }\n      \n      /* \u81ea\u5b9a\u4e49\u6309\u94ae\u6837\u5f0f */\n      .custom-toolbar-button {\n        display: inline-flex !important;\n        align-items: center !important;\n        justify-content: center !important;\n        width: 32px;\n        height: 32px;\n        margin: 0 3px;\n        border-radius: 4px;\n        background-color: transparent;\n        border: 1px solid transparent;\n        color: #333 !important;\n        font-family: 'Times New Roman', serif;\n        font-weight: bold;\n        font-size: 14px;\n        cursor: pointer;\n        position: relative;\n        overflow: hidden;\n        padding: 0;\n        box-shadow: none;\n        text-shadow: none;\n        outline: none;\n        -webkit-appearance: none;\n        -moz-appearance: none;\n        appearance: none;\n        /* \u9632\u6b62\u6309\u94ae\u89e6\u53d1\u8868\u5355\u63d0\u4ea4 */\n        pointer-events: auto;\n        user-select: none;\n        touch-action: manipulation;\n      }\n      \n      .custom-toolbar-button:hover {\n        background-color: #f1f3f5;\n        border-color: #dee2e6;\n      }\n      \n      /* \u7f16\u8f91\u5668\u5360\u4f4d\u7b26\u6837\u5f0f */\n      .toastui-editor .ProseMirror::before,\n      .toastui-editor .ProseMirror .placeholder::before {\n        color: #adb5bd !important;\n        font-style: italic;\n        opacity: 0.8;\n      }\n      \n      /* \u4e0a\u4f20\u4e2d\u52a8\u753b */\n      .image-uploading {\n        position: relative;\n      }\n      \n      .image-uploading:after {\n        content: '\u4e0a\u4f20\u4e2d...';\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background-color: rgba(255, 255, 255, 0.7);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 14px;\n        color: #4b7bec;\n      }\n      \n      /* \u6587\u4ef6\u9009\u62e9\u6309\u94ae\u4f18\u5316 */\n      .toastui-editor-file-select-button {\n        position: relative;\n        overflow: hidden;\n      }\n      \n      .toastui-editor-file-select-button input[type=file] {\n        position: absolute;\n        top: 0;\n        right: 0;\n        min-width: 100%;\n        min-height: 100%;\n        font-size: 100px;\n        text-align: right;\n        filter: alpha(opacity=0);\n        opacity: 0;\n        outline: none;\n        background: white;\n        cursor: pointer;\n        display: block;\n      }\n      \n      /* \u9632\u6b62\u6309\u94ae\u8bef\u89e6\u53d1\u8868\u5355\u63d0\u4ea4\u7684\u9632\u62a4\u5c42 */\n      .toast-editor-container {\n        position: relative;\n        z-index: 1;\n        /* \u9632\u6b62\u7f16\u8f91\u5668\u5185\u7684\u70b9\u51fb\u4f20\u9012\u5230\u5916\u90e8 */\n        isolation: isolate;\n      }\n      \n      /* \u786e\u4fdd\u6309\u94ae\u4e0d\u4f1a\u89e6\u53d1\u4efb\u4f55\u7956\u5148\u5143\u7d20\u7684\u8868\u5355\u63d0\u4ea4 */\n      .toastui-editor-toolbar button {\n        pointer-events: auto;\n        user-select: none;\n        touch-action: manipulation;\n      }\n      \n      /* \u5176\u4ed6\u7f16\u8f91\u5668\u4fee\u590d */\n      .empty-node-placeholder {\n        display: none !important;\n      }\n      \n      .toastui-editor-context-menu .toastui-editor-dropdown-menu li {\n        color: #333 !important;\n        font-weight: normal !important;\n      }\n      \n      .toastui-editor-context-menu .toastui-editor-dropdown-menu li a {\n        color: #333 !important;\n      }\n      \n      .toastui-editor-toolbar-item {\n        position: relative;\n      }\n      \n      .toastui-editor-context-menu .toastui-editor-dropdown-menu li:nth-child(n+7):nth-child(-n+8) {\n        display: none !important;\n      }\n\n      /* --- Editor Background & Theme Harmonization --- */\n      /* \u7edf\u4e00\u7f16\u8f91\u5668\u80cc\u666f\u4e3a\u767d\u8272 */\n      .toastui-editor-ww-container .ProseMirror,\n      .toastui-editor-md-container .toastui-editor,\n      .toastui-editor-md-preview {\n        background-color: #ffffff !important; \n        color: #333333 !important; /* \u786e\u4fdd\u6587\u672c\u5728\u767d\u8272\u80cc\u666f\u4e0a\u53ef\u89c1 */\n      }\n\n      /* \u8c03\u6574\u7f16\u8f91\u5668\u8fb9\u6846\u989c\u8272\u4ee5\u9002\u5e94\u6d45\u8272\u4e3b\u9898 */\n      .toastui-editor-defaultUI {\n        border: 1px solid #d1d5db !important; /* \u66f4\u6d45\u7684\u8fb9\u6846 */\n      }\n\n      /* \u8c03\u6574\u5de5\u5177\u680f\u80cc\u666f\u548c\u8fb9\u6846 */\n      .toastui-editor-toolbar {\n         background-color: #f9fafb !important; /* \u6d45\u7070\u8272\u5de5\u5177\u680f */\n         border-bottom: 1px solid #d1d5db !important;\n      }\n\n      /* \u8c03\u6574\u5de5\u5177\u680f\u56fe\u6807\u989c\u8272 */\n      .toastui-editor-toolbar-icons {\n          color: #374151 !important; /* \u6df1\u7070\u8272\u56fe\u6807 */\n      }\n      .toastui-editor-toolbar-icons:hover {\n          background-color: #e5e7eb !important; /* \u8f7b\u5fae\u60ac\u505c\u6548\u679c */\n      }\n      .toastui-editor-toolbar-icons.active {\n          background-color: #d1d5db !important; /* \u6fc0\u6d3b\u72b6\u6001 */\n      }\n      \n      /* \u8c03\u6574\u81ea\u5b9a\u4e49\u6309\u94ae\u6837\u5f0f\u4ee5\u9002\u5e94\u6d45\u8272\u4e3b\u9898 */\n      .custom-toolbar-button {\n         color: #374151 !important;\n         border: 1px solid transparent;\n      }\n      .custom-toolbar-button:hover {\n         background-color: #e5e7eb !important; \n         border-color: #d1d5db !important;\n      }\n\n      /* \u8c03\u6574\u6a21\u5f0f\u5207\u6362\u6309\u94ae\u6837\u5f0f */\n      .toastui-editor-mode-switch {\n         background-color: #f9fafb !important; \n         border-top: 1px solid #d1d5db !important;\n      }\n      .toastui-editor-mode-switch .toastui-editor-mode-switch-button {\n         color: #374151 !important;\n         border: 1px solid #d1d5db !important;\n         background-color: #ffffff !important;\n      }\n      .toastui-editor-mode-switch .toastui-editor-mode-switch-button.active {\n         background-color: #e5e7eb !important; \n         color: #1f2937 !important;\n      }\n      /* --- End Editor Background & Theme Harmonization --- */\n    ",document.head.appendChild(e),()=>{document.head.removeChild(e)}}),[]);const L=(0,o.useCallback)((async(e,t)=>{try{if(M)return console.warn("\u5df2\u6709\u56fe\u7247\u6b63\u5728\u4e0a\u4f20\u4e2d\uff0c\u8bf7\u7b49\u5f85\u5b8c\u6210"),void t("","image");let o;if(T(!0),o=e instanceof File?e:new File([e],`clipboard_image_${Date.now()}.png`,{type:e.type||"image/png"}),o.size>x.maxFileSize)return alert(`\u56fe\u7247\u592a\u5927\uff0c\u8bf7\u4e0a\u4f20\u5c0f\u4e8e10MB\u7684\u56fe\u7247\uff08\u5f53\u524d\u5927\u5c0f: ${(o.size/1048576).toFixed(2)}MB\uff09`),T(!1),void t("","image");try{t(await x.upload(o),"image")}catch(n){console.error("\u56fe\u7247\u4e0a\u4f20\u5931\u8d25:",n),alert(`\u56fe\u7247\u4e0a\u4f20\u5931\u8d25: ${n.message||"\u672a\u77e5\u9519\u8bef"}`),t("","image")}finally{T(!1)}}catch(n){console.error("\u5904\u7406\u56fe\u7247\u4e0a\u4f20\u9519\u8bef:",n),T(!1),t("","image")}}),[M,x]);(0,o.useEffect)((()=>{if(!h||!y.current)return;const e=y.current.getRootElement();if(!e)return;const t=e.querySelector(".toastui-editor-toolbar-item.toastui-editor-toolbar-image");if(!t)return;const n=e=>{e.stopPropagation(),e.preventDefault();const t=document.createElement("input");t.type="file",t.accept="image/*",t.style.position="absolute",t.style.opacity="0",t.style.visibility="hidden",document.body.appendChild(t),requestAnimationFrame((()=>{t.click()})),t.onchange=async()=>{if(!t.files||!t.files[0])return void document.body.removeChild(t);const e=t.files[0];if(e.size>x.maxFileSize)return alert(`\u56fe\u7247\u592a\u5927\uff0c\u8bf7\u4e0a\u4f20\u5c0f\u4e8e10MB\u7684\u56fe\u7247\uff08\u5f53\u524d\u5927\u5c0f: ${(e.size/1048576).toFixed(2)}MB\uff09`),void document.body.removeChild(t);T(!0);try{const t=await x.upload(e);if(t&&y.current){const n=y.current.getInstance();n.isMarkdownMode()?n.insertText(`![${e.name}](${t})`):"function"===typeof n.insertHTML&&n.insertHTML(`<img src="${t}" alt="${e.name}">`)}}catch(n){console.error("\u56fe\u7247\u4e0a\u4f20\u5931\u8d25:",n),alert(`\u56fe\u7247\u4e0a\u4f20\u5931\u8d25: ${n.message||"\u672a\u77e5\u9519\u8bef"}`)}finally{T(!1),document.body.removeChild(t)}}};return t.addEventListener("click",n,!0),()=>{t.removeEventListener("click",n,!0)}}),[h,x]),(0,o.useEffect)((()=>{if(!h||!y.current)return;const e=y.current.getInstance();if(!e)return;const t=f((()=>{try{var e;const t=null===(e=y.current)||void 0===e?void 0:e.getRootElement();if(!t)return;const n=t.querySelectorAll("iframe");if(0===n.length)return;n.forEach((e=>{const t=e.parentElement;t&&Array.from(t.childNodes).forEach((e=>{var n;if(e.nodeType===Node.TEXT_NODE&&""===(null===(n=e.textContent)||void 0===n?void 0:n.trim())){const n=document.createElement("span");n.className="empty-node-placeholder",n.style.display="none",t.replaceChild(n,e)}}))}))}catch(t){console.warn("\u4fee\u590d\u7f16\u8f91\u5668\u5185\u5bb9\u65f6\u51fa\u9519:",t)}}),100);return e.on&&e.on("change",t),()=>{e.off&&e.off("change",t)}}),[h]);const $=(0,o.useCallback)((()=>{var e;const t=null===(e=y.current)||void 0===e?void 0:e.getInstance();if(!t)return void alert("\u65e0\u6cd5\u83b7\u53d6\u7f16\u8f91\u5668\u5b9e\u4f8b (LaTeX)");const n=["$$latex","f(x) = \\int_{-\\infty}^\\infty \\hat f(\\xi)\\,e^{2 \\pi i \\xi x} \\, d\\xi","$$"].join("\n");try{if(t.isMarkdownMode())t.insertText(`\n${n}\n`);else{const e=t.getMarkdown();t.setMarkdown(e+`\n${n}\n`)}}catch(o){console.error("\u63d2\u5165LaTeX\u65f6\u51fa\u9519:",o),alert("\u63d2\u5165LaTeX\u5931\u8d25\uff0c\u8bf7\u624b\u52a8\u590d\u5236:\n"+n)}}),[y]),N=(0,o.useCallback)((()=>{var e;const t=null===(e=y.current)||void 0===e?void 0:e.getInstance();if(!t)return void alert("\u65e0\u6cd5\u83b7\u53d6\u7f16\u8f91\u5668\u5b9e\u4f8b (Video)");const n=prompt("\u8bf7\u8f93\u5165\u89c6\u9891\u94fe\u63a5 (\u652f\u6301YouTube\u548cBilibili):","");if(!n)return;const o=m.parseVideoUrl(n);if(o.platform===u.Unknown)return void alert("\u65e0\u6cd5\u8bc6\u522b\u7684\u89c6\u9891\u94fe\u63a5");const r=m.generateEmbedCode(o);if(r)try{const e="\n"+r+"\n",o=`\n[\u89c6\u9891\u5360\u4f4d\u7b26: ${n}]\n`;t.isMarkdownMode()?t.insertText(e):(t.insertText(o),console.log("WYSIWYG: Video placeholder inserted."))}catch(a){console.error("\u63d2\u5165\u89c6\u9891\u65f6\u51fa\u9519:",a),alert("\u63d2\u5165\u89c6\u9891\u5931\u8d25\uff0c\u8bf7\u624b\u52a8\u590d\u5236:\n"+r)}else alert("\u751f\u6210\u5d4c\u5165\u4ee3\u7801\u5931\u8d25")}),[y]),S=(0,o.useCallback)((()=>{if(!y.current)return;w(!0);const e=y.current.getInstance();if(e){if(t)try{setTimeout((()=>{try{console.log("[ToastEditor] Forcing content re-process as Markdown on load.");const t=e.getMarkdown();e.setMarkdown(t),console.log("[ToastEditor] Content re-processed as Markdown.")}catch(t){console.error("[ToastEditor] Error forcing content re-process as Markdown:",t)}}),100)}catch(n){console.error("[ToastEditor] Error accessing editor instance for re-processing:",n)}try{setTimeout((()=>{try{if(e.isMarkdownMode()){const t=e.getMarkdown(),n=t.replace(/^(\u7f16\u8f91|\u9884\u89c8|Markdown|\u6240\u89c1\u5373\u6240\u5f97)\s*/g,"").trim();t!==n&&e.setMarkdown(n)}else{const t=e.getHTML(),n=t.replace(/<p>(\u7f16\u8f91|\u9884\u89c8|Markdown|\u6240\u89c1\u5373\u6240\u5f97)(<br>|\s)*<\/p>/g,"").replace(/<p><br><\/p>/g,"").trim();t!==n&&n&&e.setHTML(n)}}catch(t){console.warn("\u6e05\u7406\u7f16\u8f91\u5668\u5185\u5bb9\u65f6\u51fa\u9519:",t)}}),50);const t=y.current.getRootElement();if(t){t.querySelectorAll(".placeholder").forEach((e=>{e instanceof HTMLElement&&(e.style.color="#adb5bd",e.style.fontStyle="italic",e.style.opacity="0.8")}))}}catch(o){console.warn("\u8bbe\u7f6eplaceholder\u6837\u5f0f\u65f6\u51fa\u9519:",o)}i&&i(e)}}),[i,t]),C=(0,o.useMemo)((()=>f((e=>{n(e)}),300)),[n]),z=(0,o.useCallback)((()=>{if(y.current)try{const e=y.current.getInstance();if(!e)return;const t=e.getMarkdown();C(t)}catch(e){console.error("\u5904\u7406\u7f16\u8f91\u5668\u5185\u5bb9\u53d8\u5316\u65f6\u51fa\u9519:",e)}}),[C]),I=(0,o.useMemo)((()=>({latex(e){try{if(!e||!e.literal)return[{type:"openTag",tagName:"div",outerNewLine:!0,attributes:{class:"katex-error"}},{type:"text",content:"\u65e0\u6548\u7684LaTeX\u516c\u5f0f"},{type:"closeTag",tagName:"div",outerNewLine:!0}];let n=e.literal.trim();n=n.replace(/\\documentclass\{article\}|\\begin\{document\}|\\end\{document\}/g,"").trim();const o=n.match(/\$([\s\S]*?)\$/)||n.match(/\$\$([\s\S]*?)\$\$/);o&&o[1]&&(n=o[1].trim()),n=n.replace(/\\\\([a-zA-Z]+)/g,"\\$1");const r={throwOnError:!1,errorColor:"#e74c3c",displayMode:!0,strict:!1,trust:!0,maxSize:200,maxExpand:1e3,output:"html"};try{const e=s.Ay.renderToString(n,r);return[{type:"openTag",tagName:"div",outerNewLine:!0,attributes:{class:"katex-wrapper","data-katex-source":n.replace(/"/g,"&quot;"),style:"opacity: 0; animation: fadeIn 0.4s ease-out 0.1s forwards; transform: translateZ(0);"}},{type:"html",content:e},{type:"closeTag",tagName:"div",outerNewLine:!0}]}catch(t){return console.error("KaTeX\u6e32\u67d3\u9519\u8bef:",t),[{type:"openTag",tagName:"div",outerNewLine:!0,attributes:{class:"katex-error",style:"animation: fadeIn 0.3s ease-out forwards;"}},{type:"text",content:`LaTeX\u6e32\u67d3\u9519\u8bef: ${t.message||"\u672a\u77e5\u9519\u8bef"}\n\n\u8bf7\u68c0\u67e5\u516c\u5f0f\u8bed\u6cd5\u3002\u539f\u59cb\u516c\u5f0f:\n${n.slice(0,100)}${n.length>100?"...":""}`},{type:"closeTag",tagName:"div",outerNewLine:!0}]}}catch(n){return console.error("LaTeX\u5904\u7406\u9519\u8bef:",n),[{type:"openTag",tagName:"div",outerNewLine:!0,attributes:{class:"katex-error"}},{type:"text",content:`LaTeX\u5904\u7406\u9519\u8bef: ${n.message||"\u672a\u77e5\u9519\u8bef"}\n\u8bf7\u5c1d\u8bd5\u5237\u65b0\u9875\u9762\u6216\u51cf\u5c11\u516c\u5f0f\u590d\u6742\u5ea6\u3002`},{type:"closeTag",tagName:"div",outerNewLine:!0}]}},htmlBlock:{iframe(e){try{if(!e||"object"!==typeof e)throw new Error("\u65e0\u6548\u7684\u8282\u70b9\u5bf9\u8c61");const t=e.attrs?{...e.attrs}:{};if(t.src||console.warn("iframe\u7f3a\u5c11src\u5c5e\u6027:",t),t.allowfullscreen="true",t.allow="clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen",t.frameborder||(t.frameborder="0"),t.loading="lazy",t.scrolling="no",t.referrerpolicy="no-referrer-when-downgrade",t.style="opacity: 0; transition: opacity 0.5s ease;",t.onload="this.style.opacity=1;",t.src){if(t.src.includes("youtube.com")){const e=t.src.split("?")[0],n=new URLSearchParams(t.src.includes("?")?t.src.split("?")[1]:"");n.set("autoplay","0"),n.set("mute","0"),n.set("controls","1"),t.src=`${e}?${n.toString()}`}if(t.src.includes("bilibili.com")){const e=t.src.split("?")[0],n=new URLSearchParams(t.src.includes("?")?t.src.split("?")[1]:"");n.set("autoplay","0"),n.set("danmaku","0"),n.set("high_quality","0"),n.set("as_wide","0"),t.src=`${e}?${n.toString()}`}}return[{type:"openTag",tagName:"iframe",outerNewLine:!0,attributes:t},{type:"closeTag",tagName:"iframe",outerNewLine:!0}]}catch(t){return console.error("iframe\u6e32\u67d3\u9519\u8bef:",t),[{type:"openTag",tagName:"div",outerNewLine:!0,attributes:{class:"video-error"}},{type:"text",content:`\u89c6\u9891\u6e32\u67d3\u9519\u8bef: ${t.message||"\u672a\u77e5\u9519\u8bef"}`},{type:"closeTag",tagName:"div",outerNewLine:!0}]}}}})),[]);return(0,o.useEffect)((()=>{if(!h||!y.current)return;const e=()=>{try{const e=y.current.getInstance();if(!e)return;let t=e.isMarkdownMode()?e.getMarkdown():e.getHTML();const n=[/^(\u7f16\u8f91|\u9884\u89c8)\s*$/m,/^(Markdown|\u6240\u89c1\u5373\u6240\u5f97)\s*$/m,/<p>(\u7f16\u8f91|\u9884\u89c8|Markdown|\u6240\u89c1\u5373\u6240\u5f97)(<br>|\s)*<\/p>/g,/\u7f16\u8f91\s*\u9884\u89c8/g,/Markdown\s*\u6240\u89c1\u5373\u6240\u5f97/g,/<div>(\u7f16\u8f91|\u9884\u89c8|Markdown|\u6240\u89c1\u5373\u6240\u5f97)(<br>|\s)*<\/div>/g,/<[^>]*>(\u7f16\u8f91|\u9884\u89c8|Markdown|\u6240\u89c1\u5373\u6240\u5f97)(<br>|\s)*<\/[^>]*>/g];let o=!1;for(const r of n)if(r.test(t)){o=!0;break}o&&setTimeout((()=>{try{t=e.isMarkdownMode()?e.getMarkdown():e.getHTML();let o=t;for(const e of n)o=o.replace(e,"");o=o.replace(/^\s*[\r\n]/gm,"").trim(),o=o.replace(/(<p>\s*<\/p>)+/g,"<p></p>"),o!==t&&(console.log("\u6e05\u7406\u7f16\u8f91\u5668UI\u6587\u672c\u5143\u7d20"),e.isMarkdownMode()?e.setMarkdown(o):e.setHTML(o||"<p></p>"),setTimeout((()=>{try{e.focus()}catch(t){console.warn("\u805a\u7126\u7f16\u8f91\u5668\u5931\u8d25:",t)}}),50))}catch(o){console.warn("\u4fee\u590d\u7f16\u8f91\u5668\u5185\u5bb9\u65f6\u51fa\u9519:",o)}}),200)}catch(e){console.warn("\u68c0\u67e5\u7f16\u8f91\u5668\u5185\u5bb9\u65f6\u51fa\u9519:",e)}};e();const t=y.current.getInstance();return t&&t.on&&(t.on("changeMode",e),t.on("load",(()=>{setTimeout(e,300)}))),()=>{t&&t.off&&(t.off("changeMode",e),t.off("load",e))}}),[h]),(0,d.jsx)("div",{className:"toast-editor-container",onClick:e=>{e.stopPropagation()},onSubmit:e=>(e.preventDefault(),!1),children:(0,d.jsx)(r.K,{ref:y,initialValue:t,previewStyle:"vertical",height:c,initialEditType:b,useCommandShortcut:!0,usageStatistics:!1,hideModeSwitch:!1,language:"zh-CN",toolbarItems:[["heading","bold","italic","strike"],["hr","quote"],["ul","ol","task","indent","outdent"],["table","image","link"],["code","codeblock"],[{name:"customDivider",el:g(),tooltip:""},{name:"customLatexButton",tooltip:"\u63d2\u5165LaTeX\u516c\u5f0f",el:(()=>{const e=document.createElement("button");return e.className="toastui-editor-toolbar-icons custom-latex-button",e.textContent="\u2211",e.type="button",e.style.fontSize="18px",e.style.margin="0 2px",e.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),$()})),e})()},{name:"customVideoButton",tooltip:"\u63d2\u5165\u89c6\u9891",el:(()=>{const e=document.createElement("button");return e.className="toastui-editor-toolbar-icons custom-video-button",e.textContent="\u25b6",e.type="button",e.style.fontSize="16px",e.style.margin="0 2px",e.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),N()})),e})()}]],plugins:[[l(),E]],hooks:{addImageBlobHook:L},onChange:z,onLoad:S,customHTMLRenderer:I})})},y=e=>{let{initialData:t="",onChange:n,token:o,onReady:r,placeholder:a="\u8bf7\u8f93\u5165\u5185\u5bb9"}=e;return(0,d.jsx)("div",{className:"toast-editor-wrapper",children:(0,d.jsx)(b,{initialData:t,onChange:n,token:o,onReady:r,placeholder:a,height:"400px",initialEditType:"wysiwyg"})})}}}]);
//# sourceMappingURL=745.606b7461.chunk.js.map