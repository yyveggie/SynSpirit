"use strict";(self.webpackChunkai_tools_website_frontend=self.webpackChunkai_tools_website_frontend||[]).push([[512],{8512:(e,t,a)=>{a.r(t),a.d(t,{default:()=>p});var o=a(5043),i=a(3216),n=a(4558),s=a(6625),r=a(1745),l=a(6213),d=a(6636),c=a(3248),u=a(579);const p=()=>{const{community_slug:e}=(0,i.g)(),[t,a]=(0,o.useState)(""),[p,g]=(0,o.useState)(""),[m,h]=(0,o.useState)(""),[f,y]=(0,o.useState)(null),[x,b]=(0,o.useState)(null),[v,w]=(0,o.useState)(!1),{isSidebarOpen:j}=(0,d.c)(),N=(0,i.Zp)(),{token:_}=(0,s.A)(),S=(0,c.jE)(),[$,k]=(0,o.useState)(null),[A,C]=(0,o.useState)(null);(0,o.useEffect)((()=>{(async()=>{if(e)try{const t=await l.A.get(`${n.JR}/api/slug/${e}`);t.data&&t.data.name&&(h(t.data.name),k("topic"),C(t.data.id),console.log("\u83b7\u53d6\u5230\u4e3b\u9898\u6570\u636e:",t.data))}catch(t){console.log("\u4e3b\u9898\u83b7\u53d6\u5931\u8d25\uff0c\u5c1d\u8bd5\u83b7\u53d6\u5173\u7cfb\u4e3b\u9898");try{const t=await l.A.get(`${n.JR}/api/relationship-topics/slug/${e}`);t.data&&t.data.name?(h(t.data.name),k("relationship_topic"),C(t.data.id),console.log("\u83b7\u53d6\u5230\u5173\u7cfb\u4e3b\u9898\u6570\u636e:",t.data)):y("\u65e0\u6cd5\u4ece\u670d\u52a1\u5668\u83b7\u53d6\u793e\u533a\u540d\u79f0")}catch(a){console.error("\u65e0\u6cd5\u83b7\u53d6\u793e\u533a\u4fe1\u606f:",a),y("\u65e0\u6cd5\u52a0\u8f7d\u793e\u533a\u4fe1\u606f")}}else y("\u65e0\u6548\u7684\u793e\u533a\u6807\u8bc6\u7b26")})()}),[e]),(0,o.useEffect)((()=>{_||(console.log("No token found, redirecting to login"),N("/login",{state:{from:`/community/${e}/new-post-toast`}}))}),[_,N,e]);return(0,u.jsx)("div",{className:"flex flex-col min-h-screen bg-transparent text-gray-100",children:(0,u.jsx)("div",{className:"flex flex-1 pt-12",children:(0,u.jsxs)("main",{className:"flex-1 p-3 overflow-y-auto transition-all duration-300 "+(j?"lg:ml-64":"ml-0"),children:[(0,u.jsxs)("h1",{className:"text-3xl font-bold mb-2 text-gray-100",children:['\u5728 "',m||e,'" \u4e2d\u521b\u5efa\u65b0\u5e16\u5b50']}),f&&(0,u.jsx)("div",{className:"bg-red-700 text-white p-3 rounded mb-3",children:f}),x&&(0,u.jsx)("div",{className:"bg-green-700 text-white p-3 rounded mb-3",children:x}),(0,u.jsxs)("form",{onSubmit:async o=>{if(o.preventDefault(),!_)return void y("\u9700\u8981\u767b\u5f55\u624d\u80fd\u53d1\u5e16\u3002");if(!e)return void y("\u65e0\u6548\u7684\u793e\u533a\u6807\u8bc6\u3002");if(!A||!$)return void y("\u65e0\u6cd5\u786e\u5b9a\u793e\u533a\u4fe1\u606f\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u91cd\u8bd5\u3002");w(!0),y(null),b(null);const i=new FormData;i.append("title",t),i.append("content",p),"topic"===$?i.append("topic_id",A.toString()):"relationship_topic"===$&&i.append("relationship_topic_id",A.toString());try{await l.A.post(`${n.JR}/api/posts/`,i,{headers:{Authorization:`Bearer ${_}`}});b("\u5e16\u5b50\u521b\u5efa\u6210\u529f!"),a(""),g("");const t="topic"===$?["topicPosts",e]:["relationshipTopicPosts",e];e?(console.log("[NewCommunityPostPageToast] Invalidating query cache for key:",t),await S.invalidateQueries({queryKey:t})):console.warn("[NewCommunityPostPageToast] community_slug is undefined, cannot invalidate query cache."),N("topic"===$?`/community/topic/${e}`:"relationship_topic"===$?`/community/relationship-topic/${e}`:e?`/community/${e}`:"/community")}catch(c){var s,r,d;console.error("Error creating post:",(null===(s=c.response)||void 0===s?void 0:s.data)||c.message),y((null===(r=c.response)||void 0===r||null===(d=r.data)||void 0===d?void 0:d.error)||"\u521b\u5efa\u5e16\u5b50\u5931\u8d25")}finally{w(!1)}},className:"bg-gray-850/70 p-3 rounded-lg shadow-xl border border-gray-700 backdrop-blur-sm",children:[(0,u.jsx)("div",{children:(0,u.jsx)("input",{type:"text",id:"title",value:t,onChange:e=>a(e.target.value),required:!0,className:"w-full p-2 border border-gray-600 rounded bg-gray-700 text-gray-100 focus:ring-indigo-500 focus:border-indigo-500 placeholder-gray-400",placeholder:"\u5e16\u5b50\u6807\u9898"})}),(0,u.jsx)("div",{className:"my-4",children:(0,u.jsx)("div",{className:"rounded bg-white",children:(0,u.jsx)(r.A,{initialData:p,onChange:e=>{g(e)},token:_,placeholder:"\u5206\u4eab\u4f60\u7684\u60f3\u6cd5..."})})}),(0,u.jsx)("div",{className:"flex justify-end mt-2",children:(0,u.jsx)("button",{type:"submit",disabled:v,className:`py-2 px-4 rounded font-medium ${v?"bg-gray-500 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700 focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"} text-white`,children:v?"\u53d1\u5e03\u4e2d...":"\u53d1\u5e03\u5e16\u5b50"})})]})]})})})}}}]);
//# sourceMappingURL=512.988991b5.chunk.js.map