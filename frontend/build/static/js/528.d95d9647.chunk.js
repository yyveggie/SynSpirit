"use strict";(self.webpackChunkai_tools_website_frontend=self.webpackChunkai_tools_website_frontend||[]).push([[528],{3528:(e,o,t)=>{t.r(o),t.d(o,{default:()=>h});var s=t(5043),i=t(3216),n=t(2358),a=t(6625),r=t(6636),c=t(3248),l=t(6213),u=t(8261),d=t(7097),g=t(4558),p=t(2115);var v=t(579);const h=()=>{const{topicSlug:e}=(0,i.g)(),o=(0,i.Zp)(),{user:t,token:h}=(0,a.A)(),{isSidebarOpen:T,toggleSidebar:f}=(0,r.c)(),m=(0,c.jE)(),{data:$,isLoading:w,isError:y,error:F}=(e=>{const o=["topicDetails",e];return(0,u.I)({queryKey:o,queryFn:async()=>{if(!e)throw new Error("\u65e0\u6548\u7684\u4e3b\u9898\u6807\u8bc6\u7b26");console.log(`[useTopicDetails] Fetching details for slug: ${e}`);const o=await l.A.get(`${g.JR}/api/slug/${e}`);if(!o.data||"object"!==typeof o.data||!o.data.id)throw new Error("\u4ece\u540e\u7aef\u83b7\u53d6\u7684\u4e3b\u9898\u6570\u636e\u683c\u5f0f\u4e0d\u6b63\u786e\u6216\u7f3a\u5c11 ID");return console.log("[useTopicDetails] Fetched details:",o.data),o.data},enabled:!!e,staleTime:9e5,gcTime:18e5,retry:(e,o)=>{var t;return 404!==(null===o||void 0===o||null===(t=o.response)||void 0===t?void 0:t.status)&&e<3}})})(e),{data:_,isLoading:D,isError:E,error:P}=(e=>{const o=["topicPosts",e];return(0,u.I)({queryKey:o,queryFn:async()=>{if(!e)return{posts:[],total:0};console.log(`[useTopicPosts] Fetching posts for slug: ${e}`);const o=(new Date).getTime(),t=`${g.JR}/api/topics/${e}/posts?fields=id,title,content,summary,category,tags,author,cover_image,slug,view_count,created_at,like_count,collect_count,share_count,comment_count&_=${o}`;console.log(`[useTopicPosts] Request URL: ${t}`);const s=await l.A.get(t,{headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}});if(s.data&&Array.isArray(s.data.posts)){const e=s.data.posts.filter((e=>!e.content));if(e.length>0)console.warn(`[useTopicPosts] \u8b66\u544a: ${e.length}/${s.data.posts.length} \u5e16\u5b50\u7f3a\u5c11content\u5b57\u6bb5`),e.length>0&&(console.warn(`[useTopicPosts] \u7b2c\u4e00\u4e2a\u7f3a\u5c11content\u7684\u5e16\u5b50ID: ${e[0].id}, \u6807\u9898: ${e[0].title}`),console.warn("[useTopicPosts] \u8be5\u5e16\u5b50\u6240\u6709\u5b57\u6bb5:",JSON.stringify(e[0],null,2)));else if(console.log(`[useTopicPosts] \u6240\u6709\u5e16\u5b50\u90fd\u5305\u542bcontent\u5b57\u6bb5\uff0c\u5171 ${s.data.posts.length} \u7bc7`),s.data.posts.length>0){var i;const e=s.data.posts[0];console.log(`[useTopicPosts] \u7b2c\u4e00\u4e2a\u5e16\u5b50ID: ${e.id}, \u6807\u9898: ${e.title}, content\u957f\u5ea6: ${(null===(i=e.content)||void 0===i?void 0:i.length)||0}`)}}return console.log("[useTopicPosts] Fetched posts:",s.data.posts),s.data},enabled:!!e,staleTime:3e5,gcTime:6e5,refetchOnMount:!0,refetchOnWindowFocus:!0})})(e),b=(null===_||void 0===_?void 0:_.posts)||[],I=(()=>{const e=(0,c.jE)();return(0,d.n)({mutationFn:async e=>{let{topicId:o,token:t,currentFavoriteState:s}=e;if(!t)throw new Error("\u7528\u6237\u672a\u767b\u5f55");const i={Authorization:`Bearer ${t}`},n=`${g.JR}/api/users/favorites/topics`;s?(console.log(`[useToggleTopicFavorite] Attempting DELETE for topic ID: ${o}`),await l.A.delete(`${n}/${o}`,{headers:i})):(console.log(`[useToggleTopicFavorite] Attempting POST for topic ID: ${o}`),await l.A.post(n,{topic_id:o},{headers:i}))},onSuccess:(o,t)=>{const s=t.currentFavoriteState?"\u53d6\u6d88\u6536\u85cf":"\u6536\u85cf";p.oR.success(`\u5df2${s} "${t.topicName}"`),console.log(`[useToggleTopicFavorite Success] Toggled favorite for Topic ID: ${t.topicId}`),e.invalidateQueries({queryKey:["userFavoritesList"]})},onError:(e,o)=>{console.error("[useToggleTopicFavorite Error]:",e),p.oR.error("\u64cd\u4f5c\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5")}})})(),S=w,A=y?(null===F||void 0===F?void 0:F.message)||"\u52a0\u8f7d\u4e3b\u9898\u8be6\u60c5\u65f6\u51fa\u9519":E?(null===P||void 0===P?void 0:P.message)||"\u52a0\u8f7d\u5e16\u5b50\u5217\u8868\u65f6\u51fa\u9519":null,k=(0,s.useCallback)((async()=>{if(!$||!t||I.isPending)return void console.log("[DEBUG] toggleFavorite called but prerequisite not met or mutation is pending.");const o=$.id,s=$.name,i=$.is_favorited||!1;I.mutate({topicId:o,token:h,currentFavoriteState:i,topicName:s},{onSuccess:()=>{console.log(`[Toggle Topic Favorite Success] Invalidating topicDetails for slug: ${e}`),m.invalidateQueries({queryKey:["topicDetails",e]})},onError:()=>{}})}),[$,t,h,I,m,e]),C=(0,s.useCallback)((()=>{$?o(`/community/${$.slug}/new-post`,{state:{topicId:$.id,topicName:$.name}}):console.error("\u65e0\u6cd5\u521b\u5efa\u5e16\u5b50\uff0c\u4e3b\u9898\u8be6\u60c5\u672a\u52a0\u8f7d\u3002",{topicDetails:$})}),[o,$]);return(0,v.jsx)(v.Fragment,{children:(0,v.jsx)(n.A,{isLoading:S,error:A,topicDetails:null!==$&&void 0!==$?$:null,posts:b,isLoadingPosts:D,parentType:"topic",parentSlug:null===$||void 0===$?void 0:$.slug,showFavoriteButton:!0,isFavorited:(null===$||void 0===$?void 0:$.is_favorited)||!1,isLoadingFavorite:I.isPending,onToggleFavorite:k,onCreatePost:C,showChatButton:!0,isChatAvailable:!0})})}}}]);
//# sourceMappingURL=528.d95d9647.chunk.js.map