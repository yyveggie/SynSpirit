{"version":3,"file":"static/js/237.c677bc5a.chunk.js","mappings":"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","sources":["components/ImageViewer.tsx","components/DynamicDetailView.tsx","pages/UserActivitiesPage.tsx"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport { createPortal } from 'react-dom';\n\ninterface ImageViewerProps {\n  images: string[];\n  initialIndex?: number;\n  onClose: () => void;\n  isOpen: boolean;\n}\n\n/**\n * 图片查看器组件\n * \n * 功能：\n * - 在当前视野中间显示图片，而非页面顶部\n * - 支持多图切换、放大缩小\n * - 严格限制图片大小，没有多余黑色边框\n * - 响应键盘操作\n */\nconst ImageViewer: React.FC<ImageViewerProps> = ({ images, initialIndex = 0, onClose, isOpen }) => {\n  const [currentIndex, setCurrentIndex] = useState(initialIndex);\n  \n  // 重置索引\n  useEffect(() => {\n    if (isOpen) {\n      setCurrentIndex(initialIndex);\n    }\n  }, [isOpen, initialIndex]);\n  \n  // 键盘事件\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') onClose();\n      else if (e.key === 'ArrowRight') nextImage();\n      else if (e.key === 'ArrowLeft') prevImage();\n    };\n    \n    if (isOpen) {\n      window.addEventListener('keydown', handleKeyDown);\n    }\n    \n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [isOpen, onClose]);\n  \n  // 导航函数\n  const nextImage = useCallback(() => {\n    setCurrentIndex(prev => (prev + 1) % images.length);\n  }, [images.length]);\n  \n  const prevImage = useCallback(() => {\n    setCurrentIndex(prev => (prev - 1 + images.length) % images.length);\n  }, [images.length]);\n  \n  if (!isOpen || !images.length) return null;\n  \n  // 卡片宽度 - 限制小一些\n  const cardWidth = 500; // 像素\n  \n  const viewerContent = (\n    <div\n      className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/75\"\n      onClick={onClose}\n    >\n      {/* 内容容器 */}\n      <div\n        className=\"relative bg-black p-1 sm:p-2 rounded-lg shadow-xl max-w-[95vw] sm:max-w-2xl md:max-w-3xl lg:max-w-4xl\"\n        onClick={e => e.stopPropagation()}\n      >\n        {/* 图片容器 */}\n        <div\n          className=\"flex items-center justify-center\"\n        >\n          <img\n            src={images[currentIndex]}\n            alt={`View ${currentIndex + 1} of ${images.length}`}\n            style={{\n              maxWidth: 'calc(100vw - 40px)',\n              maxHeight: 'calc(100vh - 80px)',\n              objectFit: 'contain',\n              borderRadius: '4px'\n            }}\n          />\n        </div>\n        \n        {images.length > 1 && (\n          <>\n            <button\n              aria-label=\"Previous image\"\n              className=\"absolute left-2 sm:left-3 top-1/2 -translate-y-1/2 w-10 h-10 flex items-center justify-center text-white text-3xl rounded-full bg-black/40 hover:bg-black/60 transition-all\"\n              onClick={e => { e.stopPropagation(); prevImage(); }}\n            >\n              &#8249;\n            </button>\n            \n            <button\n              aria-label=\"Next image\"\n              className=\"absolute right-2 sm:right-3 top-1/2 -translate-y-1/2 w-10 h-10 flex items-center justify-center text-white text-3xl rounded-full bg-black/40 hover:bg-black/60 transition-all\"\n              onClick={e => { e.stopPropagation(); nextImage(); }}\n            >\n              &#8250;\n            </button>\n            \n            <div\n              className=\"absolute bottom-2 sm:bottom-3 left-1/2 -translate-x-1/2 px-3 py-1 text-sm text-white bg-black/50 rounded-md\"\n            >\n              {currentIndex + 1} / {images.length}\n            </div>\n          </>\n        )}\n      </div>\n    </div>\n  );\n\n  return createPortal(viewerContent, document.body);\n};\n\nexport default ImageViewer; ","import React, { useState, useEffect, useCallback, useRef, useMemo } from 'react';\nimport { Link, useLocation } from 'react-router-dom';\nimport axios from 'axios';\nimport { API_BASE_URL } from '../config';\nimport { useAuth } from '../context/AuthContext';\nimport Modal from './Modal';\nimport QuotedDynamicView, { DynamicDetails } from './QuotedDynamicView';\nimport { toast } from 'react-toastify';\nimport ReactMarkdown from 'react-markdown';\nimport remarkGfm from 'remark-gfm';\nimport { FaRegCommentDots, FaRetweet, FaHeart, FaRegHeart, FaBookmark, FaRegBookmark, FaPaperPlane, FaSpinner, FaReply, FaTrashAlt, FaArrowRight, FaImage } from 'react-icons/fa';\nimport { IoMdClose } from 'react-icons/io';\nimport { BsArrowReturnRight, BsTrash } from 'react-icons/bs';\nimport UserAvatar from './UserAvatar';\nimport ImageViewer from './ImageViewer';\nimport ShareDynamicModal from './ShareDynamicModal';\n\nconst formatCommentDate = (dateString: string) => {\n  const date = new Date(dateString);\n  return date.toLocaleString('zh-CN', {\n    year: 'numeric',\n    month: 'numeric',\n    day: 'numeric',\n    hour: '2-digit',\n    minute: '2-digit'\n  });\n};\n\nconst generateTargetLink = (\n    type: string | undefined,\n    slug: string | null | undefined,\n    id: number | null | undefined\n): string | null => {\n    if (type === 'post') {\n        return slug ? `/posts/${slug}` : null;\n    }\n    if (type === 'article') {\n        return slug ? `/article/${slug}` : null;\n    }\n    if (type === 'tool') {\n        return slug ? `/tool/${slug}` : null;\n    }\n    return null;\n};\n\nconst getImageUrl = (avatarUrl: string | null | undefined): string => {\n    if (!avatarUrl) {\n      return `https://ui-avatars.com/api/?name=User&background=0D8ABC&color=fff&size=40`;\n    }\n  \n    let processedUrl = avatarUrl;\n    const isCosUrl = avatarUrl.includes('cos.ap-shanghai.myqcloud.com');\n    const isFullUrl = avatarUrl.startsWith('http://') || avatarUrl.startsWith('https://');\n    const isStaticPath = avatarUrl.startsWith('/static') || avatarUrl.startsWith('uploads/');\n    const isFilenameOnly = !avatarUrl.includes('/');\n  \n    if (isFullUrl) {\n      if (isCosUrl) {\n         processedUrl = avatarUrl;\n      } else {\n        processedUrl = avatarUrl;\n      }\n    } else if (isStaticPath) {\n      const urlParts = API_BASE_URL.split('/');\n      const baseUrlWithoutPath = `${urlParts[0]}//${urlParts[2]}`;\n      const relativePath = avatarUrl.startsWith('/') ? avatarUrl : `/${avatarUrl}`;\n      if (avatarUrl.startsWith('/static')) {\n        processedUrl = `${baseUrlWithoutPath}${relativePath}`;\n      } else {\n        processedUrl = `${baseUrlWithoutPath}/static/${avatarUrl}`;\n      }\n    } else if (isFilenameOnly) {\n      const urlParts = API_BASE_URL.split('/');\n      const baseUrlWithoutPath = `${urlParts[0]}//${urlParts[2]}`;\n      processedUrl = `${baseUrlWithoutPath}/static/uploads/${avatarUrl}`;\n    } \n    else {\n      processedUrl = avatarUrl;\n    }\n  \n    return processedUrl;\n  };\n\ninterface User {\n  id: number;\n  email: string;\n  nickname?: string | null;\n}\n\ninterface CommentUser { \n  id: number;\n  nickname: string | null;\n  email: string | null;\n  avatar?: string | null;\n}\n\ninterface ActionCommentData {\n  id: number;\n  content: string;\n  created_at: string;\n  user_id: number;\n  action_id: number;\n  parent_id: number | null;\n  user: CommentUser | null;\n  replies: ActionCommentData[];\n  is_deleted: boolean;\n  likes_count?: number;\n  is_liked?: boolean;\n}\n\ninterface DynamicDetailViewProps {\n  dynamic: DynamicDetails | null;\n  onClose: () => void;\n  onRepostSuccess?: () => void;\n  onInteractionChange?: (updatedDynamic: DynamicDetails) => void;\n}\n\ninterface CommentItemProps {\n  comment: ActionCommentData;\n  currentUser: User | null;\n  depth?: number;\n  isLastReply?: boolean;\n  token: string | null;\n  replyToCommentId: number | null;\n  setReplyToCommentId: (id: number | null) => void;\n  replyContent: string;\n  setReplyContent: (content: string) => void;\n  handleReplySubmit: (parentId: number) => Promise<void>;\n  submittingReply: boolean;\n  formatCommentDate: (dateString: string) => string;\n  handleDeleteComment: (commentId: number) => Promise<void>;\n  forceExpandCommentId: number | null;\n  handleLikeComment: (commentId: number, isLiked: boolean) => Promise<void>;\n}\n\nconst CommentItem: React.FC<CommentItemProps> = ({ \n  comment,\n  currentUser,\n  depth = 0, \n  isLastReply = false,\n  token,\n  replyToCommentId,\n  setReplyToCommentId,\n  replyContent,\n  setReplyContent,\n  handleReplySubmit,\n  submittingReply,\n  formatCommentDate,\n  handleDeleteComment,\n  forceExpandCommentId,\n  handleLikeComment\n}) => {\n  const userId = comment.user?.id;\n  const userNickname = comment.user?.nickname;\n  const userEmail = comment.user?.email;\n  const userAvatar = comment.user?.avatar;\n  const displayName = userNickname || userEmail?.split('@')[0] || '匿名用户';\n  const indentStyle = { paddingLeft: `${depth * 1.5}rem` };\n  const [isCollapsed, setIsCollapsed] = useState(depth >= 3);\n  const isReplying = replyToCommentId === comment.id;\n  const canDelete = currentUser && userId && currentUser.id === userId && !comment.is_deleted;\n  const hasReplies = comment.replies && comment.replies.length > 0;\n  const replyBoxRef = useRef<HTMLDivElement>(null);\n  \n  // 本地状态管理点赞状态\n  const [localIsLiked, setLocalIsLiked] = useState(comment.is_liked || false);\n  const [localLikesCount, setLocalLikesCount] = useState(comment.likes_count || 0);\n  const [isLiking, setIsLiking] = useState(false);\n  \n  // 递归计算评论数，包含所有嵌套回复\n  const countTotalReplies = (replies: ActionCommentData[] = []): number => {\n    let total = replies.length;\n    for (const reply of replies) {\n      if (reply.replies && reply.replies.length > 0) {\n        total += countTotalReplies(reply.replies);\n      }\n    }\n    return total;\n  };\n  \n  const totalRepliesCount = useMemo(() => \n    countTotalReplies(comment.replies || []),\n    [comment.replies]\n  );\n  \n  // 处理点赞按钮点击\n  const onLikeClick = async () => {\n    if (!token) {\n      toast.info(\"请先登录后再点赞\");\n      return;\n    }\n    \n    if (isLiking || comment.is_deleted) return;\n    \n    // 乐观更新UI\n    setIsLiking(true);\n    setLocalIsLiked(!localIsLiked);\n    setLocalLikesCount(localIsLiked ? localLikesCount - 1 : localLikesCount + 1);\n    \n    try {\n      await handleLikeComment(comment.id, localIsLiked);\n    } catch (error) {\n      // 发生错误时恢复之前的状态\n      setLocalIsLiked(!localIsLiked);\n      setLocalLikesCount(localIsLiked ? localLikesCount : localLikesCount - 1);\n      toast.error(\"点赞操作失败，请稍后再试\");\n    } finally {\n      setIsLiking(false);\n    }\n  };\n\n  // 点击外部关闭回复框\n  useEffect(() => {\n    if (!isReplying) return;\n    \n    const handleClickOutside = (event: MouseEvent) => {\n      if (replyBoxRef.current && !replyBoxRef.current.contains(event.target as Node)) {\n        setReplyToCommentId(null);\n      }\n    };\n    \n    document.addEventListener('mousedown', handleClickOutside);\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside);\n    };\n  }, [isReplying, setReplyToCommentId]);\n\n  useEffect(() => {\n    if (forceExpandCommentId === comment.id) {\n      setIsCollapsed(false);\n    }\n  }, [forceExpandCommentId, comment.id]);\n  \n  // 同步外部点赞状态变化\n  useEffect(() => {\n    setLocalIsLiked(comment.is_liked || false);\n    setLocalLikesCount(comment.likes_count || 0);\n  }, [comment.is_liked, comment.likes_count]);\n\n  return (\n    <div className=\"relative pt-2 comment-item text-gray-200\">\n      {depth > 0 && (\n        <div \n          className={`absolute left-0 top-0 w-0.5 bg-gray-500/50 ${isLastReply ? 'h-4' : 'h-full'}`} \n          style={{ left: `${(depth - 1) * 1.5 + 0.75}rem` }}>\n        </div>\n      )}\n      {depth > 0 && (\n         <div \n           className=\"absolute left-0 top-4 w-3 h-0.5 bg-gray-500/50\" \n           style={{ left: `${(depth - 1) * 1.5 + 0.75}rem` }}>\n         </div>\n      )}\n      \n      <div style={indentStyle} className=\"comment-content-wrapper\">\n        <div className=\"flex items-start space-x-2 mb-1\">\n          \n          {userId && (\n            <UserAvatar \n              userId={userId} \n              username={displayName} \n              avatar={userAvatar} \n              size=\"sm\"\n              className=\"mr-3\"\n              showName={false}\n            />\n          )}\n          {!userId && (\n            <div className=\"flex items-center\">\n              <div className=\"w-6 h-6 rounded-full mr-3 flex items-center justify-center bg-gray-500 text-white text-xs\">?</div>\n              <span className=\"font-medium text-gray-300 text-sm\">{displayName}</span>\n            </div>\n          )}\n          <span className=\"text-gray-400 text-xs pt-1\">{formatCommentDate(comment.created_at)}</span>\n        </div>\n        \n        <div className={`pl-8 ${comment.is_deleted ? 'text-gray-500 italic' : 'text-gray-100'}`}>\n            <p className={`text-sm whitespace-pre-wrap break-words mb-1.5`}>\n            {comment.content}\n            </p>\n            \n            {!comment.is_deleted && (\n                <div className=\"flex items-center space-x-3 text-xs mt-1 text-gray-400\">\n                {hasReplies && (\n                <button \n                    onClick={() => setIsCollapsed(!isCollapsed)}\n                    className=\"text-xs text-blue-400 hover:text-blue-300 focus:outline-none flex items-center mr-1\"\n                    aria-label={isCollapsed ? '展开回复' : '收起回复'}\n                    title={isCollapsed ? '展开回复' : '收起回复'}\n                >\n                    {isCollapsed \n                      ? <span>[+{totalRepliesCount}]</span> \n                      : <span>[-]</span>}\n                </button>\n                )}\n                \n                <button onClick={() => setReplyToCommentId(isReplying ? null : comment.id)} className={`flex items-center hover:text-blue-400 p-0.5 rounded ${isReplying ? 'text-blue-400' : ''}`} title={isReplying ? \"取消回复\" : \"回复\"}>\n                  <BsArrowReturnRight />\n                </button>\n                \n                <button onClick={onLikeClick} disabled={isLiking} className={`flex items-center p-0.5 rounded ${localIsLiked ? 'text-pink-500 hover:text-pink-400' : 'hover:text-pink-400'}`}>\n                  {localIsLiked ? <FaHeart /> : <FaRegHeart />}\n                  {localLikesCount > 0 && <span className=\"ml-1 text-xs\">{localLikesCount}</span>}\n                </button>\n                  \n                {canDelete && (\n                    <button onClick={() => handleDeleteComment(comment.id)} className=\"flex items-center hover:text-red-400 p-0.5 rounded\" title=\"删除评论\">\n                        <BsTrash />\n                    </button>\n                )}\n                </div>\n            )}\n            \n            {isReplying && (\n                <div ref={replyBoxRef} className=\"mt-2 relative\">\n                <textarea \n                  value={replyContent}\n                  onChange={(e) => setReplyContent(e.target.value)}\n                  placeholder={`回复 ${displayName}...`}\n                  rows={2}\n                  className=\"w-full px-2 py-1.5 pb-10 text-sm border border-gray-600/50 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 resize-none bg-gray-700/70 backdrop-blur-sm text-gray-100 placeholder-gray-400\"\n                  autoFocus\n                />\n                    <button \n                      onClick={() => handleReplySubmit(comment.id)} \n                      disabled={!replyContent.trim() || submittingReply}\n                  className={`absolute bottom-2 right-2 p-1.5 rounded-md text-white ${!replyContent.trim() || submittingReply ? 'text-gray-500 cursor-not-allowed' : 'text-blue-400 hover:text-blue-300 hover:bg-white/10'}`}\n                  title=\"发送回复\"\n                    >\n                  {submittingReply ? <FaSpinner className=\"animate-spin h-4 w-4\" /> : <BsArrowReturnRight className=\"h-5 w-5\" />}\n                    </button>\n                </div>\n            )}\n        </div>\n      </div>\n\n      {!isCollapsed && comment.replies && comment.replies.length > 0 && (\n        <div className=\"replies-container mt-2\">\n          {comment.replies.map((reply, index) => (\n            <CommentItem\n              key={reply.id}\n              comment={reply}\n              currentUser={currentUser}\n              depth={depth + 1}\n              isLastReply={index === comment.replies.length - 1}\n              token={token}\n              replyToCommentId={replyToCommentId}\n              setReplyToCommentId={setReplyToCommentId}\n              replyContent={replyContent}\n              setReplyContent={setReplyContent}\n              handleReplySubmit={handleReplySubmit}\n              submittingReply={submittingReply}\n              formatCommentDate={formatCommentDate}\n              handleDeleteComment={handleDeleteComment}\n              forceExpandCommentId={forceExpandCommentId}\n              handleLikeComment={handleLikeComment}\n            />\n          ))}\n        </div>\n      )}\n    </div>\n  );\n};\n\nconst DynamicDetailView: React.FC<DynamicDetailViewProps> = ({ dynamic, onClose, onRepostSuccess, onInteractionChange }) => {\n  const { user: currentUser, token } = useAuth();\n  const location = useLocation();\n  const [comments, setComments] = useState<ActionCommentData[]>([]);\n  const [loadingComments, setLoadingComments] = useState(false);\n  const [commentError, setCommentError] = useState<string | null>(null);\n  const [newComment, setNewComment] = useState('');\n  const [submittingComment, setSubmittingComment] = useState(false);\n  const [replyToCommentId, setReplyToCommentId] = useState<number | null>(null);\n  const [replyContent, setReplyContent] = useState('');\n  const [submittingReply, setSubmittingReply] = useState(false);\n  const [localIsLiked, setLocalIsLiked] = useState(dynamic?.is_liked_by_current_user || false);\n  const [localLikesCount, setLocalLikesCount] = useState(dynamic?.likes_count || 0);\n  const [localIsCollected, setLocalIsCollected] = useState(dynamic?.is_collected_by_current_user || false);\n  const [localCollectsCount, setLocalCollectsCount] = useState(dynamic?.collects_count || 0);\n  const [localRepostsCount, setLocalRepostsCount] = useState(dynamic?.reposts_count || 0);\n  const [interactionError, setInteractionError] = useState<string | null>(null);\n  const [isRepostModalOpen, setIsRepostModalOpen] = useState(false);\n  const [repostComment, setRepostComment] = useState('');\n  const [submittingRepost, setSubmittingRepost] = useState(false);\n  const [repostError, setRepostError] = useState<string | null>(null);\n  const [forceExpandCommentId, setForceExpandCommentId] = useState<number | null>(null);\n  const commentInputRef = useRef<HTMLTextAreaElement>(null);\n  \n  // 图片浏览器状态\n  const [isImageViewerOpen, setIsImageViewerOpen] = useState(false);\n  const [currentImageIndex, setCurrentImageIndex] = useState(0);\n\n  const sharerAvatarUrl = useMemo(() => getImageUrl(dynamic?.sharer_avatar_url), [dynamic?.sharer_avatar_url]);\n  const sharerName = dynamic?.sharer_username || '未知用户';\n  const sharerInitial = useMemo(() => (sharerName.charAt(0).toUpperCase() || 'U'), [sharerName]);\n\n  const countTotalComments = useCallback((commentList: ActionCommentData[]): number => {\n    let count = 0;\n    for (const comment of commentList) {\n      if (!comment.is_deleted) {\n          count += 1;\n          if (comment.replies && comment.replies.length > 0) {\n             count += countTotalComments(comment.replies);\n          }\n      }\n    }\n    return count;\n  }, []);\n\n  const totalCommentCount = useMemo(() => countTotalComments(comments), [comments, countTotalComments]);\n\n  const fetchComments = useCallback(async () => {\n    if (dynamic?.action_id) {\n      setLoadingComments(true);\n      setCommentError(null);\n      console.log(`[fetchComments] Fetching comments for action_id: ${dynamic.action_id}`);\n      try {\n        const response = await axios.get(`${API_BASE_URL}/api/actions/${dynamic.action_id}/comments`, {\n          headers: token ? { 'Authorization': `Bearer ${token}` } : {}\n        });\n        console.log(\"[fetchComments] API Response:\", response);\n        if (response.data && Array.isArray(response.data.comments)) {\n          setComments(response.data.comments);\n        } else {\n          console.warn(\"[fetchComments] Invalid data structure received:\", response.data);\n          setComments([]);\n          setCommentError(\"评论数据格式不正确。\");\n        }\n      } catch (err: any) {\n        console.error(\"获取分享评论失败 (fetchComments error):\", err);\n        if (axios.isAxiosError(err)) {\n          console.error(\"Axios error details:\", {\n            message: err.message,\n            responseStatus: err.response?.status,\n            responseData: err.response?.data,\n            requestConfig: err.config,\n          });\n          setCommentError(`无法加载评论 (${err.response?.status || 'Network Error'})。`);\n        } else {\n          console.error(\"Non-Axios error:\", err);\n          setCommentError(\"无法加载评论 (未知错误)。\");\n        }\n        setComments([]);\n      } finally {\n        setLoadingComments(false);\n      }\n    } else {\n        console.warn(\"[fetchComments] dynamic or action_id is missing, skipping fetch.\");\n        setComments([]);\n        setLoadingComments(false);\n    }\n  }, [dynamic?.action_id, token]);\n\n  const handleReplySubmit = useCallback(async (parentId: number) => {\n    if (!dynamic?.action_id || !token || !replyContent.trim()) return;\n\n    setSubmittingReply(true);\n    setCommentError(null);\n    setForceExpandCommentId(null);\n\n    try {\n      const response = await axios.post(`${API_BASE_URL}/api/actions/${dynamic.action_id}/comments`, {\n        content: replyContent.trim(),\n        parent_id: parentId\n      }, {\n        headers: { 'Authorization': `Bearer ${token}` }\n      });\n\n      if (response.status === 201 && response.data) {\n        const newReply = response.data as ActionCommentData;\n        const addReplyRecursively = (currentComments: ActionCommentData[], pId: number, replyToAdd: ActionCommentData): ActionCommentData[] => {\n           return currentComments.map(comment => {\n              if (comment.id === pId) {\n                 return { ...comment, replies: [replyToAdd, ...(comment.replies || [])] };\n              } else if (comment.replies && comment.replies.length > 0) {\n                 return { ...comment, replies: addReplyRecursively(comment.replies, pId, replyToAdd) };\n              }\n              return comment;\n           });\n        };\n        setComments(prevComments => addReplyRecursively(prevComments, parentId, newReply));\n        setReplyToCommentId(null);\n        setReplyContent('');\n        setForceExpandCommentId(parentId);\n      } else {\n        throw new Error(response.data?.error || '提交回复失败');\n      }\n    } catch (err: any) {\n      console.error(\"提交回复失败:\", err);\n      setCommentError(err.message || \"发表回复时出错，请稍后再试。\");\n    } finally {\n      setSubmittingReply(false);\n    }\n  }, [dynamic?.action_id, token, replyContent, setComments, setReplyToCommentId, setReplyContent, setCommentError, setSubmittingReply, setForceExpandCommentId]);\n\n  const handleDeleteComment = useCallback(async (commentId: number) => {\n    if (!token) {\n      toast.error(\"请先登录\");\n      return;\n    }\n    if (!window.confirm(\"确定要删除这条评论吗？\")) {\n      return;\n    }\n    try {\n      const response = await axios.delete(`${API_BASE_URL}/api/comments/${commentId}`, {\n        headers: { 'Authorization': `Bearer ${token}` }\n      });\n\n      if (response.status === 200 && response.data) {\n        const updatedDataFromBackend = response.data as Partial<ActionCommentData>;\n\n        const updateCommentState = (\n          currentComments: ActionCommentData[],\n          targetId: number,\n          updates: Partial<ActionCommentData>\n        ): ActionCommentData[] => {\n          return currentComments.map(comment => {\n            if (comment.id === targetId) {\n              return {\n                ...comment,\n                is_deleted: true,\n                content: updates.content || \"[该评论已删除]\",\n              };\n            } else if (comment.replies && comment.replies.length > 0) {\n              return {\n                ...comment,\n                replies: updateCommentState(comment.replies, targetId, updates)\n              };\n            }\n            return comment;\n          });\n        };\n\n        setComments(prevComments => updateCommentState(prevComments, commentId, updatedDataFromBackend));\n        toast.success(\"评论已删除\");\n\n      } else {\n        throw new Error(response.data?.error || '删除评论时服务器返回意外响应');\n      }\n    } catch (err: any) {\n      console.error(\"删除评论失败:\", err);\n      const errorMsg = err.response?.data?.error || err.message || '删除评论失败，请稍后再试。';\n      toast.error(errorMsg);\n    }\n  }, [token, setComments]);\n\n  useEffect(() => {\n    if (!isRepostModalOpen) {\n      // 重置状态\n      const timer = setTimeout(() => {\n        setRepostComment('');\n        setRepostError(null);\n      }, 300);\n      return () => clearTimeout(timer);\n    }\n  }, [isRepostModalOpen]);\n\n  useEffect(() => {\n    setLocalIsLiked(dynamic?.is_liked_by_current_user || false);\n    setLocalLikesCount(dynamic?.likes_count || 0);\n    setLocalIsCollected(dynamic?.is_collected_by_current_user || false);\n    setLocalCollectsCount(dynamic?.collects_count || 0);\n    setLocalRepostsCount(dynamic?.reposts_count || 0);\n  }, [dynamic]);\n\n  useEffect(() => {\n    console.log(`Action ID changed or component mounted: ${dynamic?.action_id}. Fetching comments.`);\n    fetchComments();\n  }, [fetchComments, dynamic?.action_id]);\n\n  if (!dynamic) {\n    return (\n      <div className=\"bg-white p-6 rounded-lg max-w-3xl w-full mx-auto text-center shadow-lg\">\n        <FaSpinner className=\"animate-spin h-8 w-8 text-blue-500 mx-auto mb-4\" />\n        <p className=\"text-gray-500\">正在加载动态详情...</p>\n      </div>\n    );\n  }\n\n  const renderComments = (commentList: ActionCommentData[]) => {\n    if (!commentList || commentList.length === 0) {\n      return <p className=\"text-center text-gray-500 text-sm py-4\">暂无评论。</p>;\n    }\n    return (\n      <div className=\"space-y-3\">\n        {commentList.map((comment, index) => (\n          <CommentItem\n            key={comment.id}\n            comment={comment}\n            currentUser={currentUser}\n            depth={0}\n            isLastReply={index === commentList.length - 1}\n            token={token}\n            replyToCommentId={replyToCommentId}\n            setReplyToCommentId={setReplyToCommentId}\n            replyContent={replyContent}\n            setReplyContent={setReplyContent}\n            handleReplySubmit={handleReplySubmit}\n            submittingReply={submittingReply}\n            formatCommentDate={formatCommentDate}\n            handleDeleteComment={handleDeleteComment}\n            forceExpandCommentId={forceExpandCommentId}\n            handleLikeComment={handleLikeComment}\n          />\n        ))}\n      </div>\n    );\n  }\n\n  const handleCommentSubmit = async () => {\n    if (!dynamic?.action_id || !token || !newComment.trim()) return;\n    setSubmittingComment(true);\n    setCommentError(null);\n    try {\n      const response = await axios.post(`${API_BASE_URL}/api/actions/${dynamic.action_id}/comments`, {\n        content: newComment.trim(),\n        parent_id: null\n      }, {\n        headers: { 'Authorization': `Bearer ${token}` }\n      });\n      if (response.status === 201 && response.data) {\n        setComments(prevComments => [response.data, ...prevComments]);\n        setNewComment('');\n      } else {\n        throw new Error(response.data?.error || '提交评论失败');\n      }\n    } catch (err: any) {\n      console.error(\"提交评论失败:\", err);\n      setCommentError(err.message || \"发表评论时出错，请稍后再试。\");\n    } finally {\n      setSubmittingComment(false);\n    }\n  };\n\n  const handleInteractionClick = async (interactionType: 'like' | 'collect') => {\n    if (!token || !dynamic) {\n      setInteractionError(\"请先登录再操作\");\n      return;\n    }\n    setInteractionError(null);\n    const currentIsLiked = localIsLiked;\n    const currentIsCollected = localIsCollected;\n    const currentLikeActionId = dynamic.like_action_id;\n    const currentCollectActionId = dynamic.collect_action_id;\n    const targetDynamicId = dynamic.action_id;\n    const originalLiked = localIsLiked;\n    const originalLikesCount = localLikesCount;\n    const originalCollected = localIsCollected;\n    const originalCollectsCount = localCollectsCount;\n    if (interactionType === 'like') {\n      setLocalIsLiked(!currentIsLiked);\n      setLocalLikesCount(currentIsLiked ? localLikesCount - 1 : localLikesCount + 1);\n    } else {\n      setLocalIsCollected(!currentIsCollected);\n      setLocalCollectsCount(currentIsCollected ? localCollectsCount - 1 : localCollectsCount + 1);\n    }\n    try {\n      let response: any;\n      if (interactionType === 'like') {\n        if (currentIsLiked && currentLikeActionId) {\n          response = await axios.delete(`${API_BASE_URL}/api/actions/${currentLikeActionId}`, { headers: { Authorization: `Bearer ${token}` } });\n        } else {\n          const payload = { action_type: 'like', target_type: 'action', target_id: targetDynamicId };\n          response = await axios.post(`${API_BASE_URL}/api/actions`, payload, { headers: { Authorization: `Bearer ${token}` } });\n        }\n      } else {\n        if (currentIsCollected && currentCollectActionId) {\n          response = await axios.delete(`${API_BASE_URL}/api/actions/${currentCollectActionId}`, { headers: { Authorization: `Bearer ${token}` } });\n        } else {\n          const payload = { action_type: 'collect', target_type: 'action', target_id: targetDynamicId };\n          response = await axios.post(`${API_BASE_URL}/api/actions`, payload, { headers: { Authorization: `Bearer ${token}` } });\n        }\n      }\n      const updatedDynamicData = { ...dynamic } as DynamicDetails;\n      if (interactionType === 'like') {\n          const success = currentIsLiked ? (response.status === 200 || response.status === 204) : ((response.status === 201 || response.status === 200) && response.data?.id);\n          if (success) {\n              updatedDynamicData.is_liked_by_current_user = !currentIsLiked;\n              updatedDynamicData.likes_count = currentIsLiked ? (originalLikesCount - 1) : (originalLikesCount + 1);\n              updatedDynamicData.like_action_id = currentIsLiked ? null : response.data.id;\n          } else {\n              throw new Error(response.data?.error || `点赞操作API失败，状态码: ${response.status}`);\n          }\n      } else {\n          const success = currentIsCollected ? (response.status === 200 || response.status === 204) : ((response.status === 201 || response.status === 200) && response.data?.id);\n          if (success) {\n              updatedDynamicData.is_collected_by_current_user = !currentIsCollected;\n              updatedDynamicData.collects_count = currentIsCollected ? (originalCollectsCount - 1) : (originalCollectsCount + 1);\n              updatedDynamicData.collect_action_id = currentIsCollected ? null : response.data.id;\n          } else {\n              throw new Error(response.data?.error || `收藏操作API失败，状态码: ${response.status}`);\n          }\n      }\n      onInteractionChange?.(updatedDynamicData);\n      console.log(`${interactionType}操作成功，并通知父组件:`, updatedDynamicData);\n    } catch (err: any) {\n      console.error(`${interactionType}操作失败:`, err);\n      setInteractionError(`操作失败: ${err.message || err.response?.data?.error || '请稍后重试'}`);\n      if (interactionType === 'like') {\n        setLocalIsLiked(originalLiked);\n        setLocalLikesCount(originalLikesCount);\n      } else {\n        setLocalIsCollected(originalCollected);\n        setLocalCollectsCount(originalCollectsCount);\n      }\n    }\n  };\n\n  const handleRepostClick = () => {\n    if (!token) {\n      toast.info(\"请先登录再进行转发。\");\n      return;\n    }\n    setIsRepostModalOpen(true);\n  };\n\n  const handleRepostSubmit = async (comment: string, images: string[] = []) => {\n    if (!token || !dynamic?.action_id) {\n      setRepostError(\"无法转发，缺少必要信息。\");\n      return;\n    }\n    setSubmittingRepost(true);\n    setRepostError(null);\n    try {\n      const targetActionId = dynamic.action_id;\n      const response = await axios.post(\n        `${API_BASE_URL}/api/actions`, \n        {\n          action_type: 'share',\n          target_type: 'action',\n          target_id: targetActionId,\n          content: comment,\n          images: images.length > 0 ? images : undefined,\n        },\n        { headers: { Authorization: `Bearer ${token}` } }\n      );\n      setIsRepostModalOpen(false);\n      setRepostComment('');\n      setLocalRepostsCount(localRepostsCount + 1);\n      onRepostSuccess?.();\n      toast.success(\"分享成功！\");\n    } catch (err: any) {\n      console.error(\"转发失败:\", err);\n      setRepostError(`转发失败: ${err.response?.data?.error || '请稍后重试'}`);\n      return Promise.reject(err);\n    } finally {\n      setSubmittingRepost(false);\n    }\n  };\n\n  // 处理评论点赞\n  const handleLikeComment = async (commentId: number, isLiked: boolean) => {\n    if (!token) {\n      toast.info(\"请先登录\");\n      return;\n    }\n\n    try {\n      if (isLiked) {\n        // 取消点赞\n        await axios.delete(`${API_BASE_URL}/api/comments/${commentId}/like?target_type=action`, {\n          headers: { 'Authorization': `Bearer ${token}` }\n        });\n      } else {\n        // 点赞\n        await axios.post(`${API_BASE_URL}/api/comments/${commentId}/like?target_type=action`, {}, {\n          headers: { 'Authorization': `Bearer ${token}` }\n        });\n      }\n\n      // 更新评论的点赞状态\n      const updateCommentLikeStatus = (commentsList: ActionCommentData[]): ActionCommentData[] => {\n        return commentsList.map(comment => {\n          if (comment.id === commentId) {\n            return {\n              ...comment,\n              is_liked: !isLiked,\n              likes_count: isLiked ? (comment.likes_count || 1) - 1 : (comment.likes_count || 0) + 1\n            };\n          } \n          \n          if (comment.replies && comment.replies.length > 0) {\n            return {\n              ...comment,\n              replies: updateCommentLikeStatus(comment.replies)\n            };\n          }\n          \n          return comment;\n        });\n      };\n      \n      setComments(prev => updateCommentLikeStatus(prev));\n      \n    } catch (err: any) {\n      console.error(\"评论点赞操作失败:\", err);\n      throw err;\n    }\n  };\n\n  return (\n    <div className=\"w-[1200px] max-w-[1200px] h-[90vh] flex flex-col md:flex-row gap-4 overflow-hidden\">\n      <div className=\"w-full md:w-7/12 flex flex-col h-full bg-gray-900/30 backdrop-blur-xl rounded-2xl overflow-hidden shadow-lg\">\n        <div className=\"flex items-center p-4 border-b border-white/5 flex-shrink-0 bg-black/15 backdrop-blur-lg\">\n           {dynamic.sharer_id ? (\n             <Link \n               to={`/profile/${dynamic.sharer_id}`} \n               target=\"_blank\" \n               rel=\"noopener noreferrer\"\n               className=\"flex items-center group\"\n             >\n               <div className=\"relative w-10 h-10 mr-3 flex-shrink-0\">\n                 <img \n                   src={sharerAvatarUrl} \n                   alt={`${sharerName} avatar`}\n                   className=\"w-10 h-10 rounded-full object-cover transition-transform duration-200 group-hover:scale-105\"\n                   onError={(e) => {\n                     const imgElement = e.target as HTMLImageElement;\n                     imgElement.style.display = 'none';\n                     const fallbackElement = imgElement.nextElementSibling as HTMLElement;\n                     if (fallbackElement) fallbackElement.style.display = 'flex';\n                   }}\n                 />\n                 <div \n                   className=\"w-10 h-10 rounded-full bg-gray-300 flex items-center justify-center text-lg font-bold absolute top-0 left-0 text-gray-600\"\n                   style={{ display: 'none' }} \n                 >{sharerInitial}</div>\n               </div>\n               <div>\n                 <span className=\"font-semibold text-gray-100 block leading-tight group-hover:text-blue-400 transition-colors\">{sharerName}</span>\n                 <span className=\"text-xs text-gray-400\">发布于 {formatCommentDate(dynamic.shared_at)}</span>\n               </div>\n             </Link>\n           ) : (\n             <div className=\"flex items-center\">\n                <div className=\"relative w-10 h-10 mr-3 flex-shrink-0\">\n                 <img \n                   src={sharerAvatarUrl} \n                   alt={`${sharerName} avatar`}\n                   className=\"w-10 h-10 rounded-full object-cover\"\n                   onError={(e) => {\n                     const imgElement = e.target as HTMLImageElement;\n                     imgElement.style.display = 'none';\n                     const fallbackElement = imgElement.nextElementSibling as HTMLElement;\n                     if (fallbackElement) fallbackElement.style.display = 'flex';\n                   }}\n                 />\n                 <div \n                   className=\"w-10 h-10 rounded-full bg-gray-300 flex items-center justify-center text-lg font-bold absolute top-0 left-0 text-gray-600\"\n                   style={{ display: 'none' }} \n                 >{sharerInitial}</div>\n               </div>\n               <div>\n                 <span className=\"font-semibold text-gray-100 block leading-tight\">{sharerName}</span>\n                 <span className=\"text-xs text-gray-400\">发布于 {formatCommentDate(dynamic.shared_at)}</span>\n               </div>\n             </div>\n           )}\n          <button \n            onClick={onClose}\n            className=\"ml-auto text-gray-300 hover:text-white transition-colors p-1.5 rounded-full hover:bg-white/10\"\n            aria-label=\"关闭\"\n          ><IoMdClose size={22} /></button>\n        </div>\n          \n        <div className=\"flex-grow overflow-y-auto p-4 scrollbar-thin scrollbar-thumb-white/20 scrollbar-track-transparent\">\n          <div className=\"mb-4\">\n            {dynamic.share_comment && (\n              <div className=\"text-white mb-3 break-words leading-relaxed markdown-content prose prose-invert prose-sm max-w-none [&>p]:text-white\">\n                <ReactMarkdown remarkPlugins={[remarkGfm]}>{dynamic.share_comment}</ReactMarkdown>\n              </div>\n            )}\n            \n            {dynamic.images && dynamic.images.length > 0 && (\n              <div className=\"mt-2 mb-3 relative\">\n                {/* 图片浏览器区域，固定高度，限制最大高度 */}\n                <div className={`image-gallery relative overflow-hidden rounded-lg ${dynamic.images?.length === 1 ? 'max-h-[350px]' : ''}`}>\n                  {dynamic.images?.length === 1 ? (\n                    // 单张图片显示逻辑\n                    <div className=\"relative w-full h-full\">\n                      <img \n                        src={dynamic.images?.[0]} \n                        alt=\"分享图片\" \n                        className=\"w-full h-full object-contain bg-black/20 cursor-pointer hover:opacity-95 transition-opacity rounded-lg\"\n                        onClick={() => {\n                          setCurrentImageIndex(0);\n                          setIsImageViewerOpen(true);\n                        }}\n                        onError={(e) => {\n                          (e.target as HTMLImageElement).src = '/images/image-error.png';\n                        }}\n                      />\n                      <div className=\"absolute bottom-0 right-0 p-1.5 bg-black/50 text-white text-xs rounded-tl-md backdrop-blur-sm\">\n                        点击查看大图\n                      </div>\n                    </div>\n                  ) : (\n                    // 多张图片九宫格显示\n                    <div \n                      className={`grid gap-1 ${\n                        dynamic.images?.length === 2 ? 'grid-cols-2' : \n                        dynamic.images?.length === 3 ? 'grid-cols-3' :\n                        dynamic.images?.length === 4 ? 'grid-cols-2 grid-rows-2' :\n                        dynamic.images?.length <= 6 ? 'grid-cols-3 grid-rows-2' :\n                        'grid-cols-3 grid-rows-3'\n                      }`}\n                    >\n                      {dynamic.images?.slice(0, 9).map((imageUrl, index) => (\n                        <div \n                          key={index} \n                          className={`relative overflow-hidden rounded-md bg-black/10 ${\n                            dynamic.images && dynamic.images.length <= 4 ? 'h-28' : 'h-24'\n                          } ${\n                            (dynamic.images && dynamic.images.length === 3 && index === 0) ? 'col-span-full row-span-1' : ''\n                          }`}\n                        >\n                          <img \n                            src={imageUrl} \n                            alt={`分享图片 ${index + 1}`} \n                            className=\"w-full h-full object-cover cursor-pointer hover:opacity-90 transition-opacity\"\n                            onClick={() => {\n                              setCurrentImageIndex(index);\n                              setIsImageViewerOpen(true);\n                            }}\n                            onError={(e) => {\n                              (e.target as HTMLImageElement).src = '/images/image-error.png';\n                            }}\n                          />\n                          {index === 8 && dynamic.images && dynamic.images.length > 9 && (\n                            <div className=\"absolute inset-0 bg-black/60 flex items-center justify-center text-white cursor-pointer\"\n                                 onClick={() => {\n                                   setCurrentImageIndex(8);\n                                   setIsImageViewerOpen(true);\n                                 }}>\n                              +{(dynamic.images?.length || 0) - 9}\n                            </div>\n                          )}\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                </div>\n              </div>\n            )}\n            \n            {dynamic.original_action ? (\n              <div className=\"mt-2 mb-3 px-4 text-white\">\n              <QuotedDynamicView dynamic={dynamic.original_action} />\n              </div>\n            ) : (\n              (() => { \n                const targetLink = generateTargetLink(dynamic.target_type, dynamic.target_slug, dynamic.target_id);\n                if (targetLink) {\n                  return (\n                    <div className=\"mt-2 p-3 bg-black/15 backdrop-blur-md rounded-lg border border-white/5\">\n                      <p className=\"text-xs text-gray-400 mb-1\">分享的{dynamic.target_type === 'post' ? '帖子' : dynamic.target_type === 'article' ? '文章' : '工具'}:</p>\n                      <Link to={targetLink} className=\"font-semibold text-blue-400 hover:underline\" onClick={onClose}>{dynamic.target_title || '查看原文'}</Link>\n                    </div>\n                  );\n                } else if (dynamic.target_type === 'deleted') {\n                  return <div className=\"mt-2 p-3 bg-black/15 backdrop-blur-md rounded-lg border border-white/5 text-gray-500 italic\">内容已被删除</div>;\n                }\n                return null;\n              })()\n            )}\n          </div>\n        </div>\n\n        <div className=\"border-0 p-4 flex-shrink-0 bg-black/15 backdrop-blur-lg\">\n          <div className=\"flex justify-between items-center border-t border-gray-700 pt-4 mt-4\">\n            <div className=\"flex items-center gap-4\">\n              <button\n                className=\"flex items-center gap-1 text-gray-300 hover:text-blue-400 transition\"\n                onClick={() => {\n                  // Implement scroll to comments logic\n                  const commentsSection = document.getElementById('comments-section');\n                  if (commentsSection) {\n                    commentsSection.scrollIntoView({ behavior: 'smooth' });\n                  }\n                }}\n              >\n                <FaRegCommentDots className=\"text-lg\" />\n                <span className=\"text-sm\">{totalCommentCount}</span>\n              </button>\n              \n              <button\n                className=\"flex items-center gap-1 text-gray-300 hover:text-green-400 transition\"\n                onClick={handleRepostClick}\n              >\n                <FaRetweet className=\"text-lg\" />\n                <span className=\"text-sm\">{localRepostsCount}</span>\n              </button>\n              \n              <button\n                className={`flex items-center gap-1 transition ${localIsLiked ? 'text-pink-500' : 'text-gray-300 hover:text-pink-500'}`}\n                onClick={() => handleInteractionClick('like')}\n                disabled={!token}\n              >\n                {localIsLiked ? <FaHeart className=\"text-lg\" /> : <FaRegHeart className=\"text-lg\" />}\n                <span className=\"text-sm\">{localLikesCount}</span>\n              </button>\n              \n              <button\n                className={`flex items-center gap-1 transition ${localIsCollected ? 'text-yellow-400' : 'text-gray-300 hover:text-yellow-400'}`}\n                onClick={() => handleInteractionClick('collect')}\n                disabled={!token}\n              >\n                {localIsCollected ? <FaBookmark className=\"text-lg\" /> : <FaRegBookmark className=\"text-lg\" />}\n                <span className=\"text-sm\">{localCollectsCount}</span>\n              </button>\n            </div>\n          </div>\n          {interactionError && <p className=\"text-red-400 text-xs text-center mt-2\">{interactionError}</p>}\n        </div>\n      </div>\n\n      <div className=\"w-full md:w-5/12 flex flex-col h-full bg-gray-900/30 backdrop-blur-xl rounded-2xl overflow-hidden shadow-lg\">\n        <div className=\"p-4 flex-shrink-0 bg-black/15 backdrop-blur-lg\">\n          <h3 className=\"text-lg font-semibold text-gray-100\">评论 {totalCommentCount > 0 ? `(${totalCommentCount})` : ''}</h3>\n        </div>\n\n        <div className=\"flex-grow overflow-y-auto p-4 space-y-4 scrollbar-thin scrollbar-thumb-white/20 scrollbar-track-transparent border-b-0\">\n           {loadingComments ? (\n             <div className=\"text-center py-4\"><FaSpinner className=\"animate-spin h-5 w-5 text-gray-400 mx-auto\" /></div>\n           ) : commentError ? (\n             <p className=\"text-red-400 text-center\">{commentError}</p>\n           ) : comments.length === 0 ? (\n             <p className=\"text-gray-400 text-center italic py-4\">还没有评论，快来抢沙发吧！</p>\n           ) : (\n             renderComments(comments)\n           )}\n         </div>\n\n        <div className=\"border-0 p-4 flex-shrink-0 bg-black/15 backdrop-blur-lg\">\n          {token ? (\n            <div className=\"relative\">\n               <textarea\n                ref={commentInputRef}\n                className=\"w-full px-3 py-2 pb-14 bg-black/5 backdrop-blur-xl rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500 text-gray-100 text-sm h-20 resize-y border-none placeholder-gray-400 focus:ring-opacity-75\"\n                placeholder=\"分享你的看法...\"\n                value={newComment}\n                onChange={(e) => setNewComment(e.target.value)}\n                onKeyDown={(e) => { if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') handleCommentSubmit(); }}\n               />\n               <div className=\"absolute bottom-4 right-3 flex items-center space-x-2\">\n               <button\n                 onClick={handleCommentSubmit}\n                 disabled={!newComment.trim() || submittingComment}\n                   className=\"p-1.5 text-blue-400 hover:text-blue-300 rounded-md transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center w-7 h-7 focus:outline-none focus:ring-1 focus:ring-offset-1 focus:ring-offset-black/15 focus:ring-blue-500 hover:bg-white/10\"\n                 title=\"提交评论 (Cmd/Ctrl+Enter)\"\n               >\n                 {submittingComment ? <FaSpinner className=\"animate-spin h-4 w-4\" /> : <BsArrowReturnRight className=\"h-5 w-5\" />}\n               </button>\n               </div>\n             </div>\n          ) : (\n             <div className=\"text-center text-sm text-gray-300\">请 <Link to={`/login?redirect=${location.pathname}${location.search}`} className=\"text-blue-400 hover:underline\">登录</Link> 后参与评论</div>\n          )}\n        </div>\n      </div>\n\n      <Modal isOpen={isRepostModalOpen} onClose={() => setIsRepostModalOpen(false)}>\n        <ShareDynamicModal\n          isOpen={isRepostModalOpen}\n          onClose={() => setIsRepostModalOpen(false)}\n          onSubmit={handleRepostSubmit}\n          comment={repostComment}\n          setComment={setRepostComment}\n          error={repostError}\n          isLoading={submittingRepost}\n          dynamicToShare={dynamic}\n          username={currentUser?.nickname || currentUser?.email?.split('@')[0] || '您'}\n          altText={`转发 ${dynamic?.sharer_username || '用户'} 的动态`}\n        />\n      </Modal>\n\n      {/* 图片浏览器 */}\n      {dynamic.images && dynamic.images.length > 0 && (\n        <ImageViewer\n          images={dynamic.images}\n          initialIndex={currentImageIndex}\n          isOpen={isImageViewerOpen}\n          onClose={() => setIsImageViewerOpen(false)}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default DynamicDetailView; ","/**\n * \n * 注意: 导航栏组件(Navbar和SideNavbar)已移至全局布局，不需要在页面组件中引入\n * 此组件用于展示指定用户的所有动态活动。\n * \n * 主要功能:\n * - 通过URL参数获取用户ID，加载并显示该用户的所有动态\n * - 支持无限滚动加载更多动态\n * - 显示动态的详细信息，包括点赞、收藏、评论和转发\n * - 提供动态详情模态框查看和交互功能\n * - 展示用户基本信息\n * \n * 注意: 如果新增、删除或修改功能，必须在这开头的注释中同步修改，\n * 如发现功能与注释描述不同，也可以在确定后修改。\n */\n\nimport React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport axios from 'axios';\nimport { API_BASE_URL } from '../config';\nimport { useAuth } from '../context/AuthContext';\n// 已移除: import Navbar from \"../components/Navbar\";\nimport DynamicCard from '../components/DynamicCard';\nimport DynamicDetailView from '../components/DynamicDetailView';\nimport UserAvatarWithImage from '../components/UserAvatarWithImage';\nimport Modal from '../components/Modal';\nimport { DynamicDetails } from '../components/QuotedDynamicView';\nimport { FaCalendarAlt } from 'react-icons/fa';\n\n// 动态项接口定义与HomePage中保持一致\ninterface DynamicItem {\n  action_id: number; \n  share_comment: string | null;\n  shared_at: string;\n  sharer_id?: number | null;\n  sharer_username: string;\n  sharer_avatar_url?: string | null;\n  is_repost: boolean; \n  original_action: DynamicDetails | null;\n\n  target_type: 'article' | 'post' | 'action' | 'tool' | 'user' | 'deleted' | string; \n  target_title: string | null;\n  target_slug: string | null; \n  target_id: number | null;\n\n  likes_count?: number;      \n  collects_count?: number;\n  reposts_count?: number;\n  is_liked_by_current_user?: boolean;\n  is_collected_by_current_user?: boolean;\n  like_action_id?: number | null;\n  collect_action_id?: number | null;\n  images?: string[];\n  \n  is_deleted?: boolean; // 添加is_deleted属性\n}\n\n// 用户信息接口定义\ninterface UserInfo {\n  id: number;\n  email: string;\n  nickname: string | null;\n  avatar_url: string | null;\n  joined_at: string;\n  bio: string | null;\n  article_count: number;\n  post_count: number;\n  follower_count: number;\n  following_count: number;\n  is_followed_by_current_user: boolean;\n}\n\n// DynamicCard 组件所需的接口\ninterface Dynamic {\n  id: number;\n  created_at: string;\n  // 其他所需属性\n  target_type: 'article' | 'post' | 'tool' | 'action' | 'user';\n  target_id: number;\n  content?: string;\n  author?: any;\n  like_count?: number;\n  collect_count?: number;\n  repost_count?: number;\n  comment_count?: number;\n  current_user_like_action_id?: number | null;\n  current_user_collect_action_id?: number | null;\n  target_article?: any;\n  target_post?: any;\n  target_tool?: any;\n  images?: string[];\n}\n\nconst UserActivitiesPage: React.FC = () => {\n  const { userId } = useParams<{ userId: string }>();\n  const navigate = useNavigate();\n  const { token } = useAuth();\n  \n  // 状态管理\n  const [userInfo, setUserInfo] = useState<UserInfo | null>(null);\n  const [dynamics, setDynamics] = useState<DynamicItem[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [page, setPage] = useState(1);\n  const [hasMore, setHasMore] = useState(true);\n  const [isLoadingMore, setIsLoadingMore] = useState(false);\n  const [selectedDynamic, setSelectedDynamic] = useState<DynamicDetails | null>(null);\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  \n  const observerRef = useRef<IntersectionObserver | null>(null);\n  const loadMoreRef = useRef<HTMLDivElement | null>(null);\n\n  // 格式化日期函数\n  const formatJoinDate = (dateString: string) => {\n    try {\n      const date = new Date(dateString);\n      return date.toLocaleDateString('zh-CN', {\n        year: 'numeric',\n        month: 'long',\n        day: 'numeric'\n      });\n    } catch (error) {\n      return dateString;\n    }\n  };\n\n  // 加载用户信息\n  const fetchUserInfo = useCallback(async () => {\n    if (!userId) return;\n    \n    try {\n      const response = await axios.get(`${API_BASE_URL}/api/users/${userId}`, {\n        headers: token ? { Authorization: `Bearer ${token}` } : undefined\n      });\n      \n      if (response.data) {\n        console.log('获取到的用户信息:', response.data);\n        console.log('用户头像URL:', response.data.avatar_url);\n        setUserInfo(response.data);\n      }\n    } catch (err: any) {\n      console.error('获取用户信息失败:', err);\n      setError('无法加载用户信息');\n    }\n  }, [userId, token]);\n\n  // 加载用户动态\n  const fetchUserDynamics = useCallback(async (pageNum: number) => {\n    if (!userId) return;\n    \n    try {\n      if (pageNum === 1) {\n        setIsLoading(true);\n      } else {\n        setIsLoadingMore(true);\n      }\n      \n      const response = await axios.get(`${API_BASE_URL}/api/users/${userId}/dynamics`, {\n        params: { page: pageNum, limit: 10 },\n        headers: token ? { Authorization: `Bearer ${token}` } : undefined\n      });\n      \n      if (response.data && Array.isArray(response.data.dynamics)) {\n        console.log('获取到的用户动态:', response.data.dynamics);\n        \n        // 过滤掉已删除的动态\n        const filteredDynamics = response.data.dynamics.filter((dynamic: DynamicItem) => !dynamic.is_deleted);\n        console.log('过滤后的动态数量:', filteredDynamics.length);\n        \n        if (pageNum === 1) {\n          setDynamics(filteredDynamics);\n        } else {\n          setDynamics(prev => [...prev, ...filteredDynamics]);\n        }\n        \n        setHasMore(filteredDynamics.length === 10);\n      } else {\n        setHasMore(false);\n      }\n    } catch (err: any) {\n      console.error('获取用户动态失败:', err);\n      setError('无法加载用户动态');\n    } finally {\n      if (pageNum === 1) {\n        setIsLoading(false);\n      } else {\n        setIsLoadingMore(false);\n      }\n    }\n  }, [userId, token]);\n\n  // 初始加载\n  useEffect(() => {\n    if (userId) {\n      setPage(1);\n      fetchUserInfo();\n      fetchUserDynamics(1);\n    }\n  }, [userId, fetchUserInfo, fetchUserDynamics]);\n\n  // 设置无限滚动\n  useEffect(() => {\n    if (isLoading || !hasMore) return;\n    \n    const handleObserver = (entries: IntersectionObserverEntry[]) => {\n      const [entry] = entries;\n      if (entry.isIntersecting && !isLoadingMore) {\n        setPage(prev => prev + 1);\n      }\n    };\n    \n    const observer = new IntersectionObserver(handleObserver, {\n      rootMargin: '0px 0px 100px 0px'\n    });\n    \n    observerRef.current = observer;\n    \n    if (loadMoreRef.current) {\n      observer.observe(loadMoreRef.current);\n    }\n    \n    return () => {\n      if (observerRef.current) {\n        observerRef.current.disconnect();\n      }\n    };\n  }, [isLoading, hasMore, isLoadingMore]);\n\n  // 加载更多数据\n  useEffect(() => {\n    if (page > 1) {\n      fetchUserDynamics(page);\n    }\n  }, [page, fetchUserDynamics]);\n\n  // 打开动态详情模态框\n  const openDynamicModal = (item: DynamicItem) => {\n    // 将DynamicItem转换为DynamicDetails格式\n    \n    // 更精确地推断 action_type\n    // action_type 的可能值为: 'share', 'create_status' (在此上下文中，'like' 和 'collect' 通常不作为独立的动态卡片展示)\n    let determined_action_type: 'share' | 'create_status';\n    if (item.is_repost) { \n      // 转发的动态 (target_type 应该是 'action')，其本身行为是 'share'\n      determined_action_type = 'share';\n    } else if (item.target_type === 'user') {\n      // 非转发，且目标是用户自身，这代表一个原创的状态/动态\n      determined_action_type = 'create_status';\n    } else {\n      // 非转发，且目标是其他类型 (如 article, post)，这代表分享了一个已存在的外部内容\n      determined_action_type = 'share';\n    }\n\n    const dynamicDetails: DynamicDetails = {\n      action_id: item.action_id,\n      share_comment: item.share_comment,\n      action_type: determined_action_type,\n      shared_at: item.shared_at,\n      sharer_id: item.sharer_id ?? null,\n      sharer_username: item.sharer_username,\n      sharer_avatar_url: item.sharer_avatar_url,\n      is_repost: item.is_repost,\n      original_action: item.original_action,\n      target_type: item.target_type,\n      target_title: item.target_title,\n      target_slug: item.target_slug,\n      target_id: item.target_id,\n      likes_count: item.likes_count || 0,\n      collects_count: item.collects_count || 0,\n      reposts_count: item.reposts_count || 0,\n      is_liked_by_current_user: item.is_liked_by_current_user || false,\n      is_collected_by_current_user: item.is_collected_by_current_user || false,\n      like_action_id: item.like_action_id || null,\n      collect_action_id: item.collect_action_id || null\n    };\n    \n    setSelectedDynamic(dynamicDetails);\n    setIsModalOpen(true);\n  };\n\n  // 关闭动态详情模态框\n  const closeDynamicModal = () => {\n    setIsModalOpen(false);\n    setTimeout(() => {\n      setSelectedDynamic(null);\n    }, 300);\n  };\n\n  // 处理转发成功\n  const handleRepostSuccess = () => {\n    // 刷新动态列表\n    setPage(1);\n    fetchUserDynamics(1);\n  };\n\n  // 处理交互状态变化 (点赞、收藏)\n  const handleInteractionChange = (updatedDynamic: DynamicDetails) => {\n    setDynamics(prevDynamics => prevDynamics.map(dynamic => {\n      if (dynamic.action_id === updatedDynamic.action_id) {\n        return {\n          ...dynamic,\n          likes_count: updatedDynamic.likes_count,\n          collects_count: updatedDynamic.collects_count,\n          reposts_count: updatedDynamic.reposts_count,\n          is_liked_by_current_user: updatedDynamic.is_liked_by_current_user,\n          is_collected_by_current_user: updatedDynamic.is_collected_by_current_user,\n          like_action_id: updatedDynamic.like_action_id,\n          collect_action_id: updatedDynamic.collect_action_id\n        };\n      }\n      return dynamic;\n    }));\n    \n    // 如果当前选中的动态与更新的动态相同，也更新它\n    if (selectedDynamic?.action_id === updatedDynamic.action_id) {\n      setSelectedDynamic(updatedDynamic);\n    }\n  };\n\n  // 动态项完成更新回调\n  const handleDynamicActionComplete = () => {\n    // 可以添加额外的处理逻辑，如显示通知或更新UI\n  };\n\n  return (\n    <div className=\"flex flex-col min-h-screen bg-transparent text-white\">\n      {/* 移除Navbar组件 */}\n      \n      <div className=\"container mx-auto p-4 flex-grow\">\n        {error ? (\n          <div className=\"text-center py-8\">\n            <p className=\"text-xl text-red-400\">{error}</p>\n            <button \n              onClick={() => navigate('/')}\n              className=\"mt-4 px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-md transition\"\n            >\n              返回首页\n            </button>\n          </div>\n        ) : isLoading && !userInfo ? (\n          <div className=\"flex justify-center items-center py-16\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500\"></div>\n          </div>\n        ) : (\n          <>\n            {/* 用户信息卡片 */}\n            {userInfo && (\n              <div className=\"bg-gray-800/70 rounded-lg p-5 mb-6 shadow-lg\">\n                <div className=\"flex flex-col md:flex-row items-center md:items-start gap-4\">\n                  <div className=\"relative\">\n                    <UserAvatarWithImage \n                      userId={userInfo.id} \n                      username={userInfo.nickname || userInfo.email.split('@')[0]}\n                      avatarUrl={userInfo.avatar_url}\n                      size=\"lg\"\n                      showName={false}\n                    />\n                  </div>\n                  \n                  <div className=\"flex-grow text-center md:text-left\">\n                    <h2 className=\"text-2xl font-bold\">\n                      {userInfo.nickname || userInfo.email.split('@')[0]}\n                    </h2>\n                    \n                    <div className=\"flex items-center justify-center md:justify-start text-gray-400 mt-1\">\n                      <FaCalendarAlt className=\"mr-1\" />\n                      <span className=\"text-sm\">加入于 {formatJoinDate(userInfo.joined_at)}</span>\n                    </div>\n                    \n                    {userInfo.bio && (\n                      <p className=\"mt-3 text-gray-300\">{userInfo.bio}</p>\n                    )}\n                    \n                    <div className=\"mt-4 flex flex-wrap gap-6 justify-center md:justify-start\">\n                      <div className=\"text-center\">\n                        <div className=\"text-xl font-semibold\">{userInfo.article_count}</div>\n                        <div className=\"text-sm text-gray-400\">文章</div>\n                      </div>\n                      <div className=\"text-center\">\n                        <div className=\"text-xl font-semibold\">{userInfo.post_count}</div>\n                        <div className=\"text-sm text-gray-400\">帖子</div>\n                      </div>\n                      <div className=\"text-center\">\n                        <div className=\"text-xl font-semibold\">{userInfo.follower_count}</div>\n                        <div className=\"text-sm text-gray-400\">粉丝</div>\n                      </div>\n                      <div className=\"text-center\">\n                        <div className=\"text-xl font-semibold\">{userInfo.following_count}</div>\n                        <div className=\"text-sm text-gray-400\">关注</div>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            )}\n            \n            {/* 动态列表 */}\n            <h2 className=\"text-xl font-bold mb-4\">用户动态</h2>\n            \n            {isLoading && dynamics.length === 0 ? (\n              <div className=\"flex justify-center items-center py-8\">\n                <div className=\"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-blue-500\"></div>\n              </div>\n            ) : dynamics.length === 0 ? (\n              <div className=\"text-center py-8 bg-gray-800/30 rounded-lg\">\n                <p className=\"text-lg text-gray-400\">该用户还没有任何动态</p>\n              </div>\n            ) : (\n              <div className=\"space-y-4\">\n                {dynamics.map(dynamic => {\n                  // 添加调试输出\n                  console.log('渲染动态信息:', dynamic);\n                  console.log('传递给动态卡片的头像URL:', userInfo?.avatar_url);\n                  \n                  // 构建传递给DynamicCard的数据\n                  const dynamicCardData = {\n                    id: dynamic.action_id,\n                    target_type: (\n                      dynamic.target_type === 'article' ? 'article' :\n                      dynamic.target_type === 'post' ? 'post' :\n                      dynamic.target_type === 'tool' ? 'tool' :\n                      dynamic.target_type === 'action' ? 'action' : \n                      dynamic.target_type === 'user' ? 'user' : 'article'\n                    ) as 'article' | 'post' | 'tool' | 'action' | 'user',\n                    target_id: dynamic.target_id || 0,\n                    created_at: dynamic.shared_at,\n                    content: dynamic.share_comment || '',\n                    like_count: dynamic.likes_count,\n                    collect_count: dynamic.collects_count,\n                    repost_count: dynamic.reposts_count,\n                    current_user_like_action_id: dynamic.like_action_id,\n                    current_user_collect_action_id: dynamic.collect_action_id,\n                    // 确保图片能够传递\n                    images: dynamic.images || [],\n                    // 将DynamicDetails转换为Dynamic接口所需的格式\n                    original_action: dynamic.original_action ? {\n                      id: dynamic.original_action.action_id,\n                      created_at: dynamic.original_action.shared_at,\n                      content: dynamic.original_action.share_comment || '',\n                      target_type: (\n                        dynamic.original_action.target_type === 'article' ? 'article' :\n                        dynamic.original_action.target_type === 'post' ? 'post' :\n                        dynamic.original_action.target_type === 'tool' ? 'tool' :\n                        dynamic.original_action.target_type === 'action' ? 'action' : \n                        dynamic.original_action.target_type === 'user' ? 'user' : 'article'\n                      ) as 'article' | 'post' | 'tool' | 'action' | 'user',\n                      target_id: dynamic.original_action.target_id || 0,\n                    } : null,\n                    // 其他必要的属性，确保传递正确的头像URL\n                    author: {\n                      id: Number(userId),\n                      nickname: dynamic.sharer_username,\n                      avatar: userInfo?.avatar_url || `https://ui-avatars.com/api/?name=${encodeURIComponent(dynamic.sharer_username)}&background=0D8ABC&color=fff`, // 明确传递头像URL\n                      email: userInfo?.email // 提供email作为备用名称来源\n                    },\n                    target_article: dynamic.target_type === 'article' ? {\n                      id: dynamic.target_id || 0,\n                      title: dynamic.target_title || '',\n                      slug: dynamic.target_slug || '',\n                    } : null,\n                    target_post: dynamic.target_type === 'post' ? {\n                      id: dynamic.target_id || 0,\n                      title: dynamic.target_title || '',\n                      slug: dynamic.target_slug || '',\n                    } : null,\n                    target_tool: dynamic.target_type === 'tool' ? {\n                      id: dynamic.target_id || 0,\n                      name: dynamic.target_title || '',\n                      slug: dynamic.target_slug || '',\n                    } : null,\n                  };\n                  \n                  console.log('传递给DynamicCard的数据:', dynamicCardData);\n                  \n                  return (\n                    <div \n                      key={dynamic.action_id} \n                      className=\"cursor-pointer\"\n                      onClick={() => openDynamicModal(dynamic)}\n                    >\n                      <DynamicCard \n                        dynamic={dynamicCardData}\n                        onActionComplete={handleDynamicActionComplete}\n                      />\n                    </div>\n                  );\n                })}\n                \n                {/* 加载更多参考点 */}\n                {hasMore && (\n                  <div ref={loadMoreRef} className=\"py-4 text-center\">\n                    {isLoadingMore && (\n                      <div className=\"flex justify-center items-center\">\n                        <div className=\"animate-spin rounded-full h-6 w-6 border-t-2 border-b-2 border-blue-500\"></div>\n                      </div>\n                    )}\n                  </div>\n                )}\n              </div>\n            )}\n          </>\n        )}\n      </div>\n      \n      {/* 动态详情模态框 */}\n      <Modal\n        isOpen={isModalOpen}\n        onClose={closeDynamicModal}\n      >\n        <DynamicDetailView \n          dynamic={selectedDynamic}\n          onClose={closeDynamicModal}\n          onRepostSuccess={handleRepostSuccess}\n          onInteractionChange={handleInteractionChange}\n        />\n      </Modal>\n    </div>\n  );\n};\n\nexport default UserActivitiesPage; "],"names":["_ref","images","initialIndex","onClose","isOpen","currentIndex","setCurrentIndex","useState","useEffect","handleKeyDown","e","key","nextImage","prevImage","window","addEventListener","removeEventListener","useCallback","prev","length","viewerContent","_jsx","className","onClick","children","_jsxs","stopPropagation","src","alt","style","maxWidth","maxHeight","objectFit","borderRadius","_Fragment","createPortal","document","body","formatCommentDate","dateString","Date","toLocaleString","year","month","day","hour","minute","CommentItem","_comment$user","_comment$user2","_comment$user3","_comment$user4","comment","currentUser","depth","isLastReply","token","replyToCommentId","setReplyToCommentId","replyContent","setReplyContent","handleReplySubmit","submittingReply","handleDeleteComment","forceExpandCommentId","handleLikeComment","userId","user","id","userNickname","nickname","userEmail","email","userAvatar","avatar","displayName","split","indentStyle","paddingLeft","isCollapsed","setIsCollapsed","isReplying","canDelete","is_deleted","hasReplies","replies","replyBoxRef","useRef","localIsLiked","setLocalIsLiked","is_liked","localLikesCount","setLocalLikesCount","likes_count","isLiking","setIsLiking","countTotalReplies","arguments","undefined","total","reply","totalRepliesCount","useMemo","handleClickOutside","event","current","contains","target","left","UserAvatar","username","size","showName","created_at","content","title","BsArrowReturnRight","async","error","toast","info","disabled","FaHeart","FaRegHeart","BsTrash","ref","value","onChange","placeholder","rows","autoFocus","trim","FaSpinner","map","index","_ref2","_dynamic$images","_dynamic$images2","_dynamic$images3","_dynamic$images4","_dynamic$images5","_dynamic$images6","_dynamic$images7","_dynamic$images8","_currentUser$email","dynamic","onRepostSuccess","onInteractionChange","useAuth","location","useLocation","comments","setComments","loadingComments","setLoadingComments","commentError","setCommentError","newComment","setNewComment","submittingComment","setSubmittingComment","setSubmittingReply","is_liked_by_current_user","localIsCollected","setLocalIsCollected","is_collected_by_current_user","localCollectsCount","setLocalCollectsCount","collects_count","localRepostsCount","setLocalRepostsCount","reposts_count","interactionError","setInteractionError","isRepostModalOpen","setIsRepostModalOpen","repostComment","setRepostComment","submittingRepost","setSubmittingRepost","repostError","setRepostError","setForceExpandCommentId","commentInputRef","isImageViewerOpen","setIsImageViewerOpen","currentImageIndex","setCurrentImageIndex","sharerAvatarUrl","avatarUrl","processedUrl","includes","isFullUrl","startsWith","isStaticPath","isFilenameOnly","urlParts","API_BASE_URL","baseUrlWithoutPath","relativePath","getImageUrl","sharer_avatar_url","sharerName","sharer_username","sharerInitial","charAt","toUpperCase","countTotalComments","commentList","count","totalCommentCount","fetchComments","action_id","console","log","response","axios","get","headers","data","Array","isArray","warn","err","_err$response","_err$response2","_err$response3","isAxiosError","message","responseStatus","status","responseData","requestConfig","config","post","parent_id","parentId","_response$data","Error","newReply","addReplyRecursively","currentComments","pId","replyToAdd","prevComments","confirm","delete","commentId","_response$data2","updatedDataFromBackend","updateCommentState","targetId","updates","success","_err$response4","_err$response4$data","errorMsg","timer","setTimeout","clearTimeout","handleCommentSubmit","_response$data3","handleInteractionClick","currentIsLiked","currentIsCollected","currentLikeActionId","like_action_id","currentCollectActionId","collect_action_id","targetDynamicId","originalLiked","originalLikesCount","originalCollected","originalCollectsCount","interactionType","Authorization","payload","action_type","target_type","target_id","updatedDynamicData","_response$data4","_response$data5","_response$data6","_response$data7","_err$response5","_err$response5$data","isLiked","updateCommentLikeStatus","commentsList","sharer_id","Link","to","rel","onError","imgElement","display","fallbackElement","nextElementSibling","shared_at","IoMdClose","share_comment","ReactMarkdown","remarkPlugins","remarkGfm","slice","imageUrl","_dynamic$images9","original_action","QuotedDynamicView","targetLink","type","slug","target_slug","generateTargetLink","target_title","commentsSection","getElementById","scrollIntoView","behavior","FaRegCommentDots","handleRepostClick","FaRetweet","FaBookmark","FaRegBookmark","onKeyDown","ctrlKey","metaKey","pathname","search","Modal","ShareDynamicModal","onSubmit","targetActionId","_err$response6","_err$response6$data","Promise","reject","setComment","isLoading","dynamicToShare","altText","ImageViewer","UserActivitiesPage","useParams","navigate","useNavigate","userInfo","setUserInfo","dynamics","setDynamics","setIsLoading","setError","page","setPage","hasMore","setHasMore","isLoadingMore","setIsLoadingMore","selectedDynamic","setSelectedDynamic","isModalOpen","setIsModalOpen","observerRef","loadMoreRef","fetchUserInfo","avatar_url","fetchUserDynamics","pageNum","params","limit","filteredDynamics","filter","observer","IntersectionObserver","entries","entry","isIntersecting","rootMargin","observe","disconnect","closeDynamicModal","handleDynamicActionComplete","UserAvatarWithImage","FaCalendarAlt","toLocaleDateString","formatJoinDate","joined_at","bio","article_count","post_count","follower_count","following_count","dynamicCardData","like_count","collect_count","repost_count","current_user_like_action_id","current_user_collect_action_id","author","Number","encodeURIComponent","target_article","target_post","target_tool","name","item","_item$sharer_id","determined_action_type","is_repost","dynamicDetails","openDynamicModal","DynamicCard","onActionComplete","DynamicDetailView","handleRepostSuccess","updatedDynamic","prevDynamics"],"sourceRoot":""}