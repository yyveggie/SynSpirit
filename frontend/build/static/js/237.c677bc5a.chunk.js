"use strict";(self.webpackChunkai_tools_website_frontend=self.webpackChunkai_tools_website_frontend||[]).push([[237],{2188:(e,t,s)=>{s.d(t,{A:()=>i});var l=s(5043),a=s(7950),r=s(579);const i=e=>{let{images:t,initialIndex:s=0,onClose:i,isOpen:n}=e;const[o,c]=(0,l.useState)(s);(0,l.useEffect)((()=>{n&&c(s)}),[n,s]),(0,l.useEffect)((()=>{const e=e=>{"Escape"===e.key?i():"ArrowRight"===e.key?d():"ArrowLeft"===e.key&&u()};return n&&window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)}),[n,i]);const d=(0,l.useCallback)((()=>{c((e=>(e+1)%t.length))}),[t.length]),u=(0,l.useCallback)((()=>{c((e=>(e-1+t.length)%t.length))}),[t.length]);if(!n||!t.length)return null;const m=(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/75",onClick:i,children:(0,r.jsxs)("div",{className:"relative bg-black p-1 sm:p-2 rounded-lg shadow-xl max-w-[95vw] sm:max-w-2xl md:max-w-3xl lg:max-w-4xl",onClick:e=>e.stopPropagation(),children:[(0,r.jsx)("div",{className:"flex items-center justify-center",children:(0,r.jsx)("img",{src:t[o],alt:`View ${o+1} of ${t.length}`,style:{maxWidth:"calc(100vw - 40px)",maxHeight:"calc(100vh - 80px)",objectFit:"contain",borderRadius:"4px"}})}),t.length>1&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{"aria-label":"Previous image",className:"absolute left-2 sm:left-3 top-1/2 -translate-y-1/2 w-10 h-10 flex items-center justify-center text-white text-3xl rounded-full bg-black/40 hover:bg-black/60 transition-all",onClick:e=>{e.stopPropagation(),u()},children:"\u2039"}),(0,r.jsx)("button",{"aria-label":"Next image",className:"absolute right-2 sm:right-3 top-1/2 -translate-y-1/2 w-10 h-10 flex items-center justify-center text-white text-3xl rounded-full bg-black/40 hover:bg-black/60 transition-all",onClick:e=>{e.stopPropagation(),d()},children:"\u203a"}),(0,r.jsxs)("div",{className:"absolute bottom-2 sm:bottom-3 left-1/2 -translate-x-1/2 px-3 py-1 text-sm text-white bg-black/50 rounded-md",children:[o+1," / ",t.length]})]})]})});return(0,a.createPortal)(m,document.body)}},5237:(e,t,s)=>{s.r(t),s.d(t,{default:()=>C});var l=s(5043),a=s(3216),r=s(6213),i=s(4558),n=s(6625),o=s(8560),c=s(5475),d=s(9774),u=s(8605),m=s(2115),x=s(5584),h=s(9285),g=s(5369),p=s(4960),v=s(2127),_=s(6199),f=s(2188),b=s(1502),y=s(579);const j=e=>new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"}),N=e=>{var t,s,a,r;let{comment:i,currentUser:n,depth:o=0,isLastReply:c=!1,token:d,replyToCommentId:u,setReplyToCommentId:x,replyContent:h,setReplyContent:p,handleReplySubmit:f,submittingReply:b,formatCommentDate:j,handleDeleteComment:w,forceExpandCommentId:k,handleLikeComment:C}=e;const $=null===(t=i.user)||void 0===t?void 0:t.id,A=null===(s=i.user)||void 0===s?void 0:s.nickname,R=null===(a=i.user)||void 0===a?void 0:a.email,S=null===(r=i.user)||void 0===r?void 0:r.avatar,E=A||(null===R||void 0===R?void 0:R.split("@")[0])||"\u533f\u540d\u7528\u6237",z={paddingLeft:1.5*o+"rem"},[I,D]=(0,l.useState)(o>=3),B=u===i.id,L=n&&$&&n.id===$&&!i.is_deleted,J=i.replies&&i.replies.length>0,P=(0,l.useRef)(null),[W,T]=(0,l.useState)(i.is_liked||!1),[U,O]=(0,l.useState)(i.likes_count||0),[M,F]=(0,l.useState)(!1),K=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=e.length;for(const s of e)s.replies&&s.replies.length>0&&(t+=K(s.replies));return t},q=(0,l.useMemo)((()=>K(i.replies||[])),[i.replies]);return(0,l.useEffect)((()=>{if(!B)return;const e=e=>{P.current&&!P.current.contains(e.target)&&x(null)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[B,x]),(0,l.useEffect)((()=>{k===i.id&&D(!1)}),[k,i.id]),(0,l.useEffect)((()=>{T(i.is_liked||!1),O(i.likes_count||0)}),[i.is_liked,i.likes_count]),(0,y.jsxs)("div",{className:"relative pt-2 comment-item text-gray-200",children:[o>0&&(0,y.jsx)("div",{className:"absolute left-0 top-0 w-0.5 bg-gray-500/50 "+(c?"h-4":"h-full"),style:{left:1.5*(o-1)+.75+"rem"}}),o>0&&(0,y.jsx)("div",{className:"absolute left-0 top-4 w-3 h-0.5 bg-gray-500/50",style:{left:1.5*(o-1)+.75+"rem"}}),(0,y.jsxs)("div",{style:z,className:"comment-content-wrapper",children:[(0,y.jsxs)("div",{className:"flex items-start space-x-2 mb-1",children:[$&&(0,y.jsx)(_.A,{userId:$,username:E,avatar:S,size:"sm",className:"mr-3",showName:!1}),!$&&(0,y.jsxs)("div",{className:"flex items-center",children:[(0,y.jsx)("div",{className:"w-6 h-6 rounded-full mr-3 flex items-center justify-center bg-gray-500 text-white text-xs",children:"?"}),(0,y.jsx)("span",{className:"font-medium text-gray-300 text-sm",children:E})]}),(0,y.jsx)("span",{className:"text-gray-400 text-xs pt-1",children:j(i.created_at)})]}),(0,y.jsxs)("div",{className:"pl-8 "+(i.is_deleted?"text-gray-500 italic":"text-gray-100"),children:[(0,y.jsx)("p",{className:"text-sm whitespace-pre-wrap break-words mb-1.5",children:i.content}),!i.is_deleted&&(0,y.jsxs)("div",{className:"flex items-center space-x-3 text-xs mt-1 text-gray-400",children:[J&&(0,y.jsx)("button",{onClick:()=>D(!I),className:"text-xs text-blue-400 hover:text-blue-300 focus:outline-none flex items-center mr-1","aria-label":I?"\u5c55\u5f00\u56de\u590d":"\u6536\u8d77\u56de\u590d",title:I?"\u5c55\u5f00\u56de\u590d":"\u6536\u8d77\u56de\u590d",children:I?(0,y.jsxs)("span",{children:["[+",q,"]"]}):(0,y.jsx)("span",{children:"[-]"})}),(0,y.jsx)("button",{onClick:()=>x(B?null:i.id),className:"flex items-center hover:text-blue-400 p-0.5 rounded "+(B?"text-blue-400":""),title:B?"\u53d6\u6d88\u56de\u590d":"\u56de\u590d",children:(0,y.jsx)(v.zDP,{})}),(0,y.jsxs)("button",{onClick:async()=>{if(d){if(!M&&!i.is_deleted){F(!0),T(!W),O(W?U-1:U+1);try{await C(i.id,W)}catch(e){T(!W),O(W?U:U-1),m.oR.error("\u70b9\u8d5e\u64cd\u4f5c\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5")}finally{F(!1)}}}else m.oR.info("\u8bf7\u5148\u767b\u5f55\u540e\u518d\u70b9\u8d5e")},disabled:M,className:"flex items-center p-0.5 rounded "+(W?"text-pink-500 hover:text-pink-400":"hover:text-pink-400"),children:[W?(0,y.jsx)(g.Mbv,{}):(0,y.jsx)(g.sOK,{}),U>0&&(0,y.jsx)("span",{className:"ml-1 text-xs",children:U})]}),L&&(0,y.jsx)("button",{onClick:()=>w(i.id),className:"flex items-center hover:text-red-400 p-0.5 rounded",title:"\u5220\u9664\u8bc4\u8bba",children:(0,y.jsx)(v.WeY,{})})]}),B&&(0,y.jsxs)("div",{ref:P,className:"mt-2 relative",children:[(0,y.jsx)("textarea",{value:h,onChange:e=>p(e.target.value),placeholder:`\u56de\u590d ${E}...`,rows:2,className:"w-full px-2 py-1.5 pb-10 text-sm border border-gray-600/50 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 resize-none bg-gray-700/70 backdrop-blur-sm text-gray-100 placeholder-gray-400",autoFocus:!0}),(0,y.jsx)("button",{onClick:()=>f(i.id),disabled:!h.trim()||b,className:"absolute bottom-2 right-2 p-1.5 rounded-md text-white "+(!h.trim()||b?"text-gray-500 cursor-not-allowed":"text-blue-400 hover:text-blue-300 hover:bg-white/10"),title:"\u53d1\u9001\u56de\u590d",children:b?(0,y.jsx)(g.hW,{className:"animate-spin h-4 w-4"}):(0,y.jsx)(v.zDP,{className:"h-5 w-5"})})]})]})]}),!I&&i.replies&&i.replies.length>0&&(0,y.jsx)("div",{className:"replies-container mt-2",children:i.replies.map(((e,t)=>(0,y.jsx)(N,{comment:e,currentUser:n,depth:o+1,isLastReply:t===i.replies.length-1,token:d,replyToCommentId:u,setReplyToCommentId:x,replyContent:h,setReplyContent:p,handleReplySubmit:f,submittingReply:b,formatCommentDate:j,handleDeleteComment:w,forceExpandCommentId:k,handleLikeComment:C},e.id)))})]})},w=e=>{var t,s,o,_,w,k,C,$,A;let{dynamic:R,onClose:S,onRepostSuccess:E,onInteractionChange:z}=e;const{user:I,token:D}=(0,n.A)(),B=(0,a.zy)(),[L,J]=(0,l.useState)([]),[P,W]=(0,l.useState)(!1),[T,U]=(0,l.useState)(null),[O,M]=(0,l.useState)(""),[F,K]=(0,l.useState)(!1),[q,V]=(0,l.useState)(null),[Z,G]=(0,l.useState)(""),[H,Q]=(0,l.useState)(!1),[X,Y]=(0,l.useState)((null===R||void 0===R?void 0:R.is_liked_by_current_user)||!1),[ee,te]=(0,l.useState)((null===R||void 0===R?void 0:R.likes_count)||0),[se,le]=(0,l.useState)((null===R||void 0===R?void 0:R.is_collected_by_current_user)||!1),[ae,re]=(0,l.useState)((null===R||void 0===R?void 0:R.collects_count)||0),[ie,ne]=(0,l.useState)((null===R||void 0===R?void 0:R.reposts_count)||0),[oe,ce]=(0,l.useState)(null),[de,ue]=(0,l.useState)(!1),[me,xe]=(0,l.useState)(""),[he,ge]=(0,l.useState)(!1),[pe,ve]=(0,l.useState)(null),[_e,fe]=(0,l.useState)(null),be=(0,l.useRef)(null),[ye,je]=(0,l.useState)(!1),[Ne,we]=(0,l.useState)(0),ke=(0,l.useMemo)((()=>(e=>{if(!e)return"https://ui-avatars.com/api/?name=User&background=0D8ABC&color=fff&size=40";let t=e;e.includes("cos.ap-shanghai.myqcloud.com");const s=e.startsWith("http://")||e.startsWith("https://"),l=e.startsWith("/static")||e.startsWith("uploads/"),a=!e.includes("/");if(s)t=e;else if(l){const s=i.JR.split("/"),l=`${s[0]}//${s[2]}`,a=e.startsWith("/")?e:`/${e}`;t=e.startsWith("/static")?`${l}${a}`:`${l}/static/${e}`}else if(a){const s=i.JR.split("/");t=`${s[0]}//${s[2]}/static/uploads/${e}`}else t=e;return t})(null===R||void 0===R?void 0:R.sharer_avatar_url)),[null===R||void 0===R?void 0:R.sharer_avatar_url]),Ce=(null===R||void 0===R?void 0:R.sharer_username)||"\u672a\u77e5\u7528\u6237",$e=(0,l.useMemo)((()=>Ce.charAt(0).toUpperCase()||"U"),[Ce]),Ae=(0,l.useCallback)((e=>{let t=0;for(const s of e)s.is_deleted||(t+=1,s.replies&&s.replies.length>0&&(t+=Ae(s.replies)));return t}),[]),Re=(0,l.useMemo)((()=>Ae(L)),[L,Ae]),Se=(0,l.useCallback)((async()=>{if(null!==R&&void 0!==R&&R.action_id){W(!0),U(null),console.log(`[fetchComments] Fetching comments for action_id: ${R.action_id}`);try{const e=await r.A.get(`${i.JR}/api/actions/${R.action_id}/comments`,{headers:D?{Authorization:`Bearer ${D}`}:{}});console.log("[fetchComments] API Response:",e),e.data&&Array.isArray(e.data.comments)?J(e.data.comments):(console.warn("[fetchComments] Invalid data structure received:",e.data),J([]),U("\u8bc4\u8bba\u6570\u636e\u683c\u5f0f\u4e0d\u6b63\u786e\u3002"))}catch(l){var e,t,s;if(console.error("\u83b7\u53d6\u5206\u4eab\u8bc4\u8bba\u5931\u8d25 (fetchComments error):",l),r.A.isAxiosError(l))console.error("Axios error details:",{message:l.message,responseStatus:null===(e=l.response)||void 0===e?void 0:e.status,responseData:null===(t=l.response)||void 0===t?void 0:t.data,requestConfig:l.config}),U(`\u65e0\u6cd5\u52a0\u8f7d\u8bc4\u8bba (${(null===(s=l.response)||void 0===s?void 0:s.status)||"Network Error"})\u3002`);else console.error("Non-Axios error:",l),U("\u65e0\u6cd5\u52a0\u8f7d\u8bc4\u8bba (\u672a\u77e5\u9519\u8bef)\u3002");J([])}finally{W(!1)}}else console.warn("[fetchComments] dynamic or action_id is missing, skipping fetch."),J([]),W(!1)}),[null===R||void 0===R?void 0:R.action_id,D]),Ee=(0,l.useCallback)((async e=>{if(null!==R&&void 0!==R&&R.action_id&&D&&Z.trim()){Q(!0),U(null),fe(null);try{const s=await r.A.post(`${i.JR}/api/actions/${R.action_id}/comments`,{content:Z.trim(),parent_id:e},{headers:{Authorization:`Bearer ${D}`}});var t;if(201!==s.status||!s.data)throw new Error((null===(t=s.data)||void 0===t?void 0:t.error)||"\u63d0\u4ea4\u56de\u590d\u5931\u8d25");{const t=s.data,l=(e,t,s)=>e.map((e=>e.id===t?{...e,replies:[s,...e.replies||[]]}:e.replies&&e.replies.length>0?{...e,replies:l(e.replies,t,s)}:e));J((s=>l(s,e,t))),V(null),G(""),fe(e)}}catch(s){console.error("\u63d0\u4ea4\u56de\u590d\u5931\u8d25:",s),U(s.message||"\u53d1\u8868\u56de\u590d\u65f6\u51fa\u9519\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002")}finally{Q(!1)}}}),[null===R||void 0===R?void 0:R.action_id,D,Z,J,V,G,U,Q,fe]),ze=(0,l.useCallback)((async e=>{if(D){if(window.confirm("\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u6761\u8bc4\u8bba\u5417\uff1f"))try{const s=await r.A.delete(`${i.JR}/api/comments/${e}`,{headers:{Authorization:`Bearer ${D}`}});var t;if(200!==s.status||!s.data)throw new Error((null===(t=s.data)||void 0===t?void 0:t.error)||"\u5220\u9664\u8bc4\u8bba\u65f6\u670d\u52a1\u5668\u8fd4\u56de\u610f\u5916\u54cd\u5e94");{const t=s.data,l=(e,t,s)=>e.map((e=>e.id===t?{...e,is_deleted:!0,content:s.content||"[\u8be5\u8bc4\u8bba\u5df2\u5220\u9664]"}:e.replies&&e.replies.length>0?{...e,replies:l(e.replies,t,s)}:e));J((s=>l(s,e,t))),m.oR.success("\u8bc4\u8bba\u5df2\u5220\u9664")}}catch(a){var s,l;console.error("\u5220\u9664\u8bc4\u8bba\u5931\u8d25:",a);const e=(null===(s=a.response)||void 0===s||null===(l=s.data)||void 0===l?void 0:l.error)||a.message||"\u5220\u9664\u8bc4\u8bba\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002";m.oR.error(e)}}else m.oR.error("\u8bf7\u5148\u767b\u5f55")}),[D,J]);if((0,l.useEffect)((()=>{if(!de){const e=setTimeout((()=>{xe(""),ve(null)}),300);return()=>clearTimeout(e)}}),[de]),(0,l.useEffect)((()=>{Y((null===R||void 0===R?void 0:R.is_liked_by_current_user)||!1),te((null===R||void 0===R?void 0:R.likes_count)||0),le((null===R||void 0===R?void 0:R.is_collected_by_current_user)||!1),re((null===R||void 0===R?void 0:R.collects_count)||0),ne((null===R||void 0===R?void 0:R.reposts_count)||0)}),[R]),(0,l.useEffect)((()=>{console.log(`Action ID changed or component mounted: ${null===R||void 0===R?void 0:R.action_id}. Fetching comments.`),Se()}),[Se,null===R||void 0===R?void 0:R.action_id]),!R)return(0,y.jsxs)("div",{className:"bg-white p-6 rounded-lg max-w-3xl w-full mx-auto text-center shadow-lg",children:[(0,y.jsx)(g.hW,{className:"animate-spin h-8 w-8 text-blue-500 mx-auto mb-4"}),(0,y.jsx)("p",{className:"text-gray-500",children:"\u6b63\u5728\u52a0\u8f7d\u52a8\u6001\u8be6\u60c5..."})]});const Ie=async()=>{if(null!==R&&void 0!==R&&R.action_id&&D&&O.trim()){K(!0),U(null);try{const t=await r.A.post(`${i.JR}/api/actions/${R.action_id}/comments`,{content:O.trim(),parent_id:null},{headers:{Authorization:`Bearer ${D}`}});var e;if(201!==t.status||!t.data)throw new Error((null===(e=t.data)||void 0===e?void 0:e.error)||"\u63d0\u4ea4\u8bc4\u8bba\u5931\u8d25");J((e=>[t.data,...e])),M("")}catch(t){console.error("\u63d0\u4ea4\u8bc4\u8bba\u5931\u8d25:",t),U(t.message||"\u53d1\u8868\u8bc4\u8bba\u65f6\u51fa\u9519\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002")}finally{K(!1)}}},De=async e=>{if(!D||!R)return void ce("\u8bf7\u5148\u767b\u5f55\u518d\u64cd\u4f5c");ce(null);const t=X,s=se,l=R.like_action_id,a=R.collect_action_id,n=R.action_id,o=X,c=ee,d=se,u=ae;"like"===e?(Y(!t),te(t?ee-1:ee+1)):(le(!s),re(s?ae-1:ae+1));try{let o;if("like"===e)if(t&&l)o=await r.A.delete(`${i.JR}/api/actions/${l}`,{headers:{Authorization:`Bearer ${D}`}});else{const e={action_type:"like",target_type:"action",target_id:n};o=await r.A.post(`${i.JR}/api/actions`,e,{headers:{Authorization:`Bearer ${D}`}})}else if(s&&a)o=await r.A.delete(`${i.JR}/api/actions/${a}`,{headers:{Authorization:`Bearer ${D}`}});else{const e={action_type:"collect",target_type:"action",target_id:n};o=await r.A.post(`${i.JR}/api/actions`,e,{headers:{Authorization:`Bearer ${D}`}})}const d={...R};if("like"===e){var m;var x;if(!(t?200===o.status||204===o.status:(201===o.status||200===o.status)&&(null===(m=o.data)||void 0===m?void 0:m.id)))throw new Error((null===(x=o.data)||void 0===x?void 0:x.error)||`\u70b9\u8d5e\u64cd\u4f5cAPI\u5931\u8d25\uff0c\u72b6\u6001\u7801: ${o.status}`);d.is_liked_by_current_user=!t,d.likes_count=t?c-1:c+1,d.like_action_id=t?null:o.data.id}else{var h;var g;if(!(s?200===o.status||204===o.status:(201===o.status||200===o.status)&&(null===(h=o.data)||void 0===h?void 0:h.id)))throw new Error((null===(g=o.data)||void 0===g?void 0:g.error)||`\u6536\u85cf\u64cd\u4f5cAPI\u5931\u8d25\uff0c\u72b6\u6001\u7801: ${o.status}`);d.is_collected_by_current_user=!s,d.collects_count=s?u-1:u+1,d.collect_action_id=s?null:o.data.id}null===z||void 0===z||z(d),console.log(`${e}\u64cd\u4f5c\u6210\u529f\uff0c\u5e76\u901a\u77e5\u7236\u7ec4\u4ef6:`,d)}catch(_){var p,v;console.error(`${e}\u64cd\u4f5c\u5931\u8d25:`,_),ce(`\u64cd\u4f5c\u5931\u8d25: ${_.message||(null===(p=_.response)||void 0===p||null===(v=p.data)||void 0===v?void 0:v.error)||"\u8bf7\u7a0d\u540e\u91cd\u8bd5"}`),"like"===e?(Y(o),te(c)):(le(d),re(u))}},Be=async(e,t)=>{if(D)try{t?await r.A.delete(`${i.JR}/api/comments/${e}/like?target_type=action`,{headers:{Authorization:`Bearer ${D}`}}):await r.A.post(`${i.JR}/api/comments/${e}/like?target_type=action`,{},{headers:{Authorization:`Bearer ${D}`}});const s=l=>l.map((l=>l.id===e?{...l,is_liked:!t,likes_count:t?(l.likes_count||1)-1:(l.likes_count||0)+1}:l.replies&&l.replies.length>0?{...l,replies:s(l.replies)}:l));J((e=>s(e)))}catch(s){throw console.error("\u8bc4\u8bba\u70b9\u8d5e\u64cd\u4f5c\u5931\u8d25:",s),s}else m.oR.info("\u8bf7\u5148\u767b\u5f55")};return(0,y.jsxs)("div",{className:"w-[1200px] max-w-[1200px] h-[90vh] flex flex-col md:flex-row gap-4 overflow-hidden",children:[(0,y.jsxs)("div",{className:"w-full md:w-7/12 flex flex-col h-full bg-gray-900/30 backdrop-blur-xl rounded-2xl overflow-hidden shadow-lg",children:[(0,y.jsxs)("div",{className:"flex items-center p-4 border-b border-white/5 flex-shrink-0 bg-black/15 backdrop-blur-lg",children:[R.sharer_id?(0,y.jsxs)(c.N_,{to:`/profile/${R.sharer_id}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center group",children:[(0,y.jsxs)("div",{className:"relative w-10 h-10 mr-3 flex-shrink-0",children:[(0,y.jsx)("img",{src:ke,alt:`${Ce} avatar`,className:"w-10 h-10 rounded-full object-cover transition-transform duration-200 group-hover:scale-105",onError:e=>{const t=e.target;t.style.display="none";const s=t.nextElementSibling;s&&(s.style.display="flex")}}),(0,y.jsx)("div",{className:"w-10 h-10 rounded-full bg-gray-300 flex items-center justify-center text-lg font-bold absolute top-0 left-0 text-gray-600",style:{display:"none"},children:$e})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("span",{className:"font-semibold text-gray-100 block leading-tight group-hover:text-blue-400 transition-colors",children:Ce}),(0,y.jsxs)("span",{className:"text-xs text-gray-400",children:["\u53d1\u5e03\u4e8e ",j(R.shared_at)]})]})]}):(0,y.jsxs)("div",{className:"flex items-center",children:[(0,y.jsxs)("div",{className:"relative w-10 h-10 mr-3 flex-shrink-0",children:[(0,y.jsx)("img",{src:ke,alt:`${Ce} avatar`,className:"w-10 h-10 rounded-full object-cover",onError:e=>{const t=e.target;t.style.display="none";const s=t.nextElementSibling;s&&(s.style.display="flex")}}),(0,y.jsx)("div",{className:"w-10 h-10 rounded-full bg-gray-300 flex items-center justify-center text-lg font-bold absolute top-0 left-0 text-gray-600",style:{display:"none"},children:$e})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("span",{className:"font-semibold text-gray-100 block leading-tight",children:Ce}),(0,y.jsxs)("span",{className:"text-xs text-gray-400",children:["\u53d1\u5e03\u4e8e ",j(R.shared_at)]})]})]}),(0,y.jsx)("button",{onClick:S,className:"ml-auto text-gray-300 hover:text-white transition-colors p-1.5 rounded-full hover:bg-white/10","aria-label":"\u5173\u95ed",children:(0,y.jsx)(p.WQq,{size:22})})]}),(0,y.jsx)("div",{className:"flex-grow overflow-y-auto p-4 scrollbar-thin scrollbar-thumb-white/20 scrollbar-track-transparent",children:(0,y.jsxs)("div",{className:"mb-4",children:[R.share_comment&&(0,y.jsx)("div",{className:"text-white mb-3 break-words leading-relaxed markdown-content prose prose-invert prose-sm max-w-none [&>p]:text-white",children:(0,y.jsx)(x.oz,{remarkPlugins:[h.A],children:R.share_comment})}),R.images&&R.images.length>0&&(0,y.jsx)("div",{className:"mt-2 mb-3 relative",children:(0,y.jsx)("div",{className:"image-gallery relative overflow-hidden rounded-lg "+(1===(null===(t=R.images)||void 0===t?void 0:t.length)?"max-h-[350px]":""),children:1===(null===(s=R.images)||void 0===s?void 0:s.length)?(0,y.jsxs)("div",{className:"relative w-full h-full",children:[(0,y.jsx)("img",{src:null===(o=R.images)||void 0===o?void 0:o[0],alt:"\u5206\u4eab\u56fe\u7247",className:"w-full h-full object-contain bg-black/20 cursor-pointer hover:opacity-95 transition-opacity rounded-lg",onClick:()=>{we(0),je(!0)},onError:e=>{e.target.src="/images/image-error.png"}}),(0,y.jsx)("div",{className:"absolute bottom-0 right-0 p-1.5 bg-black/50 text-white text-xs rounded-tl-md backdrop-blur-sm",children:"\u70b9\u51fb\u67e5\u770b\u5927\u56fe"})]}):(0,y.jsx)("div",{className:"grid gap-1 "+(2===(null===(_=R.images)||void 0===_?void 0:_.length)?"grid-cols-2":3===(null===(w=R.images)||void 0===w?void 0:w.length)?"grid-cols-3":4===(null===(k=R.images)||void 0===k?void 0:k.length)?"grid-cols-2 grid-rows-2":(null===(C=R.images)||void 0===C?void 0:C.length)<=6?"grid-cols-3 grid-rows-2":"grid-cols-3 grid-rows-3"),children:null===($=R.images)||void 0===$?void 0:$.slice(0,9).map(((e,t)=>{var s;return(0,y.jsxs)("div",{className:`relative overflow-hidden rounded-md bg-black/10 ${R.images&&R.images.length<=4?"h-28":"h-24"} ${R.images&&3===R.images.length&&0===t?"col-span-full row-span-1":""}`,children:[(0,y.jsx)("img",{src:e,alt:`\u5206\u4eab\u56fe\u7247 ${t+1}`,className:"w-full h-full object-cover cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>{we(t),je(!0)},onError:e=>{e.target.src="/images/image-error.png"}}),8===t&&R.images&&R.images.length>9&&(0,y.jsxs)("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center text-white cursor-pointer",onClick:()=>{we(8),je(!0)},children:["+",((null===(s=R.images)||void 0===s?void 0:s.length)||0)-9]})]},t)}))})})}),R.original_action?(0,y.jsx)("div",{className:"mt-2 mb-3 px-4 text-white",children:(0,y.jsx)(u.A,{dynamic:R.original_action})}):(()=>{const e=(t=R.target_type,s=R.target_slug,R.target_id,"post"===t?s?`/posts/${s}`:null:"article"===t?s?`/article/${s}`:null:"tool"===t&&s?`/tool/${s}`:null);var t,s;return e?(0,y.jsxs)("div",{className:"mt-2 p-3 bg-black/15 backdrop-blur-md rounded-lg border border-white/5",children:[(0,y.jsxs)("p",{className:"text-xs text-gray-400 mb-1",children:["\u5206\u4eab\u7684","post"===R.target_type?"\u5e16\u5b50":"article"===R.target_type?"\u6587\u7ae0":"\u5de5\u5177",":"]}),(0,y.jsx)(c.N_,{to:e,className:"font-semibold text-blue-400 hover:underline",onClick:S,children:R.target_title||"\u67e5\u770b\u539f\u6587"})]}):"deleted"===R.target_type?(0,y.jsx)("div",{className:"mt-2 p-3 bg-black/15 backdrop-blur-md rounded-lg border border-white/5 text-gray-500 italic",children:"\u5185\u5bb9\u5df2\u88ab\u5220\u9664"}):null})()]})}),(0,y.jsxs)("div",{className:"border-0 p-4 flex-shrink-0 bg-black/15 backdrop-blur-lg",children:[(0,y.jsx)("div",{className:"flex justify-between items-center border-t border-gray-700 pt-4 mt-4",children:(0,y.jsxs)("div",{className:"flex items-center gap-4",children:[(0,y.jsxs)("button",{className:"flex items-center gap-1 text-gray-300 hover:text-blue-400 transition",onClick:()=>{const e=document.getElementById("comments-section");e&&e.scrollIntoView({behavior:"smooth"})},children:[(0,y.jsx)(g.Nhu,{className:"text-lg"}),(0,y.jsx)("span",{className:"text-sm",children:Re})]}),(0,y.jsxs)("button",{className:"flex items-center gap-1 text-gray-300 hover:text-green-400 transition",onClick:()=>{D?ue(!0):m.oR.info("\u8bf7\u5148\u767b\u5f55\u518d\u8fdb\u884c\u8f6c\u53d1\u3002")},children:[(0,y.jsx)(g._TB,{className:"text-lg"}),(0,y.jsx)("span",{className:"text-sm",children:ie})]}),(0,y.jsxs)("button",{className:"flex items-center gap-1 transition "+(X?"text-pink-500":"text-gray-300 hover:text-pink-500"),onClick:()=>De("like"),disabled:!D,children:[X?(0,y.jsx)(g.Mbv,{className:"text-lg"}):(0,y.jsx)(g.sOK,{className:"text-lg"}),(0,y.jsx)("span",{className:"text-sm",children:ee})]}),(0,y.jsxs)("button",{className:"flex items-center gap-1 transition "+(se?"text-yellow-400":"text-gray-300 hover:text-yellow-400"),onClick:()=>De("collect"),disabled:!D,children:[se?(0,y.jsx)(g.U$b,{className:"text-lg"}):(0,y.jsx)(g.gGX,{className:"text-lg"}),(0,y.jsx)("span",{className:"text-sm",children:ae})]})]})}),oe&&(0,y.jsx)("p",{className:"text-red-400 text-xs text-center mt-2",children:oe})]})]}),(0,y.jsxs)("div",{className:"w-full md:w-5/12 flex flex-col h-full bg-gray-900/30 backdrop-blur-xl rounded-2xl overflow-hidden shadow-lg",children:[(0,y.jsx)("div",{className:"p-4 flex-shrink-0 bg-black/15 backdrop-blur-lg",children:(0,y.jsxs)("h3",{className:"text-lg font-semibold text-gray-100",children:["\u8bc4\u8bba ",Re>0?`(${Re})`:""]})}),(0,y.jsx)("div",{className:"flex-grow overflow-y-auto p-4 space-y-4 scrollbar-thin scrollbar-thumb-white/20 scrollbar-track-transparent border-b-0",children:P?(0,y.jsx)("div",{className:"text-center py-4",children:(0,y.jsx)(g.hW,{className:"animate-spin h-5 w-5 text-gray-400 mx-auto"})}):T?(0,y.jsx)("p",{className:"text-red-400 text-center",children:T}):0===L.length?(0,y.jsx)("p",{className:"text-gray-400 text-center italic py-4",children:"\u8fd8\u6ca1\u6709\u8bc4\u8bba\uff0c\u5feb\u6765\u62a2\u6c99\u53d1\u5427\uff01"}):(Le=L,Le&&0!==Le.length?(0,y.jsx)("div",{className:"space-y-3",children:Le.map(((e,t)=>(0,y.jsx)(N,{comment:e,currentUser:I,depth:0,isLastReply:t===Le.length-1,token:D,replyToCommentId:q,setReplyToCommentId:V,replyContent:Z,setReplyContent:G,handleReplySubmit:Ee,submittingReply:H,formatCommentDate:j,handleDeleteComment:ze,forceExpandCommentId:_e,handleLikeComment:Be},e.id)))}):(0,y.jsx)("p",{className:"text-center text-gray-500 text-sm py-4",children:"\u6682\u65e0\u8bc4\u8bba\u3002"}))}),(0,y.jsx)("div",{className:"border-0 p-4 flex-shrink-0 bg-black/15 backdrop-blur-lg",children:D?(0,y.jsxs)("div",{className:"relative",children:[(0,y.jsx)("textarea",{ref:be,className:"w-full px-3 py-2 pb-14 bg-black/5 backdrop-blur-xl rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500 text-gray-100 text-sm h-20 resize-y border-none placeholder-gray-400 focus:ring-opacity-75",placeholder:"\u5206\u4eab\u4f60\u7684\u770b\u6cd5...",value:O,onChange:e=>M(e.target.value),onKeyDown:e=>{(e.ctrlKey||e.metaKey)&&"Enter"===e.key&&Ie()}}),(0,y.jsx)("div",{className:"absolute bottom-4 right-3 flex items-center space-x-2",children:(0,y.jsx)("button",{onClick:Ie,disabled:!O.trim()||F,className:"p-1.5 text-blue-400 hover:text-blue-300 rounded-md transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center w-7 h-7 focus:outline-none focus:ring-1 focus:ring-offset-1 focus:ring-offset-black/15 focus:ring-blue-500 hover:bg-white/10",title:"\u63d0\u4ea4\u8bc4\u8bba (Cmd/Ctrl+Enter)",children:F?(0,y.jsx)(g.hW,{className:"animate-spin h-4 w-4"}):(0,y.jsx)(v.zDP,{className:"h-5 w-5"})})})]}):(0,y.jsxs)("div",{className:"text-center text-sm text-gray-300",children:["\u8bf7 ",(0,y.jsx)(c.N_,{to:`/login?redirect=${B.pathname}${B.search}`,className:"text-blue-400 hover:underline",children:"\u767b\u5f55"})," \u540e\u53c2\u4e0e\u8bc4\u8bba"]})})]}),(0,y.jsx)(d.A,{isOpen:de,onClose:()=>ue(!1),children:(0,y.jsx)(b.A,{isOpen:de,onClose:()=>ue(!1),onSubmit:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(D&&null!==R&&void 0!==R&&R.action_id){ge(!0),ve(null);try{const s=R.action_id;await r.A.post(`${i.JR}/api/actions`,{action_type:"share",target_type:"action",target_id:s,content:e,images:t.length>0?t:void 0},{headers:{Authorization:`Bearer ${D}`}});ue(!1),xe(""),ne(ie+1),null===E||void 0===E||E(),m.oR.success("\u5206\u4eab\u6210\u529f\uff01")}catch(a){var s,l;return console.error("\u8f6c\u53d1\u5931\u8d25:",a),ve(`\u8f6c\u53d1\u5931\u8d25: ${(null===(s=a.response)||void 0===s||null===(l=s.data)||void 0===l?void 0:l.error)||"\u8bf7\u7a0d\u540e\u91cd\u8bd5"}`),Promise.reject(a)}finally{ge(!1)}}else ve("\u65e0\u6cd5\u8f6c\u53d1\uff0c\u7f3a\u5c11\u5fc5\u8981\u4fe1\u606f\u3002")},comment:me,setComment:xe,error:pe,isLoading:he,dynamicToShare:R,username:(null===I||void 0===I?void 0:I.nickname)||(null===I||void 0===I||null===(A=I.email)||void 0===A?void 0:A.split("@")[0])||"\u60a8",altText:`\u8f6c\u53d1 ${(null===R||void 0===R?void 0:R.sharer_username)||"\u7528\u6237"} \u7684\u52a8\u6001`})}),R.images&&R.images.length>0&&(0,y.jsx)(f.A,{images:R.images,initialIndex:Ne,isOpen:ye,onClose:()=>je(!1)})]});var Le};var k=s(5128);const C=()=>{const{userId:e}=(0,a.g)(),t=(0,a.Zp)(),{token:s}=(0,n.A)(),[c,u]=(0,l.useState)(null),[m,x]=(0,l.useState)([]),[h,p]=(0,l.useState)(!0),[v,_]=(0,l.useState)(null),[f,b]=(0,l.useState)(1),[j,N]=(0,l.useState)(!0),[C,$]=(0,l.useState)(!1),[A,R]=(0,l.useState)(null),[S,E]=(0,l.useState)(!1),z=(0,l.useRef)(null),I=(0,l.useRef)(null),D=(0,l.useCallback)((async()=>{if(e)try{const t=await r.A.get(`${i.JR}/api/users/${e}`,{headers:s?{Authorization:`Bearer ${s}`}:void 0});t.data&&(console.log("\u83b7\u53d6\u5230\u7684\u7528\u6237\u4fe1\u606f:",t.data),console.log("\u7528\u6237\u5934\u50cfURL:",t.data.avatar_url),u(t.data))}catch(t){console.error("\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u5931\u8d25:",t),_("\u65e0\u6cd5\u52a0\u8f7d\u7528\u6237\u4fe1\u606f")}}),[e,s]),B=(0,l.useCallback)((async t=>{if(e)try{1===t?p(!0):$(!0);const l=await r.A.get(`${i.JR}/api/users/${e}/dynamics`,{params:{page:t,limit:10},headers:s?{Authorization:`Bearer ${s}`}:void 0});if(l.data&&Array.isArray(l.data.dynamics)){console.log("\u83b7\u53d6\u5230\u7684\u7528\u6237\u52a8\u6001:",l.data.dynamics);const e=l.data.dynamics.filter((e=>!e.is_deleted));console.log("\u8fc7\u6ee4\u540e\u7684\u52a8\u6001\u6570\u91cf:",e.length),x(1===t?e:t=>[...t,...e]),N(10===e.length)}else N(!1)}catch(l){console.error("\u83b7\u53d6\u7528\u6237\u52a8\u6001\u5931\u8d25:",l),_("\u65e0\u6cd5\u52a0\u8f7d\u7528\u6237\u52a8\u6001")}finally{1===t?p(!1):$(!1)}}),[e,s]);(0,l.useEffect)((()=>{e&&(b(1),D(),B(1))}),[e,D,B]),(0,l.useEffect)((()=>{if(h||!j)return;const e=new IntersectionObserver((e=>{const[t]=e;t.isIntersecting&&!C&&b((e=>e+1))}),{rootMargin:"0px 0px 100px 0px"});return z.current=e,I.current&&e.observe(I.current),()=>{z.current&&z.current.disconnect()}}),[h,j,C]),(0,l.useEffect)((()=>{f>1&&B(f)}),[f,B]);const L=()=>{E(!1),setTimeout((()=>{R(null)}),300)},J=()=>{};return(0,y.jsxs)("div",{className:"flex flex-col min-h-screen bg-transparent text-white",children:[(0,y.jsx)("div",{className:"container mx-auto p-4 flex-grow",children:v?(0,y.jsxs)("div",{className:"text-center py-8",children:[(0,y.jsx)("p",{className:"text-xl text-red-400",children:v}),(0,y.jsx)("button",{onClick:()=>t("/"),className:"mt-4 px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-md transition",children:"\u8fd4\u56de\u9996\u9875"})]}):h&&!c?(0,y.jsx)("div",{className:"flex justify-center items-center py-16",children:(0,y.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):(0,y.jsxs)(y.Fragment,{children:[c&&(0,y.jsx)("div",{className:"bg-gray-800/70 rounded-lg p-5 mb-6 shadow-lg",children:(0,y.jsxs)("div",{className:"flex flex-col md:flex-row items-center md:items-start gap-4",children:[(0,y.jsx)("div",{className:"relative",children:(0,y.jsx)(k.A,{userId:c.id,username:c.nickname||c.email.split("@")[0],avatarUrl:c.avatar_url,size:"lg",showName:!1})}),(0,y.jsxs)("div",{className:"flex-grow text-center md:text-left",children:[(0,y.jsx)("h2",{className:"text-2xl font-bold",children:c.nickname||c.email.split("@")[0]}),(0,y.jsxs)("div",{className:"flex items-center justify-center md:justify-start text-gray-400 mt-1",children:[(0,y.jsx)(g.bfZ,{className:"mr-1"}),(0,y.jsxs)("span",{className:"text-sm",children:["\u52a0\u5165\u4e8e ",(e=>{try{return new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})}catch(v){return e}})(c.joined_at)]})]}),c.bio&&(0,y.jsx)("p",{className:"mt-3 text-gray-300",children:c.bio}),(0,y.jsxs)("div",{className:"mt-4 flex flex-wrap gap-6 justify-center md:justify-start",children:[(0,y.jsxs)("div",{className:"text-center",children:[(0,y.jsx)("div",{className:"text-xl font-semibold",children:c.article_count}),(0,y.jsx)("div",{className:"text-sm text-gray-400",children:"\u6587\u7ae0"})]}),(0,y.jsxs)("div",{className:"text-center",children:[(0,y.jsx)("div",{className:"text-xl font-semibold",children:c.post_count}),(0,y.jsx)("div",{className:"text-sm text-gray-400",children:"\u5e16\u5b50"})]}),(0,y.jsxs)("div",{className:"text-center",children:[(0,y.jsx)("div",{className:"text-xl font-semibold",children:c.follower_count}),(0,y.jsx)("div",{className:"text-sm text-gray-400",children:"\u7c89\u4e1d"})]}),(0,y.jsxs)("div",{className:"text-center",children:[(0,y.jsx)("div",{className:"text-xl font-semibold",children:c.following_count}),(0,y.jsx)("div",{className:"text-sm text-gray-400",children:"\u5173\u6ce8"})]})]})]})]})}),(0,y.jsx)("h2",{className:"text-xl font-bold mb-4",children:"\u7528\u6237\u52a8\u6001"}),h&&0===m.length?(0,y.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,y.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-blue-500"})}):0===m.length?(0,y.jsx)("div",{className:"text-center py-8 bg-gray-800/30 rounded-lg",children:(0,y.jsx)("p",{className:"text-lg text-gray-400",children:"\u8be5\u7528\u6237\u8fd8\u6ca1\u6709\u4efb\u4f55\u52a8\u6001"})}):(0,y.jsxs)("div",{className:"space-y-4",children:[m.map((t=>{console.log("\u6e32\u67d3\u52a8\u6001\u4fe1\u606f:",t),console.log("\u4f20\u9012\u7ed9\u52a8\u6001\u5361\u7247\u7684\u5934\u50cfURL:",null===c||void 0===c?void 0:c.avatar_url);const s={id:t.action_id,target_type:"article"===t.target_type?"article":"post"===t.target_type?"post":"tool"===t.target_type?"tool":"action"===t.target_type?"action":"user"===t.target_type?"user":"article",target_id:t.target_id||0,created_at:t.shared_at,content:t.share_comment||"",like_count:t.likes_count,collect_count:t.collects_count,repost_count:t.reposts_count,current_user_like_action_id:t.like_action_id,current_user_collect_action_id:t.collect_action_id,images:t.images||[],original_action:t.original_action?{id:t.original_action.action_id,created_at:t.original_action.shared_at,content:t.original_action.share_comment||"",target_type:"article"===t.original_action.target_type?"article":"post"===t.original_action.target_type?"post":"tool"===t.original_action.target_type?"tool":"action"===t.original_action.target_type?"action":"user"===t.original_action.target_type?"user":"article",target_id:t.original_action.target_id||0}:null,author:{id:Number(e),nickname:t.sharer_username,avatar:(null===c||void 0===c?void 0:c.avatar_url)||`https://ui-avatars.com/api/?name=${encodeURIComponent(t.sharer_username)}&background=0D8ABC&color=fff`,email:null===c||void 0===c?void 0:c.email},target_article:"article"===t.target_type?{id:t.target_id||0,title:t.target_title||"",slug:t.target_slug||""}:null,target_post:"post"===t.target_type?{id:t.target_id||0,title:t.target_title||"",slug:t.target_slug||""}:null,target_tool:"tool"===t.target_type?{id:t.target_id||0,name:t.target_title||"",slug:t.target_slug||""}:null};return console.log("\u4f20\u9012\u7ed9DynamicCard\u7684\u6570\u636e:",s),(0,y.jsx)("div",{className:"cursor-pointer",onClick:()=>(e=>{var t;let s;s=e.is_repost?"share":"user"===e.target_type?"create_status":"share";const l={action_id:e.action_id,share_comment:e.share_comment,action_type:s,shared_at:e.shared_at,sharer_id:null!==(t=e.sharer_id)&&void 0!==t?t:null,sharer_username:e.sharer_username,sharer_avatar_url:e.sharer_avatar_url,is_repost:e.is_repost,original_action:e.original_action,target_type:e.target_type,target_title:e.target_title,target_slug:e.target_slug,target_id:e.target_id,likes_count:e.likes_count||0,collects_count:e.collects_count||0,reposts_count:e.reposts_count||0,is_liked_by_current_user:e.is_liked_by_current_user||!1,is_collected_by_current_user:e.is_collected_by_current_user||!1,like_action_id:e.like_action_id||null,collect_action_id:e.collect_action_id||null};R(l),E(!0)})(t),children:(0,y.jsx)(o.A,{dynamic:s,onActionComplete:J})},t.action_id)})),j&&(0,y.jsx)("div",{ref:I,className:"py-4 text-center",children:C&&(0,y.jsx)("div",{className:"flex justify-center items-center",children:(0,y.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-t-2 border-b-2 border-blue-500"})})})]})]})}),(0,y.jsx)(d.A,{isOpen:S,onClose:L,children:(0,y.jsx)(w,{dynamic:A,onClose:L,onRepostSuccess:()=>{b(1),B(1)},onInteractionChange:e=>{x((t=>t.map((t=>t.action_id===e.action_id?{...t,likes_count:e.likes_count,collects_count:e.collects_count,reposts_count:e.reposts_count,is_liked_by_current_user:e.is_liked_by_current_user,is_collected_by_current_user:e.is_collected_by_current_user,like_action_id:e.like_action_id,collect_action_id:e.collect_action_id}:t)))),(null===A||void 0===A?void 0:A.action_id)===e.action_id&&R(e)}})})]})}}}]);
//# sourceMappingURL=237.c677bc5a.chunk.js.map