"use strict";(self.webpackChunkai_tools_website_frontend=self.webpackChunkai_tools_website_frontend||[]).push([[803],{1803:(e,o,t)=>{t.r(o),t.d(o,{default:()=>v});var i=t(5043),s=t(3216),n=t(6625),a=t(2358),r=t(6636),l=t(3248),c=t(6213),p=t(8261),u=t(7097),d=t(4558),g=t(2115);var h=t(579);const v=()=>{const{slug:e}=(0,s.g)(),o=(0,s.Zp)(),{user:t,token:v}=(0,n.A)(),{isSidebarOpen:T}=(0,r.c)(),m=(0,l.jE)(),{data:f,isLoading:$,isError:y,error:F}=(e=>{const o=["relationshipTopicDetails",e];return(0,p.I)({queryKey:o,queryFn:async()=>{if(!e)throw new Error("\u65e0\u6548\u7684\u5173\u7cfb\u4e3b\u9898\u6807\u8bc6\u7b26");console.log(`[useRelationshipTopicDetails] Fetching details for slug: ${e}`);const o=await c.A.get(`${d.JR}/api/relationship-topics/slug/${e}`);if(!o.data||"object"!==typeof o.data||!o.data.id)throw new Error("\u4ece\u540e\u7aef\u83b7\u53d6\u7684\u5173\u7cfb\u4e3b\u9898\u6570\u636e\u683c\u5f0f\u4e0d\u6b63\u786e\u6216\u7f3a\u5c11 ID");return console.log("[useRelationshipTopicDetails] Fetched details:",o.data),o.data},enabled:!!e,staleTime:9e5,gcTime:18e5,retry:(e,o)=>{var t;return 404!==(null===o||void 0===o||null===(t=o.response)||void 0===t?void 0:t.status)&&e<3}})})(e),{data:R,isLoading:w,isError:_,error:D}=(e=>{const o=["relationshipTopicPosts",e];return(0,p.I)({queryKey:o,queryFn:async()=>{if(!e)return{posts:[],total:0};console.log(`[useRelationshipTopicPosts] Fetching posts for relationship topic ID: ${e}`);const o=(new Date).getTime(),t=`${d.JR}/api/relationship-topics/${e}/posts?fields=id,title,content,summary,category,tags,author,cover_image,slug,view_count,created_at,like_count,collect_count,share_count,comment_count&_=${o}`;console.log(`[useRelationshipTopicPosts] Request URL: ${t}`);const i=await c.A.get(t,{headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}});if(i.data&&Array.isArray(i.data.posts)){const e=i.data.posts.filter((e=>!e.content));if(e.length>0)console.warn(`[useRelationshipTopicPosts] \u8b66\u544a: ${e.length}/${i.data.posts.length} \u5e16\u5b50\u7f3a\u5c11content\u5b57\u6bb5`),e.length>0&&(console.warn(`[useRelationshipTopicPosts] \u7b2c\u4e00\u4e2a\u7f3a\u5c11content\u7684\u5e16\u5b50ID: ${e[0].id}, \u6807\u9898: ${e[0].title}`),console.warn("[useRelationshipTopicPosts] \u8be5\u5e16\u5b50\u6240\u6709\u5b57\u6bb5:",JSON.stringify(e[0],null,2)));else if(console.log(`[useRelationshipTopicPosts] \u6240\u6709\u5e16\u5b50\u90fd\u5305\u542bcontent\u5b57\u6bb5\uff0c\u5171 ${i.data.posts.length} \u7bc7`),i.data.posts.length>0){var s;const e=i.data.posts[0];console.log(`[useRelationshipTopicPosts] \u7b2c\u4e00\u4e2a\u5e16\u5b50ID: ${e.id}, \u6807\u9898: ${e.title}, content\u957f\u5ea6: ${(null===(s=e.content)||void 0===s?void 0:s.length)||0}`)}}return console.log("[useRelationshipTopicPosts] Fetched posts:",i.data.posts),i.data},enabled:!!e,staleTime:3e5,gcTime:6e5,refetchOnMount:!0,refetchOnWindowFocus:!0})})(null===f||void 0===f?void 0:f.id),E=(()=>{const e=(0,l.jE)();return(0,u.n)({mutationFn:async e=>{let{relTopicId:o,token:t,currentFavoriteState:i}=e;if(!t)throw new Error("\u7528\u6237\u672a\u767b\u5f55");const s={Authorization:`Bearer ${t}`},n=`${d.JR}/api/users/favorites/relationship-topics`;i?(console.log(`[useToggleRelTopicFav] Attempting DELETE for relTopic ID: ${o}`),await c.A.delete(`${n}/${o}`,{headers:s})):(console.log(`[useToggleRelTopicFav] Attempting POST for relTopic ID: ${o}`),await c.A.post(n,{relationship_topic_id:o},{headers:s}))},onSuccess:(o,t)=>{const i=t.currentFavoriteState?"\u53d6\u6d88\u6536\u85cf":"\u6536\u85cf";g.oR.success(`\u5df2${i} "${t.relTopicName}"`),console.log(`[useToggleRelTopicFav Success] Toggled favorite for RelTopic ID: ${t.relTopicId}`),e.invalidateQueries({queryKey:["userFavoritesList"]})},onError:(e,o)=>{console.error("[useToggleRelTopicFav Error]:",e),g.oR.error("\u64cd\u4f5c\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5")}})})(),P=(null===R||void 0===R?void 0:R.posts)||[],I=$,A=y?(null===F||void 0===F?void 0:F.message)||"\u52a0\u8f7d\u5173\u7cfb\u4e3b\u9898\u8be6\u60c5\u65f6\u51fa\u9519":_?(null===D||void 0===D?void 0:D.message)||"\u52a0\u8f7d\u5e16\u5b50\u5217\u8868\u65f6\u51fa\u9519":null,b=(0,i.useCallback)((async()=>{if(!f||!t||E.isPending||!v)return void console.log("[DEBUG RelFav] toggleFavorite prerequisite not met or mutation is pending.");const o=f.id,i=f.name,s=f.is_favorited||!1;E.mutate({relTopicId:o,token:v,currentFavoriteState:s,relTopicName:i},{onSuccess:()=>{console.log(`[Toggle RelTopic Favorite Success] Invalidating relationshipTopicDetails for slug: ${e}`),m.invalidateQueries({queryKey:["relationshipTopicDetails",e]})},onError:()=>{}})}),[f,t,v,E,m,e]),S=(0,i.useCallback)((()=>{f?o(`/community/${f.slug}/new-post`,{state:{relationshipTopicId:f.id,relationshipTopicName:f.name,parentType:"relationship"}}):console.error("\u65e0\u6cd5\u521b\u5efa\u5e16\u5b50\uff0c\u5173\u7cfb\u4e3b\u9898\u8be6\u60c5\u672a\u52a0\u8f7d\u3002")}),[o,f]);return(0,h.jsx)(h.Fragment,{children:(0,h.jsx)(a.A,{isLoading:I,error:A,topicDetails:f?{id:f.id,name:f.name,slug:f.slug,description:f.description}:null,posts:P,isLoadingPosts:w,parentType:"relationship",parentSlug:null===f||void 0===f?void 0:f.slug,showFavoriteButton:!0,isFavorited:(null===f||void 0===f?void 0:f.is_favorited)||!1,isLoadingFavorite:E.isPending,onToggleFavorite:b,onCreatePost:S,showChatButton:!0,isChatAvailable:!0})})}}}]);
//# sourceMappingURL=803.d719dd5b.chunk.js.map