"use strict";(self.webpackChunkai_tools_website_frontend=self.webpackChunkai_tools_website_frontend||[]).push([[777],{4028:(e,t,o)=>{o.r(t),o.d(t,{default:()=>g});var s=o(5043),a=o(3216),l=o(6782),n=o(4077),i=o(3227),r=(o(6299),o(6213)),c=o(4558),d=o(6636),u=o(579);const g=()=>{const e=(0,a.Zp)(),{isSidebarOpen:t}=(0,d.c)(),[o,g,p]=(0,l.ck)([]),[h,f,m]=(0,l.fM)([]),[b,x]=(0,s.useState)(!0),[v,k]=(0,s.useState)(null),[w,$]=(0,s.useState)(!1),[y,N]=(0,s.useState)("idle"),j=(0,s.useRef)(null),[C,_]=(0,s.useState)(!1);(0,s.useEffect)((()=>{localStorage.getItem("token")&&$(!0)}),[]),(0,s.useEffect)((()=>{(async()=>{x(!0),k(null);try{const e=localStorage.getItem("token"),t=!!e;$(t);const o=t?`${c.JR}/api/topics/user_network`:`${c.JR}/api/topics/network`,s=t?{headers:{Authorization:`Bearer ${e}`}}:{},a=await r.A.get(o,s);console.log("Fetched network data:",a.data),g(a.data.nodes||[]),f(a.data.edges||[])}catch(e){console.error("Failed to fetch topic network:",e),k("\u65e0\u6cd5\u52a0\u8f7d\u793e\u533a\u7f51\u7edc\u56fe\u6570\u636e\u3002")}finally{x(!1)}})()}),[g,f]);const S=(0,s.useCallback)((e=>f((t=>(0,l.rN)(e,t)))),[f]),z=(0,s.useCallback)((async()=>{if(w&&C){N("saving");try{const e=localStorage.getItem("token"),t=await r.A.post(`${c.JR}/api/topics/save_positions`,{nodes:o},{headers:{Authorization:`Bearer ${e}`}});console.log("Positions saved:",t.data),N("saved"),_(!1),setTimeout((()=>{N("idle")}),3e3)}catch(e){console.error("Failed to save node positions:",e),N("error")}}}),[o,w,C]),A=(0,s.useCallback)((()=>{j.current&&clearTimeout(j.current),j.current=setTimeout((()=>{z()}),2e3)}),[z]),I=(0,s.useCallback)((()=>{console.log("Node dragging stopped, scheduling position save"),_(!0),A()}),[A]),E=(0,s.useCallback)(((t,o)=>{var s;const a=null===(s=o.data)||void 0===s?void 0:s.slug;a?(console.log(`\u8282\u70b9 ${o.id} (${o.data.label}) \u88ab\u70b9\u51fb, slug: ${a}, \u5bfc\u822a\u5230 /community/topic/${a}`),e(`/community/topic/${a}`)):console.warn(`\u8282\u70b9 ${o.id} (${o.data.label}) \u88ab\u70b9\u51fb, \u4f46\u7f3a\u5c11 slug \u6570\u636e`)}),[e]),R=(0,s.useCallback)((async(t,o)=>{console.log(`\u8fb9 ${o.id} (\u4ece ${o.source} \u5230 ${o.target}) \u88ab\u70b9\u51fb`);const s=localStorage.getItem("token");if(s)try{var a;const t=await r.A.post(`${c.JR}/api/relationship-topics/from-topics`,{topic_id_1:parseInt(o.source),topic_id_2:parseInt(o.target)},{headers:{Authorization:`Bearer ${s}`}}),l=null===(a=t.data)||void 0===a?void 0:a.slug;l?(console.log(`\u83b7\u53d6\u5230\u5173\u7cfb\u4e3b\u9898 slug: ${l}, \u5bfc\u822a\u5230 /community/relationship-topic/${l}`),e(`/community/relationship-topic/${l}`)):console.error("\u4ece\u540e\u7aef\u83b7\u53d6\u5173\u7cfb\u4e3b\u9898 slug \u5931\u8d25",t.data)}catch(l){console.error("\u8c03\u7528 /from-topics \u63a5\u53e3\u5931\u8d25:",l),l.response&&401===l.response.status&&console.error("\u8ba4\u8bc1\u5931\u8d25\u6216\u4ee4\u724c\u8fc7\u671f")}else console.warn("\u7528\u6237\u672a\u767b\u5f55\uff0c\u65e0\u6cd5\u521b\u5efa\u6216\u8df3\u8f6c\u5230\u5173\u7cfb\u4e3b\u9898\u3002")}),[e]);return(0,s.useEffect)((()=>()=>{j.current&&clearTimeout(j.current)}),[]),(0,u.jsx)("div",{className:"flex flex-col h-screen text-white",children:(0,u.jsx)("div",{className:"flex flex-1 overflow-hidden pt-16",children:(0,u.jsx)("main",{className:"flex-1 transition-all duration-300 ease-in-out overflow-auto "+(t?"lg:ml-56":"ml-0"),children:(0,u.jsxs)("div",{className:"w-full h-full relative",children:[b&&(0,u.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-900/50 z-10",children:(0,u.jsx)("p",{className:"text-white text-lg",children:"\u6b63\u5728\u52a0\u8f7d\u7f51\u7edc\u56fe..."})}),v&&(0,u.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-red-900/80 z-10",children:(0,u.jsxs)("p",{className:"text-white text-lg",children:["\u9519\u8bef: ",v]})}),"idle"!==y&&(0,u.jsx)("div",{className:"absolute top-4 left-4 py-2 px-4 rounded-md z-20 transition-opacity duration-300 \n                backdrop-filter backdrop-blur-md border border-gray-200/30\n                "+("saving"===y?"bg-blue-500/70 text-white":"saved"===y?"bg-green-500/70 text-white":"bg-red-500/70 text-white"),children:"saving"===y?"\u4fdd\u5b58\u4e2d...":"saved"===y?"\u5df2\u4fdd\u5b58":"\u4fdd\u5b58\u5931\u8d25"}),!b&&!v&&(0,u.jsxs)(l.Gc,{nodes:o,edges:h,onNodesChange:p,onEdgesChange:m,onConnect:S,onNodeDragStop:I,onNodeClick:E,onEdgeClick:R,fitView:!0,className:"bg-transparent",children:[(0,u.jsx)(n.H,{}),(0,u.jsx)(i.V,{gap:12,size:1,color:"#4a5568"})]})]})})})})}}}]);
//# sourceMappingURL=777.ec6f6dcc.chunk.js.map