"use strict";(self.webpackChunkai_tools_website_frontend=self.webpackChunkai_tools_website_frontend||[]).push([[477],{7477:(e,t,a)=>{a.r(t),a.d(t,{default:()=>u});var s=a(5043),l=a(3216),r=a(4558),o=a(6625),i=a(6213),n=a(1745),d=a(6636),c=a(3248),g=a(579);const m=["AI\u53d1\u5c55","\u6295\u8d44","\u672a\u6765","\u5fc3\u7406","\u7406\u6027","\u65f6\u95f4"],u=()=>{const{slug:e}=(0,l.g)(),t=Boolean(e),a=(0,c.jE)(),[u,x]=(0,s.useState)(""),[p,h]=(0,s.useState)(""),[f,b]=(0,s.useState)(""),[y,v]=(0,s.useState)(""),[j,N]=(0,s.useState)(null),[w,k]=(0,s.useState)(null),[S,A]=(0,s.useState)(t),[_,C]=(0,s.useState)([]),[$,E]=(0,s.useState)(""),[F,D]=(0,s.useState)(""),[R,T]=(0,s.useState)(!1),[B,K]=(0,s.useState)(null),[L,z]=(0,s.useState)(null),[H,I]=(0,s.useState)(null),[J,q]=(0,s.useState)(!1),[M,O]=(0,s.useState)(!0),P=(0,l.Zp)(),{token:U,user:Q,isLoading:W}=(0,o.A)(),{isSidebarOpen:X}=(0,d.c)(),Z=(0,s.useRef)(null),G=(0,s.useCallback)((e=>{h(e)}),[]);(0,s.useEffect)((()=>{if(!W){if(U)if(Q)console.log("\u7528\u6237\u5df2\u767b\u5f55:",Q.email);else{console.log("\u4ee4\u724c\u5b58\u5728\u4f46\u672a\u83b7\u53d6\u5230\u7528\u6237\u4fe1\u606f");P("/login",{state:{from:t?`/edit-article/${e}`:"/new-article-toast"}})}else{console.log("\u6ca1\u6709\u68c0\u6d4b\u5230\u767b\u5f55\u4ee4\u724c\uff0c\u8df3\u8f6c\u5230\u767b\u5f55\u9875\u9762");P("/login",{state:{from:t?`/edit-article/${e}`:"/new-article-toast"}})}O(!1)}}),[U,Q,P,W,t,e]),(0,s.useEffect)((()=>{if(t&&e&&U){(async()=>{A(!0),z(null);try{const t=await i.A.get(`${r.JR}/api/articles/slug/${e}`,{headers:{Authorization:`Bearer ${U}`}});console.log("\u83b7\u53d6\u5230\u7684\u6587\u7ae0\u6570\u636e:",t.data);const a=t.data;if(x(a.title||""),h(a.content||""),b(a.category||""),a.tags&&Array.isArray(a.tags)){const e=a.tags.map((e=>String(e).trim())).map((e=>e.replace(/^#+/,""))).map((e=>e.replace(/[\[\]"']/g,""))).filter((e=>e.length>0));console.log("\u6e05\u7406\u540e\u7684\u6807\u7b7e:",e),v(e.join("\uff0c"))}else console.log("\u6587\u7ae0\u6ca1\u6709\u6807\u7b7e\u6216\u6807\u7b7e\u683c\u5f0f\u4e0d\u6b63\u786e:",a.tags),v("");a.cover_image&&(N(a.cover_image),k(a.cover_image)),E(a.series_name||"")}catch(s){var t,a;console.error("Error fetching article data for editing:",s),z((null===(t=s.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.error)||s.message||"\u65e0\u6cd5\u52a0\u8f7d\u6587\u7ae0\u6570\u636e\u8fdb\u884c\u7f16\u8f91")}finally{A(!1)}})()}}),[t,e,U]),(0,s.useEffect)((()=>{U&&"undefined"!==U&&!M&&(async()=>{if(U&&"undefined"!==U&&!M){T(!0),K(null);try{console.log("\u5f00\u59cb\u83b7\u53d6\u7528\u6237\u7cfb\u5217\uff0c\u4ee4\u724c:",U.substring(0,10)+"...");const e=await i.A.get(`${r.JR}/api/articles/user/series`,{headers:{Authorization:`Bearer ${U}`}});console.log("\u83b7\u53d6\u5230\u7684\u7cfb\u5217\u6570\u636e:",e.data),e.data&&Array.isArray(e.data.series_names)?C(e.data.series_names||[]):(console.warn("\u7cfb\u5217\u6570\u636e\u683c\u5f0f\u5f02\u5e38:",e.data),C([]))}catch(e){console.error("\u83b7\u53d6\u7cfb\u5217\u5931\u8d25:",e),e.response&&401===e.response.status?K("\u767b\u5f55\u5df2\u8fc7\u671f\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55"):K("\u65e0\u6cd5\u52a0\u8f7d\u60a8\u7684\u7cfb\u5217\u5217\u8868")}finally{T(!1)}}})()}),[U,M]);return M||t&&S?(0,g.jsx)("div",{style:{width:"100%",minHeight:"100vh",backgroundColor:"var(--bg-base-color)",backgroundImage:"var(--bg-gradient)",display:"flex",justifyContent:"center",alignItems:"center"},children:(0,g.jsx)("div",{className:"animate-spin text-white",children:(0,g.jsx)("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,g.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})}):!L||t||S?(0,g.jsx)("div",{className:"flex flex-col min-h-screen bg-transparent text-gray-100",children:(0,g.jsx)("div",{className:"flex flex-1 overflow-hidden",children:(0,g.jsxs)("main",{className:"flex-1 px-4 pt-2 pb-4 transition-all duration-300 ease-in-out overflow-y-auto "+(X?"lg:ml-56":"ml-0"),children:[(0,g.jsx)("h1",{className:"text-2xl font-bold mb-4",children:t?"\u7f16\u8f91\u6587\u7ae0":"\u521b\u5efa\u65b0\u6587\u7ae0"}),L&&(0,g.jsx)("div",{className:"bg-red-700 text-white p-3 rounded mb-4",children:L}),H&&(0,g.jsx)("div",{className:"bg-green-700 text-white p-3 rounded mb-4",children:H}),(0,g.jsxs)("form",{onSubmit:async s=>{if(s.preventDefault(),z(null),I(null),q(!0),!u.trim())return z("\u8bf7\u8f93\u5165\u6587\u7ae0\u6807\u9898"),void q(!1);if(!p.trim())return z("\u8bf7\u8f93\u5165\u6587\u7ae0\u5185\u5bb9"),void q(!1);try{const s=new FormData;s.append("title",u),s.append("content",p),f&&s.append("category",f);const l=y?y.replace(/\uff0c/g,",").split(",").map((e=>e.trim())).map((e=>e.replace(/^#+/,""))).map((e=>e.replace(/[\[\]"']/g,""))).filter((e=>e.length>0)):[];0===l.length&&t?(console.log("\u6e05\u7a7a\u6240\u6709\u6807\u7b7e"),s.append("tags","")):l.forEach((e=>{s.append("tags",e)})),console.log("\u89e3\u6790\u5e76\u6e05\u7406\u540e\u7684\u6807\u7b7e\u6570\u7ec4:",l),"\u65b0\u5efa\u7cfb\u5217"===$&&F.trim()?s.append("series_name",F.trim()):$&&"\u65e0"!==$&&"\u65b0\u5efa\u7cfb\u5217"!==$&&s.append("series_name",$),j instanceof File?(console.log("\u6b63\u5728\u4e0a\u4f20\u5c01\u9762\u56fe\u7247\u6587\u4ef6:",j.name),s.append("cover_image",j)):"string"===typeof j&&t&&(console.log("\u4fdd\u7559\u73b0\u6709\u5c01\u9762\u56fe\u7247:",j),s.append("keep_cover_image","true"),s.append("existing_cover_image",j)),console.log("\u63d0\u4ea4\u7684FormData\u5185\u5bb9:");Array.from(s.entries()).forEach((e=>{let[t,a]=e;"cover_image"!==t?console.log(`${t}: ${a}`):console.log(`${t}: [\u6587\u4ef6\u6570\u636e]`)}));const o=t?`${r.JR}/api/articles/${e}`:`${r.JR}/api/articles/`,n=t?"put":"post",d=await(0,i.A)({method:n,url:o,data:s,headers:{Authorization:`Bearer ${U}`,"Content-Type":"multipart/form-data"}});I(t?"\u6587\u7ae0\u66f4\u65b0\u6210\u529f!":"\u6587\u7ae0\u521b\u5efa\u6210\u529f!"),t&&e&&(console.log(`[NewArticlePageToast] \u4f7f\u6587\u7ae0\u7f13\u5b58\u5931\u6548: ${e}`),a.invalidateQueries({queryKey:["articleDetails",e]})),setTimeout((()=>{P(`/article/${d.data.slug}`)}),1500)}catch(n){var l,o;console.error("Error submitting article:",n),z((null===(l=n.response)||void 0===l||null===(o=l.data)||void 0===o?void 0:o.error)||"\u63d0\u4ea4\u6587\u7ae0\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5")}finally{q(!1)}},className:"bg-gray-850/70 p-6 rounded-lg shadow-xl",onKeyDown:e=>{"Enter"===e.key&&e.target instanceof HTMLElement&&"BUTTON"!==e.target.tagName&&("TEXTAREA"===e.target.tagName&&e.shiftKey||e.stopPropagation())},children:[(0,g.jsxs)("div",{className:"mb-4",children:[(0,g.jsx)("label",{htmlFor:"title",className:"block text-gray-200 mb-2 font-medium",children:"\u6587\u7ae0\u6807\u9898"}),(0,g.jsx)("input",{type:"text",id:"title",value:u,onChange:e=>x(e.target.value),onKeyDown:e=>{"Enter"===e.key&&e.preventDefault()},required:!0,className:"w-full p-2 border border-gray-600 rounded bg-gray-700 text-gray-100 focus:ring-indigo-500 focus:border-indigo-500 placeholder-gray-400",placeholder:"\u8f93\u5165\u6587\u7ae0\u6807\u9898..."})]}),(0,g.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-4 gap-y-5 mb-6",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{htmlFor:"category",className:"block text-gray-200 mb-2 text-sm font-medium",children:"\u6587\u7ae0\u5206\u7c7b"}),(0,g.jsxs)("select",{id:"category",value:f,onChange:e=>b(e.target.value),className:"w-full p-2 border border-gray-600 rounded bg-gray-700 text-gray-100 text-sm focus:ring-indigo-500 focus:border-indigo-500",children:[(0,g.jsx)("option",{value:"",children:"-- \u9009\u62e9\u5206\u7c7b --"}),m.map((e=>(0,g.jsx)("option",{value:e,children:e},e)))]})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{htmlFor:"tags",className:"block text-gray-200 mb-2 text-sm font-medium",children:"\u6807\u7b7e (\u7528\u9017\u53f7\u5206\u9694\u591a\u4e2a\u6807\u7b7e)"}),(0,g.jsx)("input",{type:"text",id:"tags",value:y,onChange:e=>v(e.target.value),className:"w-full p-2 border border-gray-600 rounded bg-gray-700 text-gray-100 text-sm focus:ring-indigo-500 focus:border-indigo-500 placeholder-gray-400",placeholder:"\u652f\u6301\u4e2d\u82f1\u6587\u9017\u53f7\uff0c\u5982\uff1aAI\uff0c\u673a\u5668\u5b66\u4e60,\u6570\u636e\u5206\u6790"}),(0,g.jsx)("p",{className:"mt-1 text-xs text-gray-400",children:"\u8f93\u5165\u5355\u4e2a\u6807\u7b7e\u6216\u7528\u9017\u53f7\u5206\u9694\u591a\u4e2a\u6807\u7b7e\uff0c\u65e0\u9700\u6dfb\u52a0#\u6216\u5176\u4ed6\u5b57\u7b26"})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{htmlFor:"series",className:"block text-gray-200 mb-2 text-sm font-medium",children:"\u6240\u5c5e\u7cfb\u5217"}),(0,g.jsxs)("select",{id:"series",value:$,onChange:e=>E(e.target.value),className:"w-full p-2 border border-gray-600 rounded bg-gray-700 text-gray-100 text-sm focus:ring-indigo-500 focus:border-indigo-500",children:[(0,g.jsx)("option",{value:"",children:"-- \u65e0 --"}),_.map((e=>(0,g.jsx)("option",{value:e,children:e},e))),(0,g.jsx)("option",{value:"\u65b0\u5efa\u7cfb\u5217",children:"+ \u65b0\u5efa\u7cfb\u5217"})]}),B&&(0,g.jsx)("p",{className:"mt-1 text-red-500 text-xs",children:B}),"\u65b0\u5efa\u7cfb\u5217"===$&&(0,g.jsxs)("div",{className:"mt-2",children:[(0,g.jsx)("label",{htmlFor:"newSeries",className:"sr-only",children:"\u65b0\u7cfb\u5217\u540d\u79f0"}),(0,g.jsx)("input",{type:"text",id:"newSeries",value:F,onChange:e=>D(e.target.value),className:"w-full p-2 border border-gray-600 rounded bg-gray-700 text-gray-100 text-sm focus:ring-indigo-500 focus:border-indigo-500 placeholder-gray-400",placeholder:"\u8f93\u5165\u65b0\u7cfb\u5217\u540d\u79f0"})]})]}),(0,g.jsxs)("div",{className:"md:col-span-2 lg:col-span-3",children:[(0,g.jsx)("label",{className:"block text-gray-200 mb-2 text-sm font-medium",children:"\u5c01\u9762\u56fe\u7247"}),(0,g.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,g.jsx)("input",{type:"file",ref:Z,onChange:e=>{if(e.target.files&&e.target.files[0]){const t=e.target.files[0];N(t),console.log("\u9009\u62e9\u4e86\u65b0\u5c01\u9762\u56fe\u7247:",t.name,"\u5927\u5c0f:",(t.size/1024).toFixed(2),"KB");const a=new FileReader;a.onloadend=()=>{const e=a.result;k(e),console.log("\u5c01\u9762\u9884\u89c8\u5df2\u751f\u6210")},a.readAsDataURL(t)}},accept:"image/*",className:"text-sm text-gray-300 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-indigo-600 file:text-white hover:file:bg-indigo-700 cursor-pointer"}),w&&(0,g.jsx)("button",{type:"button",onClick:()=>{N(null),k(null),Z.current&&(Z.current.value="")},className:"py-1 px-3 bg-red-600 text-white rounded text-sm hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50",children:"\u6e05\u9664"})]}),w&&(0,g.jsx)("div",{className:"mt-3",children:(0,g.jsx)("img",{src:w,alt:"Cover preview",className:"max-h-32 rounded"})})]})]}),(0,g.jsxs)("div",{className:"mb-6",children:[(0,g.jsx)("label",{className:"block text-gray-200 mb-2 font-medium",children:"\u6587\u7ae0\u5185\u5bb9"}),(0,g.jsx)(n.A,{initialData:p,onChange:G,token:U,placeholder:"\u5f00\u59cb\u5199\u4f5c..."})]}),(0,g.jsx)("div",{className:"flex justify-end mt-6",children:(0,g.jsx)("button",{type:"submit",disabled:J||M||S,className:"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded disabled:opacity-50",children:J?"\u6b63\u5728\u63d0\u4ea4...":t?"\u66f4\u65b0\u6587\u7ae0":"\u53d1\u5e03\u6587\u7ae0"})})]})]})})}):(0,g.jsx)("div",{className:"flex flex-col min-h-screen bg-transparent text-gray-100",children:(0,g.jsx)("div",{className:"flex flex-1 overflow-hidden",children:(0,g.jsx)("main",{className:"flex-1 px-4 pt-2 pb-4 transition-all duration-300 ease-in-out overflow-y-auto "+(X?"lg:ml-56":"ml-0"),children:(0,g.jsxs)("div",{className:"bg-red-700 text-white p-4 rounded shadow-lg text-center",children:[(0,g.jsx)("p",{className:"text-lg font-semibold",children:"\u51fa\u9519\u4e86"}),(0,g.jsx)("p",{children:L}),(0,g.jsx)("button",{onClick:()=>P(t?`/article/${e}`:"/articles"),className:"mt-3 bg-white text-red-700 px-4 py-2 rounded",children:t?"\u8fd4\u56de\u6587\u7ae0":"\u8fd4\u56de\u5217\u8868"})]})})})})}}}]);
//# sourceMappingURL=477.272b0cda.chunk.js.map