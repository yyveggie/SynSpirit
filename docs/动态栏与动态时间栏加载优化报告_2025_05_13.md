# 动态栏与动态时间栏加载优化报告

**日期：2025-05-13**

## 一、背景

为提升网站在高并发和大流量场景下的用户体验，我们对首页右侧的动态栏（DynamicFeed）和点击后弹出的动态时间栏（DynamicTimelineView）进行了系统性的加载优化。

---

## 二、动态栏（DynamicFeed）优化方案

### 1. 骨架屏
- 在初次加载和下拉加载更多时，分别显示骨架屏（SkeletonList 或 loading 动画），避免白屏和突兀跳变。

### 2. 懒加载（无限滚动）
- 采用 TanStack Query 的 useInfiniteQuery 实现分页加载。
- 监听滚动事件，接近底部时自动触发 fetchNextPage 加载下一页。

### 3. 预取下一页
- 在当前页数据加载完成且存在下一页时，自动预取下一页数据（prefetchQuery），提升用户下拉时的响应速度。

### 4. 数据缓存与占位数据
- 利用 react-query 的缓存机制，切换推荐/关注流时可瞬间展示已有数据。
- 切换时不清空数据，减少闪烁。

---

## 三、动态时间栏（DynamicTimelineView）优化方案

### 1. 骨架屏
- 仅在首次加载且无任何数据时显示骨架屏，彻底消除切换时的闪烁。

### 2. 懒加载
- 支持分页加载时间线内容，提升大数据量下的性能。

### 3. 预取
- 鼠标悬停动态卡片时，预取该动态的时间线详情。

### 4. 占位数据
- 切换到某条动态时，优先用 placeholderData 显示上一次的数据，等新数据到达后平滑替换。

---

## 四、效果总结

- 动态栏和动态时间栏均实现了工业级的加载体验优化。
- 骨架屏、懒加载、预取、占位数据等手段协同，极大提升了页面流畅度和响应速度。
- 方案兼容移动端和桌面端，适合大规模生产环境。

---

如需进一步优化（如服务端渲染、CDN 边缘缓存等），可随时扩展。 